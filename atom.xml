<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>少安事务所</title>
  
  <subtitle>ShawnYan Office</subtitle>
  <link href="https://shawnyan.cn/atom.xml" rel="self"/>
  
  <link href="https://shawnyan.cn/"/>
  <updated>2024-03-18T16:30:00.000Z</updated>
  <id>https://shawnyan.cn/</id>
  
  <author>
    <name>Shawn Yan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MySQL 必备工具：SQL Developer</title>
    <link href="https://shawnyan.cn/2024/mysql/mysql-tool-sql-developer/"/>
    <id>https://shawnyan.cn/2024/mysql/mysql-tool-sql-developer/</id>
    <published>2024-03-18T16:30:00.000Z</published>
    <updated>2024-03-18T16:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>在当今信息化社会中，数据库已经成为了各行各业不可或缺的重要组成部分。而 MySQL 作为开源的关系型数据库管理系统，因其高效、稳定、易用的特点，受到了广大开发者和企业的青睐。</p><p>为了更好地管理和操作 MySQL 数据库，选择一款合适的开发工具显得尤为重要。</p><h2 id="MySQL-的-GUI-管理工具">MySQL 的 GUI 管理工具</h2><p>廣爲人知的 MySQL 的 GUI 管理工具有：</p><ol><li><p><a class="link"   href="https://www.mysql.com/products/workbench/" >MySQL Workbench <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>这是 Oracle 公司开发的一款免费的 MySQL 集成环境。MySQL Workbench 提供了数据建模、SQL开发、数据库管理、用户管理、备份等功能，并支持导入和导出数据，以及与其他数据库进行交互。MySQL Workbench 面向数据库架构师、开发人员和 DBA。 MySQL Workbench 可在 Windows、Linux 和 Mac OS X 上使用。</p></li><li><p><a class="link"   href="https://www.heidisql.com/" >HeidiSQL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>HeidiSQL 是免费软件，其目标是易于学习。“Heidi”可让您查看和编辑运行数据库系统 MariaDB、MySQL、Microsoft SQL、PostgreSQL 和 SQLite 的数据和结构。</p></li><li><p><a class="link"   href="https://www.phpmyadmin.net/" >phpMyAdmin <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>phpMyAdmin 是一个用 PHP 编写的免费软件工具，旨在通过 Web 处理 MySQL 的管理。 phpMyAdmin 支持 MySQL 和 MariaDB 上的各种操作。 常用的操作（管理数据库、表、列、关系、索引、用户、权限等）可以通过用户界面执行，同时您仍然可以直接执行任何 SQL 语句。</p></li><li><p><a class="link"   href="https://www.navicat.com.cn/" >Navicat for MySQL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>Navicat for MySQL 是管理和开发 MySQL 或 MariaDB 的理想解决方案。它是一套单一的应用程序，能同时连接 MySQL 和 MariaDB 数据库，并与 OceanBase 数据库及 Amazon RDS、Amazon Aurora、Oracle Cloud、Microsoft Azure、阿里云、腾讯云和华为云等云数据库兼容。这套全面的前端工具为数据库管理、开发和维护提供了一款直观而强大的图形界面。</p></li><li><p><a class="link"   href="https://dbeaver.io/" >DBeaver <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>DBeaver 是一个通用的数据库管理和开发工具，支持包括 MySQL 在内的几乎所有的数据库产品。它基于 Java 开发，可以运行在 Windows、Linux、macOS 等各种操作系统上。</p></li><li><p><a class="link"   href="https://www.jetbrains.com/zh-cn/datagrip/" >DataGrip <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>DataGrip 是一个多引擎数据库环境，使用者无需切换多种数据库工具，即可轻松管理 MySQL 等数据库。DataGrip 支持智能代码补全、实时分析和快速修复特性，並集成了版本控制。</p></li></ol><h2 id="SQL-Developer">SQL Developer</h2><p>熟悉 Oracle 的同学都知道 <a class="link"   href="https://docs.oracle.com/en/database/oracle/sql-developer/index.html" >SQL Developer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，</p><p>這是一款由 Oracle 公司开发的集成开发环境（IDE），它专为数据库管理和开发而设计。这款工具提供了从数据库设计、建模、开发到维护的一站式服务，使得开发者能够在一个统一的界面中完成所有的数据库相关工作。</p><p>Oracle SQL Developer 是基於 Java 開發的，不僅可以連接到 Oracle 数据库，也可以连接到选定的第三方（非 Oracle）数据库、查看元数据和数据，以及将这些数据库迁移到 Oracle。</p><p>比如支持 MySQL。</p><h3 id="安装">安装</h3><p>直接從 Oracle 網站下載就好。</p><p>我這裏已經準備好了安裝包。内置 Java 環境，開箱即用。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqldeveloper-23.1.1.345.2114-x64.zip</span><br></pre></td></tr></table></figure></div><img  alt="01version"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-ed45062c-6e0f-4bc2-bd31-b03efb37942c.png"                      referrerpolicy="no-referrer"                ><p>Java 版本為 11，IDE 版本為 23.1。</p><p>可以按照個人習慣選擇顯示語言，本文示例選擇了【中文】。</p><h3 id="配置-JDBC">配置 JDBC</h3><p>默認支持連接 Oracle，相關内容可以參考薛老師的文章：</p><p><a class="link"   href="https://mp.weixin.qq.com/s/uzV1TwwacdzwQ_OTR6OAjA" >其实很多人不了解SQL Developer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>如果需要連接到 MySQL 服務器，需要自行添加 MySQL 的 JDBC，關於選擇哪個版本，可參考文章：</p><p><a class="link"   href="https://mp.weixin.qq.com/s/PWeDyUXkUuw9t3kdQDraLg" >如何选择适合的 MySQL Connector/J 版本 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>在菜單欄【工具】-》【首選項】-》【數據庫】-》【第三方 JDBC 驅動程式】，</p><img  alt="02p"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-a4f5858d-ee0e-48ce-8345-b04b5c4bb0d8.png"                      referrerpolicy="no-referrer"                ><p>添加準備好的 JDBC 驅動。</p><img  alt="03jdbc"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-9f37d1ab-28c2-4ccd-b6f9-0560ef7426de.png"                      referrerpolicy="no-referrer"                ><h3 id="连接-MySQL">连接 MySQL</h3><p>現在，我們可以新建 MySQL 的數據庫連接，在【數據庫類型】下拉菜單選擇【MySQL】即可。</p><img  alt="04type"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-0c4ab344-4a1b-4582-a56e-b4faa580e295.png"                      referrerpolicy="no-referrer"                ><p>连接成功后，可以看到 SQL Developer 的主界面。</p><p>在左侧的导航栏中，可以看到数据库中的所有模式（schemas）和对象（如表、视图、索引、过程、函数、触发器等）。</p><p>要执行 SQL 查询，可以点击主界面上方的 SQL 编辑器标签，打开一个新的查询窗口。</p><p>在查询窗口中，输入 SQL 语句，比如查詢數據庫版本信息。</p><img  alt="05select"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-8224aea9-6d0f-49d7-8632-2b879743ddb9.png"                      referrerpolicy="no-referrer"                ><h3 id="其他高级功能">其他高级功能</h3><p>SQL Developer 還貼心的提供了數據遷移功能，將第三方數據庫遷移到 Oracle。</p><img  alt="06migrate"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240313-bb03edf5-e9f8-40a3-995d-9ecbf6d2421e.png"                      referrerpolicy="no-referrer"                ><h3 id="自定义-Dark-色彩">自定义 Dark 色彩</h3><p>SQL Developer 允许用户进行自定义和扩展，以满足特定的工作需求。</p><p>例如，可以更改界面主题、字体和颜色等设置，以优化用户体验。</p><p>举个例子，可以在 SQL Developer 中引入 <a class="link"   href="https://draculatheme.com/oracle-sql-developer" >Dark 色彩 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>模式。</p><p>进入文件夹：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%APPDATA%\SQL Developer\system23.1.1.345.2114\o.ide.12.2.1.6.42.220506.654</span><br></pre></td></tr></table></figure></div><p>编辑文件 <code>dtcache.xml</code>:</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">            <span class="tag">&lt;<span class="name">Item</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">Key</span>&gt;</span>Dark<span class="tag">&lt;/<span class="name">Key</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">Value</span> <span class="attr">class</span>=<span class="string">&quot;java.util.ArrayList&quot;</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">               <span class="tag">&lt;/<span class="name">Value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>启动 SQL Developer，点击菜單欄【工具】-》【首選項】-》【代码编辑器】-》【PL/SQL 语法颜色】，选择【Dark】方案，【确定】。</p><img  alt="dark"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240319-3ff938fa-4961-498f-a8ab-d18554f94122.png"                      referrerpolicy="no-referrer"                ><p>再次连接 DB 后，可以看到 SQL 编辑器已经渲染为 Dark 色彩。</p><img  alt="pg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240319-ab00792e-b047-430c-bb82-80622f147011.png"                      referrerpolicy="no-referrer"                ><p>– END. –</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在当今信息化社会中，数据库已经成为了各行各业不可或缺的重要组成部分。而 MySQL 作为开源的关系型数据库管理系统，因其高效、稳定、易用的特点，受到了广大开发者和企业的青睐。&lt;/p&gt;
&lt;p&gt;为了更好地管理和操作 MySQL 数据库，选择一款合适的开发工具显得尤为重要。&lt;/p</summary>
      
    
    
    
    <category term="MySQL" scheme="https://shawnyan.cn/categories/mysql/"/>
    
    <category term="MySQL 8.0" scheme="https://shawnyan.cn/categories/mysql/mysql-8-0/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="mysql 8.0" scheme="https://shawnyan.cn/tags/mysql-8-0/"/>
    
    <category term="sqldev" scheme="https://shawnyan.cn/tags/sqldev/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 数据库认证考试介绍（2024 版）</title>
    <link href="https://shawnyan.cn/2024/mysql/mysql-certification-intro/"/>
    <id>https://shawnyan.cn/2024/mysql/mysql-certification-intro/</id>
    <published>2024-03-17T13:00:00.000Z</published>
    <updated>2024-03-17T13:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>MySQL is the world’s most popular open source database.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><p>MySQL 是世界上最流行的开源数据库。</p></blockquote><p>无论你是数据库初学者还是经验丰富的用户、MySQL 数据库管理员、MySQL 开发人员还是 MySQL 安全管理员，都可以在学习、准备 MySQL 认证过程中加深对 RDBMS 的了解，以便可以更有效地管理 MySQL<br>应用程序。</p><p>MySQL 数据库认证考试，是机遇也是挑战。</p><p>MySQL 认证考试可以检验你对 MySQL<br>数据库的掌握程度，包括基本概念、操作技巧、性能优化、故障处理、备份恢复、企业级特性等多个方面。</p><p>挑战在于考试内容广泛且深入，要求你具备扎实的理论基础和丰富的实践经验。同时，考试过程紧张刺激（为了网速稳定而在下半夜考试），需要在有限的时间内迅速准确地回答问题（考试只有2个小时，平均不到2分钟需要答一道题）。</p><p>通过该考试，你不仅能够展示自己的专业能力，还能够获得业界认可的证书，为职业生涯发展增添有力支持，更是职业生涯中的一笔财富。</p><p>先来浅晒一下作者的 3 张证书。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240317-dd4c2068-4edb-4e0e-a4ed-505b3b7f1b5c.png"                      referrerpolicy="no-referrer"                ><p>那么，MySQL 数据库认证考试有哪些呢？</p><p>目前，MySQL 认证考试，分两个领域（Area）：Database Administration 和 Developer。</p><p>按水平（Level）分为：Associate，Professional，Specialist。</p><p>具体为：</p><ul><li>MySQL Database Administration<ol><li>Associate: MySQL HeatWave Implementation Certified Associate Rel 1</li><li>Professional: Oracle Certified Professional, MySQL 8.0 Database Administrator</li><li>Specialist: MySQL 2021 Certified Implementation Specialist</li></ol></li><li>MySQL Developer<ol><li>Professional: MySQL 8.0 Database Developer Oracle Certified Professional</li></ol></li></ul><h2 id="MySQL-HeatWave-Implementation-Associate-Rel-1-1Z0-915-1">MySQL HeatWave Implementation Associate Rel 1 (1Z0-915-1)</h2><p>MySQL HeatWave 实施认证助理已展示了配置、配置和管理用于事务、分析、机器学习和 Lakehouse 的 MySQL HeatWave 所需的知识。</p><p>获得此认证的个人了解如何使用 MySQL HeatWave Lakehouse 管理用户帐户、连接、机器学习和分析。</p><h3 id="学习路径">学习路径</h3><ul><li>创建和管理 MySQL 数据库服务实例</li><li>将本地数据库迁移到云端</li><li>监控实例并调整资源的使用</li><li>配置 MySQL 数据库系统</li><li>管理 MySQL 数据库系统</li><li>备份 MySQL 数据库系统</li><li>将您的数据迁移到 MySQL 数据库服务</li><li>MySQL 数据库服务高可用</li><li>实施 MySQL HeatWave 来加速查询</li></ul><h3 id="考试内容">考试内容</h3><ul><li>MySQL HeatWave Service</li><li>Provisioning and Connecting DB systems</li><li>Managing DB systems</li><li>Backing up and restoring DB systems</li><li>MySQL HeatWave Configurations</li><li>Read Replicas</li><li>Inbound Replication</li><li>Data Migrations</li><li>High Availability</li><li>HeatWave Cluster</li><li>HeatWave AutoML</li></ul><h3 id="考试形式">考试形式</h3><ul><li>多选题</li><li>65 道题</li><li>限时 90 分钟</li><li>通过分数 60%</li></ul><h2 id="MySQL-8-0-Database-Administrator-1Z0-908">MySQL 8.0 Database Administrator (1Z0-908)</h2><p>Oracle 认证专家、MySQL 8.0 数据库管理员证书承认考生具备 MySQL 架构所需的知识，并具备安装和配置 MySQL 数据库的技能。</p><p>该认证表明专业人员具备监控、维护和保护 MySQL 数据库所需的技能。</p><p>它还展示了专业人员对如何优化查询性能、实施备份和恢复策略以及实施高可用性技术的掌握。</p><h3 id="学习路径-2">学习路径</h3><ul><li>安装和配置 MySQL 服务器和客户端程序</li><li>认识 MySQL 架构的关键组件</li><li>管理用户帐户并保护服务器的安全</li><li>解决服务器速度下降和其他问题</li><li>MySQL 数据库的备份和恢复</li><li>配置和管理各种复制拓扑</li></ul><h3 id="考试内容-2">考试内容</h3><ul><li>Architecture</li><li>Server Installation and Configuration</li><li>Security</li><li>Monitoring and Maintenance</li><li>Query Optimization</li><li>Backups and Recovery</li><li>High Availability Techniques</li></ul><h3 id="考试形式-2">考试形式</h3><ul><li>多选题</li><li>73 道题</li><li>限时 130 分钟</li><li>通过分数 62%</li><li>验证版本 MySQL 8.0.18</li><li>支持中文试题</li></ul><h2 id="MySQL-2021-Certified-Implementation-Specialist-1Z0-921">MySQL 2021 Certified Implementation Specialist (1Z0-921)</h2><p>经过认证的 MySQL 专家能够充分演示 MySQL 功能（本地和 Oracle 云中）、进行技术讨论和概念验证，并提供完整的 Oracle 云解决方案，其中包括分析服务 (HeatWave) 和带有容器的微服务 (Kubernetes)。</p><p>该认证表明了对 MySQL Enterprise Edition 的深入了解，包括：安装、数据库设计、高可用性和复制、安全性、MySQL Enterprise Monitor 和备份。</p><p>它还展示了有关 MySQL 数据库服务和 HeatWave 的基础知识。</p><h3 id="考试内容-3">考试内容</h3><ul><li>Oracle MySQL Enterprise Product suite</li><li>Installation and Architecture</li><li>Database Design</li><li>MySQL Security</li><li>MySQL Enterprise Monitor</li><li>MySQL Backup</li><li>MySQL High Availability and Replication</li><li>MySQL Database Service and HeatWave</li><li>MySQL Kubernetes</li></ul><h3 id="考试形式-3">考试形式</h3><ul><li>多选题</li><li>52 道题</li><li>限时 90 分钟</li><li>通过分数 60%</li><li>验证版本 MySQL 企业版 8.0 和 MySQL 数据库服务、HeatWave 2021</li></ul><h2 id="MySQL-8-0-Database-Developer-Oracle-Certified-Professional-1Z0-909">MySQL 8.0 Database Developer Oracle Certified Professional (1Z0-909)</h2><p>MySQL 8.0 数据库开发人员 Oracle 认证专业证书承认考生具备使用连接器和 API 以及如何使用 MySQL 数据库支持数据驱动应用程序所需的知识和技能。</p><p>该认证表明专业人员可以设计、开发和维护 MySQL 模式对象并控制 SQL 和应用程序中的事务。</p><p>它还展示了专业人员对如何优化查询性能、创建和执行存储程序以及管理 JSON 和文档存储的掌握。</p><h3 id="学习路径-3">学习路径</h3><ul><li>使用连接器进行编程</li><li>编写控制台和 Web 应用程序</li><li>优化查询性能</li><li>编写存储例程和触发器</li><li>存储、访问和分析地理空间数据</li><li>使用 X DevAPI 访问文档存储中的 JSON 数据</li></ul><h3 id="考试内容-4">考试内容</h3><ul><li>Connectors and APIs</li><li>Data-driven Applications</li><li>MySQL Schema Objects and Data</li><li>Transactions</li><li>Query Optimization</li><li>MySQL Stored Programs</li><li>JSON and Document Store</li></ul><h3 id="考试形式-4">考试形式</h3><ul><li>多选题</li><li>65 道题</li><li>限时 90 分钟</li><li>通过分数 62%</li><li>验证版本 MySQL 8.0.18</li></ul><h2 id="总结">总结</h2><p>以上四种 MySQL 认证考试中，OCP MySQL DBA 最为流行广泛，学习资料也最全，还支持中文试题。</p><p>总之，MySQL 数据库认证考试是对过往学习、工作的一个阶段性总结和证明。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a class="link"   href="https://education.oracle.com/oracle-certification-path/pFamily_406" >https://education.oracle.com/oracle-certification-path/pFamily_406 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;MySQL is the world’s most popular open source database.&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;#fn1&quot; id=&quot;fnref1&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;&lt;/p</summary>
      
    
    
    
    <category term="MySQL" scheme="https://shawnyan.cn/categories/mysql/"/>
    
    <category term="OCP" scheme="https://shawnyan.cn/categories/mysql/ocp/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="mysql 8.0" scheme="https://shawnyan.cn/tags/mysql-8-0/"/>
    
    <category term="ocp" scheme="https://shawnyan.cn/tags/ocp/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 升级：使用 mysql_upgrade 注意事项（再见 mysql_upgrade）</title>
    <link href="https://shawnyan.cn/2024/mysql/mysql-upgrade-deprecated/"/>
    <id>https://shawnyan.cn/2024/mysql/mysql-upgrade-deprecated/</id>
    <published>2024-03-15T15:00:00.000Z</published>
    <updated>2024-03-15T15:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>在数据库管理的世界里，随着技术的不断进步和业务的不断发展，数据库的版本升级成为了一个不可避免的过程。</p><p>MySQL 作为业界领先的开源关系型数据库管理系统，其版本迭代与功能优化同样不容忽视。</p><p>而在这个过程中，升级工具就显得尤为重要，比如 <code>mysql_upgrade</code>。</p><p>但是，<code>mysql_upgrade</code> 已经成为过去式，且来往下看。</p><h2 id="mysql-upgrade-介绍">mysql_upgrade 介绍</h2><p>mysql_upgrade 是 MySQL 提供的一个用于升级 MySQL 服务器的实用程序。</p><p>它检查服务器上的所有数据库，查看是否需要任何更改以利用新版本的 MySQL 服务器提供的特性。</p><p>mysql_upgrade 还会升级系统表，以使用当前 MySQL 版本提供的任何新特性。</p><p>简而言之，mysql_upgrade 就是一个帮助用户平滑过渡到新版本 MySQL 的桥梁。</p><p>使用 mysql_upgrade 的过程相对简单。</p><p>首先，停止旧版本的 MySQL 服务，建议用户备份整个数据库，以防万一升级过程中出现问题。</p><p>然后，安装新版本的 MySQL 服务器软件，并启动新版本的 MySQL 服务。</p><p>最后，运行 mysql_upgrade 命令，它会检查数据库中的表，并根据需要进行升级。</p><p>通常只需向几个表添加新字段，或者修改字段长度，或者补充修订数据。</p><p>也可能会出现罕见的情况，比如系统表的存储引擎发生变更，比如由 MyISAM 变更为 InnoDB。</p><h2 id="mysql-upgrade-使用示例">mysql_upgrade 使用示例</h2><p>举个栗子，</p><p>从 MySQL 5.7.18 升级到 MySQL 5.7.19，会增加一个 <code>'mysql.session'@'localhost'</code> 保留账户。</p><p>该帐户由插件在内部使用来访问服务器。 它被锁定，因此不能用于客户端连接。</p><p>具体案例如下：</p><p>现在，我们有一个 MySQL 5.7.18 服务器正在运行。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.7.18    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>查看用户列表。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user from mysql.user;</span><br><span class="line">+-----------+</span><br><span class="line">| user      |</span><br><span class="line">+-----------+</span><br><span class="line">| mysql.sys |</span><br><span class="line">| root      |</span><br><span class="line">+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>我们来停止旧版本的 MySQL 服务。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld</span><br></pre></td></tr></table></figure></div><p>接下来，准备升级到 MySQL 5.7.19，RPM 包已经准备好。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ls m*rpm</span><br><span class="line">mysql-community-client-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-common-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-devel-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-compat-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-embedded-devel-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-libs-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-libs-compat-5.7.19-1.el7.x86_64.rpm</span><br><span class="line">mysql-community-server-5.7.19-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure></div><p>使用 yum 命令进行升级。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update mysql-community-*</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Updated:</span><br><span class="line">  mysql-community-client.x86_64 0:5.7.19-1.el7                             </span><br><span class="line">  mysql-community-common.x86_64 0:5.7.19-1.el7                             </span><br><span class="line">  mysql-community-devel.x86_64 0:5.7.19-1.el7                              </span><br><span class="line">  mysql-community-embedded.x86_64 0:5.7.19-1.el7                           </span><br><span class="line">  mysql-community-embedded-compat.x86_64 0:5.7.19-1.el7                    </span><br><span class="line">  mysql-community-embedded-devel.x86_64 0:5.7.19-1.el7                     </span><br><span class="line">  mysql-community-libs.x86_64 0:5.7.19-1.el7                               </span><br><span class="line">  mysql-community-libs-compat.x86_64 0:5.7.19-1.el7                        </span><br><span class="line">  mysql-community-server.x86_64 0:5.7.19-1.el7                             </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></div><p>安装完成，启动新版本的 MySQL 服务。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure></div><p>登陆数据库，查看用户列表。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user from mysql.user;</span><br><span class="line">+-----------+</span><br><span class="line">| user      |</span><br><span class="line">+-----------+</span><br><span class="line">| mysql.sys |</span><br><span class="line">| root      |</span><br><span class="line">+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>可以看到，<code>mysql.session</code> 用户尚未被添加到数据库中。</p><p>这里我们开启 general 日志，来观察升级命令都执行了哪些 SQL。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%gen%&#x27;;</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line">| Variable_name    | Value                       |</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line">| general_log      | ON                          |</span><br><span class="line">| general_log_file | /var/lib/mysql/shawnyan.log |</span><br><span class="line">+------------------+-----------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>下一步，运行 mysql_upgrade 命令。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_upgrade</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~ 07:42:50]$ mysql_upgrade -uroot -p</span><br><span class="line">Checking if update is needed.</span><br><span class="line">Checking server version.</span><br><span class="line">Running queries to upgrade MySQL server.</span><br><span class="line">Checking system database.</span><br><span class="line">mysql.columns_priv                                 OK</span><br><span class="line">mysql.db                                           OK</span><br><span class="line">mysql.engine_cost                                  OK</span><br><span class="line">mysql.event                                        OK</span><br><span class="line">mysql.func                                         OK</span><br><span class="line">mysql.general_log                                  OK</span><br><span class="line">mysql.gtid_executed                                OK</span><br><span class="line">mysql.help_category                                OK</span><br><span class="line">mysql.help_keyword                                 OK</span><br><span class="line">mysql.help_relation                                OK</span><br><span class="line">mysql.help_topic                                   OK</span><br><span class="line">mysql.innodb_index_stats                           OK</span><br><span class="line">mysql.innodb_table_stats                           OK</span><br><span class="line">mysql.ndb_binlog_index                             OK</span><br><span class="line">mysql.plugin                                       OK</span><br><span class="line">mysql.proc                                         OK</span><br><span class="line">mysql.procs_priv                                   OK</span><br><span class="line">mysql.proxies_priv                                 OK</span><br><span class="line">mysql.server_cost                                  OK</span><br><span class="line">mysql.servers                                      OK</span><br><span class="line">mysql.slave_master_info                            OK</span><br><span class="line">mysql.slave_relay_log_info                         OK</span><br><span class="line">mysql.slave_worker_info                            OK</span><br><span class="line">mysql.slow_log                                     OK</span><br><span class="line">mysql.tables_priv                                  OK</span><br><span class="line">mysql.time_zone                                    OK</span><br><span class="line">mysql.time_zone_leap_second                        OK</span><br><span class="line">mysql.time_zone_name                               OK</span><br><span class="line">mysql.time_zone_transition                         OK</span><br><span class="line">mysql.time_zone_transition_type                    OK</span><br><span class="line">mysql.user                                         OK</span><br><span class="line">The sys schema is already up to date (version 1.5.1).</span><br><span class="line">Checking databases.</span><br><span class="line">sys.sys_config                                     OK</span><br><span class="line">Upgrade process completed successfully.</span><br><span class="line">Checking if update is needed.</span><br></pre></td></tr></table></figure></div><p>通过 general 日志，可以看到 <code>mysql.session</code> 用户被写入用户表。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~ 07:43:42]$ grep &#x27;mysql.session&#x27; /var/lib/mysql/shawnyan.log</span><br><span class="line">2024-03-15T23:43:09.277088Z    6 QuerySELECT COUNT(*) FROM mysql.user WHERE user = &#x27;mysql.session&#x27;</span><br><span class="line">2024-03-15T23:43:10.888664Z    6 QueryINSERT IGNORE INTO mysql.user VALUES (&#x27;localhost&#x27;,&#x27;mysql.session&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;Y&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,0,0,0,0,&#x27;mysql_native_password&#x27;,&#x27;*THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE&#x27;,&#x27;N&#x27;,CURRENT_TIMESTAMP,NULL,&#x27;Y&#x27;)</span><br><span class="line">2024-03-15T23:43:10.889540Z    6 QueryINSERT IGNORE INTO mysql.tables_priv VALUES (&#x27;localhost&#x27;, &#x27;mysql&#x27;, &#x27;mysql.session&#x27;, &#x27;user&#x27;, &#x27;root\@localhost&#x27;, CURRENT_TIMESTAMP, &#x27;Select&#x27;, &#x27;&#x27;)</span><br><span class="line">2024-03-15T23:43:10.890429Z    6 QueryINSERT IGNORE INTO mysql.db VALUES (&#x27;localhost&#x27;, &#x27;performance_schema&#x27;, &#x27;mysql.session&#x27;,&#x27;Y&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;,&#x27;N&#x27;)</span><br><span class="line">[root@shawnyan ~ 07:44:02]$ </span><br></pre></td></tr></table></figure></div><p>再次登陆数据库，查看用户列表，确认新用户已经添加成功。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> version();</span></span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 5.7.19    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> user from mysql.user;</span></span><br><span class="line">+---------------+</span><br><span class="line">| user          |</span><br><span class="line">+---------------+</span><br><span class="line">| mysql.session |</span><br><span class="line">| mysql.sys     |</span><br><span class="line">| root          |</span><br><span class="line">+---------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h2 id="mysql-upgrade-废弃">mysql_upgrade 废弃</h2><p>不过，从 MySQL 8.0.16 开始， mysql_upgrade 被废弃，并将从未来的版本中移除。</p><p>DBA 不再需要额外地手动调用 mysql_upgrade 来进行升级操作。</p><p>取而代之的是，服务器新增了 <code>--upgrade</code> 选项，默认值为 <code>AUTO</code>，</p><p>服务器会自行判断是否需要升级，如需要会在启动时自动执行升级操作。</p><p>如果执行 mysql_upgrade 命令，会输出下面一段信息：</p><blockquote><p>The mysql_upgrade client is now deprecated. The actions executed by the upgrade client are now done by the server.<br>To upgrade, please start the new MySQL binary with the older data directory. Repairing user tables is done automatically. Restart is not required after upgrade.<br>The upgrade process automatically starts on running a new MySQL binary with an older data directory. To avoid accidental upgrades, please use the --upgrade=NONE option with the MySQL binary. The option --upgrade=FORCE is also provided to run the server upgrade sequence on demand.<br>It may be possible that the server upgrade fails due to a number of reasons. In that case, the upgrade sequence will run again during the next MySQL server start. If the server upgrade fails repeatedly, the server can be started with the --upgrade=MINIMAL option to start the server without executing the upgrade sequence, thus allowing users to manually rectify the problem.</p></blockquote><h2 id="总结">总结</h2><p>总的来说，在 MySQL 8.0.16 之前，mysql_upgrade 是一个功能强大且实用的工具，它能够帮助用户平滑地过渡到新版本的 MySQL。</p><p>随着 MySQL 版本的不断更新和升级，mysql_upgrade 的功能已经内嵌到 MySQL 服务器，其也将伴随 MySQL 5.7 逐步退出历史舞台。</p><p>– END –</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在数据库管理的世界里，随着技术的不断进步和业务的不断发展，数据库的版本升级成为了一个不可避免的过程。&lt;/p&gt;
&lt;p&gt;MySQL 作为业界领先的开源关系型数据库管理系统，其版本迭代与功能优化同样不容忽视。&lt;/p&gt;
&lt;p&gt;而在这个过程中，升级工具就显得尤为重要，比如 &lt;code</summary>
      
    
    
    
    <category term="MySQL" scheme="https://shawnyan.cn/categories/mysql/"/>
    
    <category term="MySQL 8.0" scheme="https://shawnyan.cn/categories/mysql/mysql-8-0/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="mysql 5.7" scheme="https://shawnyan.cn/tags/mysql-5-7/"/>
    
    <category term="mysql 8.0" scheme="https://shawnyan.cn/tags/mysql-8-0/"/>
    
  </entry>
  
  <entry>
    <title>PG 扩展推荐：pgpasswd &amp; PG 密碼長度</title>
    <link href="https://shawnyan.cn/2024/postgresql/pg-extension-pgpasswd/"/>
    <id>https://shawnyan.cn/2024/postgresql/pg-extension-pgpasswd/</id>
    <published>2024-03-13T13:00:00.000Z</published>
    <updated>2024-03-18T15:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="导语">导语</h2><p>PostgreSQL 用户密码的设定通常有两种。</p><p>一是创建用户时直接指定用户密码。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user shawnyan password <span class="string">&#x27;test&#x27;</span>;</span><br></pre></td></tr></table></figure></div><p>二是创建用户后更新用户密码。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter user shawnyan password <span class="string">&#x27;test&#x27;</span>;</span><br></pre></td></tr></table></figure></div><p>PostgreSQL 将用户信息存储在系统表 <code>pg_catalog.pg_authid</code> 中。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select rolname as user, left(rolpassword,<span class="number">20</span>) as passwd</span><br><span class="line">from pg_catalog.pg_authid</span><br><span class="line">where rolname = <span class="string">&#x27;shawnyan&#x27;</span>;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   user   |        passwd</span><br><span class="line">----------+----------------------</span><br><span class="line"> shawnyan | SCRAM-SHA<span class="number">-256</span>$<span class="number">4096</span>:E</span><br><span class="line">(<span class="number">1</span> row)</span><br></pre></td></tr></table></figure></div><p>接下来将基于 PostgreSQL 16.2 介绍扩展 <code>pgpasswd</code>。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgres=<span class="meta"># select version();</span></span><br><span class="line">                                                      version</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> PostgreSQL <span class="number">16.2</span>-ShawnYan on x86_64-pc-linux-gnu, compiled by gcc (GCC) <span class="number">11.4</span><span class="number">.1</span> <span class="number">20230605</span> (Red Hat <span class="number">11.4</span><span class="number">.1</span><span class="number">-2</span>), <span class="number">64</span>-bit</span><br><span class="line">(<span class="number">1</span> row)</span><br></pre></td></tr></table></figure></div><h2 id="pgpasswd">pgpasswd</h2><p>类似于 Linux 中的 <code>passwd</code> 命令，使用 <code>pgpasswd</code> 可以从 Linux 命令行更改 PostgreSQL 帐户密码，无需输入任何 SQL 语句。</p><p><code>pgpasswd</code> 是 PostgreSQL 扩展和独立可执行文件（无需在数据库中安装任何内容，无需运行 CREATE EXTENSION）。</p><p>下载源码：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/shawn0915/pgpasswd.git</span><br></pre></td></tr></table></figure></div><p>目录结构比较简洁：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[postgres@rocky9 pgpasswd]$ ls</span><br><span class="line">LICENSE  Makefile  META.json  pgpasswd.c  README.md</span><br></pre></td></tr></table></figure></div><ul><li>LICENSE: 是本软件的许可。pgpasswd 软件根据 PostgreSQL 许可证的条款发布。许可中规定，允许任何人出于任何目的，免费使用、复制、修改和分发该软件及其文档。</li><li>Makefile：用于自动化构建和管理软件项目，它由一系列规则和命令组成。在本工程中，提供了 <code>all</code>, <code>install</code>, <code>clean</code>, <code>pgxn</code> 等四种命令。</li><li>META.json：包含 pgpasswd 项目的元数据。元数据中包括项目名称、版本信息、维护者、许可证、要求的 PostgreSQL 版本等信息。</li><li>pgpasswd.c：该工程的主文件，包含了项目用法的具体实现，以及一些约束条件。</li><li><a class="link"   href="http://README.md" >README.md <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>：描述 pgpasswd 项目的内容和如何编译、安装、使用项目，帮助用户快速了解项目的功能和用法，从而提高项目的可用性和传播性。</li></ul><p>其中，在项目中，我们可以看到 <code>PASSWORD_MAX_LENGTH=30</code> 约束，意味着密码长度不能超过 30。</p><p>工程直接编译、安装即可：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[postgres@rocky9 pgpasswd]$ make</span><br><span class="line">gcc -I/opt/pgsql/include -I/opt/pgsql/include/server -c pgpasswd.c -Wall</span><br><span class="line">gcc -I/opt/pgsql/include -L/opt/pgsql/lib -lpq -o pgpasswd pgpasswd.o</span><br><span class="line">[postgres@rocky9 pgpasswd]$ make install</span><br><span class="line">installpgpasswd /opt/pgsql/bin</span><br></pre></td></tr></table></figure></div><p>可以看到将编译好的二进制文件 <code>pgpasswd</code> 安装到了 <code>bin</code> 目录下。</p><p>使用方式：</p><p>需要指定参数 <code>-U</code> 需要修改密码的用户名，<code>-h</code> 数据库连接地址，<code>-p</code> 数据库端口，<code>-d postgres</code> 系统库，否则，会提示报错 <code>Missing parameters</code>。</p><p>此外，可以加 <code>-v</code> 参数打印更多信息，比如客户端版本信息 <code>PG libpq version</code>，连接信息 <code>conninfo</code>，以及 PG 服务器的版本信息 <code>PG server version</code>。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[postgres@rocky9 ~]$ pgpasswd -U shawnyan -h <span class="number">127.1</span> -p <span class="number">5432</span> -d postgres -v</span><br><span class="line">Password:</span><br><span class="line">PG libpq version: <span class="number">160002</span></span><br><span class="line">conninfo: user=shawnyan host=<span class="number">127.1</span> port=<span class="number">5432</span> dbname=postgres password=test  </span><br><span class="line">PG server version: <span class="number">160002</span></span><br><span class="line">New password:</span><br><span class="line">Confirm new password:</span><br><span class="line">stmt=ALTER USER shawnyan PASSWORD <span class="string">&#x27;test1&#x27;</span> </span><br><span class="line">Password changed.</span><br></pre></td></tr></table></figure></div><p>用新密码测试连接：</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[postgres@rocky9 ~]$ psql -U shawnyan -h <span class="number">127.1</span></span><br><span class="line">Password <span class="keyword">for</span> user shawnyan: </span><br><span class="line">psql (<span class="number">16.2</span>-ShawnYan)</span><br><span class="line">Type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line">postgres=&gt; </span><br></pre></td></tr></table></figure></div><p>到此，PG 扩展 <code>pgpasswd</code> 介绍到这里，欢迎“品尝”。</p><h2 id="再討論：PG-密碼長度">再討論：PG 密碼長度</h2><p>在上文中提到，<code>pgpasswd</code> 只允許密碼設定長度為 30，<br>如果原始密碼或新密碼都超過 30，那麽程序會異常退出，無法修改密碼。</p><p>畢竟是個 TOY，不要在意這些細節，keep going…</p><p>那麽，問題來了，在 PostgreSQL 服務器中，用戶密碼最長可以設定為多少呢？</p><p>以 PostgreSQL v16 為例，用戶密碼字段為 <code>text</code>，</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(postgres@[local]) [postgres] 20:57:41# \d pg_catalog.pg_authid</span><br><span class="line">                        Table &quot;pg_catalog.pg_authid&quot;</span><br><span class="line">     Column     |           Type           | Collation | Nullable | Default </span><br><span class="line">----------------+--------------------------+-----------+----------+---------</span><br><span class="line"> oid            | oid                      |           | not null | </span><br><span class="line"> rolname        | name                     |           | not null | </span><br><span class="line"> rolsuper       | boolean                  |           | not null | </span><br><span class="line"> rolinherit     | boolean                  |           | not null | </span><br><span class="line"> rolcreaterole  | boolean                  |           | not null | </span><br><span class="line"> rolcreatedb    | boolean                  |           | not null | </span><br><span class="line"> rolcanlogin    | boolean                  |           | not null | </span><br><span class="line"> rolreplication | boolean                  |           | not null | </span><br><span class="line"> rolbypassrls   | boolean                  |           | not null | </span><br><span class="line"> rolconnlimit   | integer                  |           | not null | </span><br><span class="line"> rolpassword    | text                     | C         |          | </span><br><span class="line"> rolvaliduntil  | timestamp with time zone |           |          | </span><br><span class="line">Indexes:</span><br><span class="line">    &quot;pg_authid_oid_index&quot; PRIMARY KEY, btree (oid), tablespace &quot;pg_global&quot;</span><br><span class="line">    &quot;pg_authid_rolname_index&quot; UNIQUE CONSTRAINT, btree (rolname), tablespace &quot;pg_global&quot;</span><br><span class="line">Tablespace: &quot;pg_global&quot;</span><br></pre></td></tr></table></figure></div><p>這意味著，對與密碼的最大長度，PostgreSQL 并沒有一個硬性的限制。</p><p>最開始就是這樣的麽？并不是。</p><p><a class="link"   href="https://git.postgresql.org/gitweb/?p=postgresql.git;a=commitdiff;h=67a472d71c98c3d2fa322a1b4013080b20720b98" >2020-0-03, Remove arbitrary restrictions on password length. <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>该补丁最初的目标是协调各种任意的密码长度受到限制，但过了一段时间，一个更好的想法出现了：<br>让我们摆脱那些固定的限制。</p><p>這裏的限制是指之前版本中的 100 位密碼，從 PG 14 開始，<br>隨著 <a class="link"   href="https://github.com/postgres/postgres/commit/67a472d71c98c3d2fa322a1b4013080b20720b98" >67a472d <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>patch 被 merge 到 master，這一限制也被取消掉了。</p><p>當然，現在 PG 默認的加密算法為 <code>SCRAM-SHA-256</code>，密碼加密后，<br>實際表中存儲的密碼并不會很長很長很長。</p><p>更多討論：</p><ul><li><a class="link"   href="https://www.postgresql.org/message-id/09512C4F-8CB9-4021-B455-EF4C4F0D55A0@amazon.com" >Maximum password length <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a class="link"   href="https://www.postgresql.org/message-id/tencent_DDB8F58E4291FA8FB5AD82AE317519A77E07%40qq.com" >Re: Is there still password max length restrictions in PG? <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><p>再補充一點：</p><p>建議使用 <code>scram-sha-256</code> 密碼驗證方法，而不是 <code>md5</code> 和 <code>password</code>。</p><p>建議自行對用戶名和用戶密碼設立規範，比如用戶名命名規則，密碼複雜度和長度等。</p><p>– END –</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;导语&quot;&gt;导语&lt;/h2&gt;
&lt;p&gt;PostgreSQL 用户密码的设定通常有两种。&lt;/p&gt;
&lt;p&gt;一是创建用户时直接指定用户密码。&lt;/p&gt;
&lt;div class=&quot;highlight-container&quot; data-rel=&quot;C&quot;&gt;&lt;figure class=&quot;ise</summary>
      
    
    
    
    <category term="PostgreSQL" scheme="https://shawnyan.cn/categories/postgresql/"/>
    
    <category term="Extension" scheme="https://shawnyan.cn/categories/postgresql/extension/"/>
    
    
    <category term="postgresql" scheme="https://shawnyan.cn/tags/postgresql/"/>
    
    <category term="postgresql 16" scheme="https://shawnyan.cn/tags/postgresql-16/"/>
    
    <category term="extension" scheme="https://shawnyan.cn/tags/extension/"/>
    
    <category term="pgpasswd" scheme="https://shawnyan.cn/tags/pgpasswd/"/>
    
  </entry>
  
  <entry>
    <title>【我和 TiDB 社区的故事】我与 TiDB 专栏的故事</title>
    <link href="https://shawnyan.cn/2024/tidb/tidb-story-with-tidb-blog/"/>
    <id>https://shawnyan.cn/2024/tidb/tidb-story-with-tidb-blog/</id>
    <published>2024-03-06T15:17:36.000Z</published>
    <updated>2024-03-06T15:17:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="两年前">两年前</h2><p>两年前，2022 年初，TiDB 社区专栏上线，将原 AskTUG 论坛的“技术文章”统一迁移至专栏板块，TiDB 社区专栏板块旨在让技术人员成为更好的读者、作家。</p><p>截止至 2022.02.07，有 137 位社区技术布道师贡献了 497 篇技术文章。<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><p>涵盖了用户案例、最佳实践、技术经验分享、故障分析案例等几大主题。</p><p>同年 3 月 14 日，TiDB 社区专栏第一届征文大赛，正式启动。</p><p>正值 TiDB 6.0 发版，整个大赛过程各位布道师输出了诸多 TiDB 6.0 相关文章。</p><p>首届征文大赛截至 5 月 31 日，活动共有 45 位小伙伴参与，有 103 篇优质文章输出。<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p><p>经过对优质文章的精心整理和优化改进，最终发布了《TiDB 6.x in Action》电子书。<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p><p>…</p><p>于我个人而言，那时刚刚考完 PCTP v5 认证，对 TiDB 也有了较为初步、概括性的了解。</p><p>于是抽出大量业余时间，全程参与了整个活动，凌晨写稿、改稿、校稿亦是家常便饭。</p><p>在此次活动中，共入围 5 篇文章，其中 1 篇获得三等奖，1 篇获得最佳人气奖。</p><p>本次赛事共收获了 3 个奖牌，社区徽章，及 TiDB 周边若干。</p><p>同时，有幸遇此，结识了很多技术大咖，在文章审校、电子书编辑过程中，也对 TiDB 有了更多的理解。</p><p>与 TiDB 社区的诸位“亲戚”的相逢，让我 get 到了开源社区可以这样丰富多彩。</p><img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/2024-03-03_222014-1709527907034.png"                      referrerpolicy="no-referrer"                ><h2 id="一年前">一年前</h2><p>23 年春，3/1 ~ 5/31，TiDB 社区第二届征文大赛，如期举办。</p><p>本次活动共收到了 29 位 TiDBer 的 58 篇文章，其中有 10 位 Ti 高手贡献超过 2 篇文章。</p><p>这里可以看到文章合集：<a class="link"   href="https://asktug.com/t/topic/1007874#h-1" >https://asktug.com/t/topic/1007874#h-1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>经过多轮评选，活动最终产生一等奖 1 名，二等奖 3 名，三等奖 5 名，</p><p>以及 “书山有路勤为径” 勤奋奖 1 名，最佳人气奖 4 名。<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><p>…</p><p>实属遗憾，我在活动开始前病倒，一个多月的调理才逐渐恢复。</p><p>后又因事情累计太多，确实无暇参与大赛。</p><h2 id="2-个月前">2 个月前</h2><p>从 Billmay 的总结贴中了解到，从 2019 年到目前，累计社区布道师 262 名，累计发布文章数：1118 篇。</p><p>2023 年一共有 83 位小伙伴贡献了 295 篇技术文章。<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></p><img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/2024-03-03_173653-1709527943700.png"                      referrerpolicy="no-referrer"                ><p>…</p><p>从专栏上线到现在，我一共发布了 24 篇文章。并喜提 3 枚创作勋章。</p><p>再接再厉，争取早日拿下 50 篇文章的奖励徽章。</p><img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/2024-03-03_182136-1709527924116.png"                      referrerpolicy="no-referrer"                ><h2 id="Now">Now</h2><p>伴随 TiDB 的成长，TiDB v6.5 / v7.5 稳定性加固，对 MySQL 8.0 的全面兼容，</p><p>专栏新增了诸多生产案例、排障分析和技术内幕等方面的文章分享，</p><p>无论读者是数据库新兵，还是初学 TiDB，亦或对 TiDB 有较丰富的使用经验，都可以在这里“继续学习”。</p><p>2024 年 3 月，<strong>TiDB 社区第三届专栏征文大赛</strong>，已经上线，本次征文活动提供了如下这些主题以供写作方向参考。</p><ol><li><p>TiDB 新版本的应用（包括新功能和新特性的应用）：如 v6.5.x 、7.1.x、7.5.x 、8.x （预计 3月底上线）的新版本试用及应用，介绍您的使用体验及新版本带来的诸多新特性应用测评；</p></li><li><p>TiDB 的行业实践：在零售、金融、互联网+、SaaS、出海、游戏、医疗、教育等行业的 TiDB 实践分享；</p></li><li><p>TiDB 的降本增效方案：如何使用 TiDB 帮助业务和公司降本增效；</p></li><li><p>AI + TiDB：TiDB 和 AI 结合的场景和应用实践分享；</p></li><li><p>国产化改造：运用 TiDB 进行国产化改造实践分享；</p></li><li><p>数据库迁移实战：从 db2、oracle、MySQL、MongoDB、OceanBase、PostgreSQL、SQLServer、MariaDB 到 TiDB 的迁移实践与产品收益分享；</p></li><li><p>TiDB 的性能优化和调优技巧：分享您在使用 TiDB 时遇到的性能问题以及如何通过优化来提升系统性能的经验；</p></li><li><p>TiDB 原理解读及分析：分析解读 TiDB 各个组件如 TiFlash、TiKV、dm、TiUP 及各个功能、特性的原理；</p></li><li><p>TiDB 的稳定性表现：可以测试 TiDB 在稳定性上的表现，分析是否符合预期，也可以给产品提提建议。</p></li><li><p>数据库场景化架构方案设计：分享你在使用 TiDB 的过程中如何进行数据库架构调整以及调整后收益！</p></li><li><p>我和 TiDB 社区的故事：你和 TiDB 社区之间有哪些值得分享的故事？</p></li></ol><p>除了获奖三件套（奖杯+荣誉徽章+社区积分），本次活动还有诸多 2024 年新款周边在等你。</p><img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://tidb-blog.oss-cn-beijing.aliyuncs.com/media/3a11b4d038ce7d8c36457fc38d3101ddb7c38456-1709527956487.jpeg"                      referrerpolicy="no-referrer"                ><p>补充一点，TiDB 社区有两项荣誉称号，MVA 和 MOA。</p><ul><li><p>MVA 是在一年内（自然年）为 TiDB 社区多维贡献数量达到 5 个及以上或者优质贡献（Ti能说+Ti能写）达到3个以上，通过布道师组委会评审后，即可当选 TiDB 社区年度 MVA。</p></li><li><p>MOA 是在一年内（自然年）为 TiDB 社区多维贡献数量达到 10 个及以上，通过布道师组委会评审后，即可当选 TiDB 社区年度 MOA。</p></li></ul><p>当然，本次征文活动的文章也会统计到社区贡献中。</p><p>同时，一篇文章最多可获得 600 积分&amp;经验值，积分可兑换 TiDB 周边，及认证兑换码。</p><p>TiDB 社区专栏投稿入口：<a class="link"   href="https://tidb.net/blog/new/edit" >https://tidb.net/blog/new/edit <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>期待，与你在 TiDB 社区专栏相遇。</p><h2 id="推荐阅读">推荐阅读</h2><ul><li>阮一峰老师的【中文技术文档的写作规范】：<a class="link"   href="https://github.com/ruanyf/document-style-guide" >https://github.com/ruanyf/document-style-guide <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>【我和 TiDB 的故事】这里集齐了 34 位社区小伙伴和 TiDB 的故事：<a class="link"   href="https://asktug.com/t/topic/994906" >https://asktug.com/t/topic/994906 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a class="link"   href="https://tidb.net/blog/e9d33557" >https://tidb.net/blog/e9d33557 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a class="link"   href="https://tidb.net/blog/d60bd7f8" >https://tidb.net/blog/d60bd7f8 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a class="link"   href="https://tidb.net/book/book-rush" >https://tidb.net/book/book-rush <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a class="link"   href="https://asktug.com/t/topic/1007874" >https://asktug.com/t/topic/1007874 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a class="link"   href="https://asktug.com/t/topic/1020038#tidber-7" >https://asktug.com/t/topic/1020038#tidber-7 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;两年前&quot;&gt;两年前&lt;/h2&gt;
&lt;p&gt;两年前，2022 年初，TiDB 社区专栏上线，将原 AskTUG 论坛的“技术文章”统一迁移至专栏板块，TiDB 社区专栏板块旨在让技术人员成为更好的读者、作家。&lt;/p&gt;
&lt;p&gt;截止至 2022.02.07，有 137 位社区技</summary>
      
    
    
    
    <category term="TiDB" scheme="https://shawnyan.cn/categories/tidb/"/>
    
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="tidb 7.x" scheme="https://shawnyan.cn/tags/tidb-7-x/"/>
    
    <category term="tidb blog" scheme="https://shawnyan.cn/tags/tidb-blog/"/>
    
  </entry>
  
  <entry>
    <title>如何选择适合的 MySQL Connector/J 版本</title>
    <link href="https://shawnyan.cn/2024/mysql/mysql-connector-j-8-x/"/>
    <id>https://shawnyan.cn/2024/mysql/mysql-connector-j-8-x/</id>
    <published>2024-02-28T17:00:45.000Z</published>
    <updated>2024-02-28T17:00:45.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="mysql_girl.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240229-107b6e8c-3daf-4513-b487-cccda385dc8a.png"                      referrerpolicy="no-referrer"                ><h2 id="TL-DL">TL;DL</h2><p>如果你正在使用 MySQL 8.0 及以上版本或者兼容 MySQL 8.0 的数据库，推荐选择 MySQL Connector/J 8.3.0 版本。</p><h2 id="MySQL-Connector-J">MySQL Connector/J</h2><p>MySQL Connector/J 是 MySQL 官方提供的用于 Java 应用程序连接 MySQL 数据库的 JDBC 驱动。它支持 JDBC 4.2 API，并实现了 X DevAPI。</p><p>在选择用于生产环境的 MySQL Connector/J 版本时，需要考虑多个因素，以确保与你的项目需求和环境兼容性。本文将从 MySQL 服务器版本、Java 版本、JDBC 版本、TLS 版本、特性支持、生命周期等几个方面来讨论如何选择适合的 MySQL Connector/J 版本。</p><h3 id="1-MySQL-服务器版本">1. MySQL 服务器版本</h3><p>如果你的 MySQL 服务器版本为 8.0，甚至已经在用 MySQL 8.3，建议选择 MySQL Connector/J 8.3。</p><p>如果你的 MySQL 服务器版本为 5.5，5.6，5.7，或 8.0，可以选择 MySQL Connector/J 5.1，需要注意的是，对于 MySQL 5.7 服务器，需要选择 MySQL Connector/J 5.1.37 及以上版本。</p><p>另外，MySQL 5.5,5.6,5.7 已经 EOL，建议升级到 MySQL 8.0 最新小版本，即 MySQL 8.0.35 或 8.0.36。</p><p>如果你的 MySQL 服务器版本为更古早的版本，you would better keep it with current setting.</p><p>确保所选的驱动版本与你的 MySQL 服务器版本兼容，以避免连接或性能问题。</p><h3 id="2-Java-版本">2. Java 版本</h3><p>MySQL Connector/J 8.3 支持 JRE/JDK 8 及以上版本。</p><p>MySQL Connector/J 5.1 支持 JRE/JDK 5 及以上版本。</p><p>如果你的项目用到了 Java，那么应该选择 JDK 8 及以上版本。</p><h3 id="3-JDBC-API">3. JDBC API</h3><p>JDBC（Java Database Connectivity）API 版本也可以作为选择驱动时的考虑因素。</p><p>MySQL Connector/J 8.3 支持 JDBC 4.2 API。</p><p>MySQL Connector/J 5.1 从 5.1.37 版本开始支持 JDBC 4.2 API。</p><h3 id="4-TLS-版本">4. TLS 版本</h3><p>对于 TLS v1.3，从 MySQL Connector/J 8.0.19 以及 MySQL 8.0.16 开始支持，需要注意的是，从 MySQL 8.0.18 开始，组复制支持 TLS v1.3。</p><p>对于 TLS v1.2，从 MySQL Connector/J 5.1.46 以及 MySQL 5.7.28/8.0.4 开始支持。</p><p>对于 TLSv1 和 TLSv1.1，从 MySQL Connector/J 8.0.26 开始被废弃，并从 MySQL Connector/J 8.0.28 被移除。</p><p>此外，还需注意，TLS 需要 Java 版本支持。如果你需要使用 TLS v1.3，那么需要搭配更高版本的 JDK 8，比如 Oracle Java 8u261。从 Java 11 开始，JDK 默认支持 TLSv1.3。</p><p>当然，也需要更新版本的 openssl，比如，当使用 TLS v1.3 时，需要 openssl 1.1.1。</p><h3 id="5-特性支持">5. 特性支持</h3><p>MySQL Connector/J 的不同版本提供了不同的特性和支持。例如，MySQL Connector/J 8.x 版本提供了对 MySQL 8.0 新特性的支持，如窗口函数、公共表表达式（CTE）、角色权限等。此外，新版本还包含性能改进、错误修复和安全更新。</p><h3 id="6-生命周期">6. 生命周期</h3><p>对于 MySQL Server 而言，由于发版模型发生了变化，MySQL 8.0 已不再追加新特性，目前已经发布了 MySQL 8.1.0，8.2.0 和 8.3.0 三个创新版本（Innovation Release），期待 MySQL 8.4.0 LTS 的到来。</p><p>不过，MySQL Connector/J 并不遵循此发版模型，而是继承、延续为 8.x 系列 GA 版本。</p><p>MySQL Connector/J 8.1 取代了 8.0 系列，最后一个 8.0 系列的版本为 8.0.33。</p><h2 id="总结">总结</h2><p>建议使用最新版本的 MySQL Connector/J，以获得更好的安全性和兼容性。</p><p>目前，推荐使用 MySQL Connector/J 8.3.0。</p><h2 id="附">附</h2><ul><li>Maven 配置为：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.3.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div><ul><li>Gradle 配置为：</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation group: &#x27;com.mysql&#x27;, name: &#x27;mysql-connector-j&#x27;, version: &#x27;8.3.0&#x27;</span><br></pre></td></tr></table></figure></div><ul><li>官方下载地址：<a class="link"   href="https://dev.mysql.com/downloads/connector/j/" >https://dev.mysql.com/downloads/connector/j/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>墨天轮下载地址：<a class="link"   href="https://www.modb.pro/doc/125743" >https://www.modb.pro/doc/125743 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;mysql_girl.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https:/</summary>
      
    
    
    
    <category term="MySQL" scheme="https://shawnyan.cn/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="jdbc" scheme="https://shawnyan.cn/tags/jdbc/"/>
    
    <category term="connector" scheme="https://shawnyan.cn/tags/connector/"/>
    
  </entry>
  
  <entry>
    <title>如何快速安装、使用 GBase 8s 数据库</title>
    <link href="https://shawnyan.cn/2024/gbase/gbase-8s-v8-install/"/>
    <id>https://shawnyan.cn/2024/gbase/gbase-8s-v8-install/</id>
    <published>2024-02-21T15:51:55.000Z</published>
    <updated>2024-02-21T15:51:55.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0-GBase-8s-介绍">0. GBase 8s 介绍</h2><p>GBase 8s 是天津南大通用数据技术股份有限公司自主研发、支持共享存储集群、两地三中心部署的、成熟稳定的百T金融级事务型国产数据库，拥有自主知识产权。支持集中式部署、共享存储高可用部署、支持两地三中心高可用部署，具备高容量、高并发、高性能等特性。</p><p>GBase 8s 适用于 OLTP 应用场景，包括金融、电信行业的关键核心业务系统，安全、党政、国防等行业对信息安全性有较高要求的信息系统，以及大型企业的经营类、管理类信息系统。能够提供 7*24 小时不间断运行处理能力，在 80% 以上场景中可以替代国际主流数据库。</p><h2 id="1-安装-GBase-8s">1. 安装 GBase 8s</h2><p>本文主要介绍 GBase 8s V8.8（兼容Oracle）产品的单机安装及基础用法。</p><p>从 GBase 官网下载 GBase 8s V8.8（兼容Oracle）安装包，本文使用的是 CentOS 7.9 系统，所以这里选择【GBase8sV8.8_TL_3.5.1_x86.7z】安装包。</p><p>安装包下载地址为：<a class="link"   href="https://www.gbase.cn/download/gbase-8s-1?category=INSTALL_PACKAGE" >https://www.gbase.cn/download/gbase-8s-1?category=INSTALL_PACKAGE <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>提示：这里需要安装 <code>p7zip</code> 依赖，用来解压安装包。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y p7zip</span><br><span class="line">7za e GBase8sV8.8_TL_3.5.1_x86.7z</span><br></pre></td></tr></table></figure></div><p>解压完成后，输出如下：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan gbase]# ls</span><br><span class="line">clientsdk_3.5.1_x86.tar  GBase8sV8.8_TL_3.5.1_x86.7z  GBase8sV8.8_TL_3.5.1_x86.tar  GBaseInit_gbasedbt.sh</span><br></pre></td></tr></table></figure></div><p>继续解压【GBase8sV8.8_TL_3.5.1_x86.tar】：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan gbase]# tar xvf GBase8sV8.8_TL_3.5.1_x86.tar</span><br><span class="line">ids_install</span><br><span class="line">onsecurity</span><br><span class="line">doc/</span><br><span class="line">doc/ids_machine_notes_12.10.txt</span><br><span class="line">doc/ids_unix_relnotes_12.10.html</span><br><span class="line">ids.properties</span><br><span class="line">.gbase.properties</span><br></pre></td></tr></table></figure></div><p>创建 <code>gbasedbt</code> 用户。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd gbasedbt</span><br><span class="line">useradd -g gbasedbt gbasedbt</span><br></pre></td></tr></table></figure></div><p>创建安装目录，并授权。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -pv /opt/GBASE/gbase</span><br><span class="line">chown gbasedbt:gbasedbt -R /opt/GBASE</span><br></pre></td></tr></table></figure></div><p>GBase 8s 一般有三种安装方式：</p><ol><li>swing 图形化安装</li><li>console 控制台安装</li><li>silent 静默化安装</li></ol><p>除此之外，还可以选择使用“GEM安装配置管理平台”进行安装。</p><p>这里使用 console 控制台方式进行安装 GBase 8s。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan gbase]# ./ids_install </span><br><span class="line">...</span><br><span class="line">===============================================================================</span><br><span class="line">GBase Software Bundle                            (created with InstallAnywhere)</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Preparing CONSOLE Mode Installation...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">DO YOU ACCEPT THE TERMS OF THIS LICENSE AGREEMENT? (Y/N): Y</span><br><span class="line">...</span><br><span class="line">  Default Install Folder: /opt/GBASE/gbase</span><br><span class="line">...</span><br><span class="line">-- 约 5 分钟</span><br><span class="line">...</span><br><span class="line">Installation Complete</span><br><span class="line">---------------------</span><br><span class="line"></span><br><span class="line">Congratulations! GBase Software Bundle installation is complete.</span><br><span class="line"></span><br><span class="line">Product install status:</span><br><span class="line">GBase: Successful</span><br><span class="line">GBase Connect: Successful</span><br><span class="line"></span><br><span class="line">GBase 8s V8.8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">For more information about using GBase products, see the GBase Information </span><br><span class="line">Center at http://www.gbase.cn.</span><br></pre></td></tr></table></figure></div><p>设定环境变量。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan gbase]# cd /opt/GBASE/gbase</span><br><span class="line">[root@shawnyan gbase]# cat ol_gbasedbt1210.ksh &gt;&gt; /home/gbasedbt/.bash_profile </span><br><span class="line">[root@shawnyan gbase]# su - gbasedbt</span><br><span class="line">[gbasedbt@shawnyan ~]$ env | grep GBASEDB</span><br><span class="line">GBASEDBTSQLHOSTS=/opt/GBASE/gbase/etc/sqlhosts.gbaseserver</span><br><span class="line">GBASEDBTSERVER=gbaseserver</span><br><span class="line">GBASEDBTDIR=/opt/GBASE/gbase</span><br></pre></td></tr></table></figure></div><p>安装完成后，服务已经启动。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~]# ps auxf | grep oninit | grep -v grep</span><br><span class="line">gbasedbt  25086  0.0  1.6 358012 131144 ?       S&lt;   12:06   0:00 /opt/GBASE/gbase/bin/oninit -ivwy</span><br><span class="line">root      25087  0.0  0.0 358012  5100 ?        S&lt;   12:06   0:00  \_ /opt/GBASE/gbase/bin/oninit -ivwy</span><br><span class="line">root      25088  0.0  0.0 358012  4456 ?        S&lt;   12:06   0:00      \_ /opt/GBASE/gbase/bin/oninit -ivwy</span><br><span class="line">root      25089  0.0  0.0 358012  4448 ?        S&lt;   12:06   0:00      \_ /opt/GBASE/gbase/bin/oninit -ivwy</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><h2 id="2-GBase-8s-管理命令">2. GBase 8s 管理命令</h2><p>启动服务。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan ~]$ oninit -vy</span><br><span class="line">Reading configuration file &#x27;/opt/GBASE/gbase/etc/onconfig.ol_gbasedbt1210&#x27;...succeeded</span><br><span class="line">...</span><br><span class="line">Verbose output complete: mode = 5</span><br></pre></td></tr></table></figure></div><p>停止服务。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan ~]$ onmode -ky</span><br><span class="line">Your evaluation license will expire on 2025-02-20 00:00:00</span><br></pre></td></tr></table></figure></div><p>查看版本。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan ~]$ gstat -version</span><br><span class="line">GBase 8s V8.8</span><br></pre></td></tr></table></figure></div><p>查看状态和启动时间。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan ~]$ onstat -</span><br><span class="line">Your evaluation license will expire on 2025-02-20 00:00:00</span><br><span class="line">On-Line -- Up 03:26:35 -- 175748 Kbytes</span><br></pre></td></tr></table></figure></div><h2 id="3-GBase-8s-创建实例">3. GBase 8s 创建实例</h2><p>创建实例，这里依据提示选择默认值。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan gbase]$ cd etc/</span><br><span class="line">[gbasedbt@shawnyan etc]$ ./GBaseInit_gbasedbt.sh </span><br><span class="line">...</span><br><span class="line">INSTANCE SUMMARY:</span><br><span class="line">  Instance name:               gbaseserver</span><br><span class="line">  GBase install directory:     /opt/GBASE/gbase</span><br><span class="line">  IP address &amp; port:           192.168.8.161:9088</span><br><span class="line">  Character set:               en_US.819</span><br><span class="line">  Logical log space size:      840 MB</span><br><span class="line">  Physical log space size:     840 MB</span><br><span class="line">  Smart LOB space size:        198 MB</span><br><span class="line">  Temp DBSpace size:           198 MB</span><br><span class="line">  Data path:                   /opt/GBASE/gbase/gbaseserver_dbs</span><br><span class="line">  Data path free size:         8408 MB</span><br><span class="line">...</span><br><span class="line">Creating database: gbasedb...OK</span><br><span class="line"></span><br><span class="line">Now you can use this URL to connect to gbasedb:</span><br><span class="line">jdbc:gbasedbt-sqli://192.168.8.161:9088/gbasedb:GBASEDBTSERVER=gbaseserver;</span><br><span class="line"></span><br><span class="line">Version:</span><br><span class="line">Your evaluation license will expire on 2025-02-20 00:00:00</span><br><span class="line">On-Line -- Up 00:00:16 -- 4275148 Kbytes</span><br><span class="line">Build Number:3.5.1_3_6a4e30</span><br><span class="line"></span><br><span class="line">GBase Initializing Finished!</span><br></pre></td></tr></table></figure></div><h2 id="4-连接到-GBase-8s-数据库">4. 连接到 GBase 8s 数据库</h2><p><code>dbaccess</code> 是 GBase 8s 数据库的一个命令行客户端工具，用来与 GBase 8s 数据库服务器进行交互。</p><p>提示，这里可以安装 <code>rlwrap</code> 工具以提供历史记录和补全功能。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y rlwrap</span><br><span class="line">alias dbaccess=&#x27;rlwrap dbaccess&#x27;</span><br></pre></td></tr></table></figure></div><p>使用 <code>dbaccess</code> 连接数据库，并查看数据库版本信息。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[gbasedbt@shawnyan bin]$ dbaccess - -</span><br><span class="line">Your evaluation license will expire on 2025-02-20 00:00:00</span><br><span class="line">&gt; select dbinfo(&#x27;version_gbase&#x27;,&#x27;full&#x27;) from dual;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(constant)                    </span><br><span class="line"></span><br><span class="line">GBase8sV8.8_TL_3.5.1_3_6a4e30</span><br><span class="line"></span><br><span class="line">1 row(s) retrieved.</span><br></pre></td></tr></table></figure></div><h2 id="5-切换到-Oracle-兼容模式">5. 切换到 Oracle 兼容模式</h2><p>命令行工具切换到 Oracle 兼容模式。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set environment sqlmode &#x27;oracle&#x27;;</span><br></pre></td></tr></table></figure></div><p>使用 JDBC 连接到 GBase 8s 时，需要在连接串增加 <code>sqlmode=oracle</code> 选项来开启 Oracle 兼容模式。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:gbasedbt-sqli://192.168.8.161:9088/gbasedb:GBASEDBTSERVER=gbaseserver;sqlmode=oracle</span><br></pre></td></tr></table></figure></div><h2 id="6-简单的-CRUD-示例">6. 简单的 CRUD 示例</h2><p>切换到新创建的 <code>gbasedb</code> 数据库。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; database gbasedb;</span><br><span class="line"></span><br><span class="line">Database selected.</span><br></pre></td></tr></table></figure></div><p>创建一张表，并进行数据插入和查询。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; create table t1 (id int, user varchar(50));</span><br><span class="line"></span><br><span class="line">Table created.</span><br><span class="line"></span><br><span class="line">&gt; insert into t1 values (1,&#x27;shawnyan&#x27;);</span><br><span class="line"></span><br><span class="line">1 row(s) inserted.</span><br><span class="line"></span><br><span class="line">&gt; select * from t1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         id user                                               </span><br><span class="line"></span><br><span class="line">          1 shawnyan                                          </span><br><span class="line"></span><br><span class="line">1 row(s) retrieved.</span><br></pre></td></tr></table></figure></div><p>到此，GBase 8s 基础安装及功能演示告一段落。</p><hr><p>如果想更深入地了解 GBase 8s，欢迎关注<a class="link"   href="https://www.gbase.cn/training-activities/17" >GBase 8s 认证培训 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0-GBase-8s-介绍&quot;&gt;0. GBase 8s 介绍&lt;/h2&gt;
&lt;p&gt;GBase 8s 是天津南大通用数据技术股份有限公司自主研发、支持共享存储集群、两地三中心部署的、成熟稳定的百T金融级事务型国产数据库，拥有自主知识产权。支持集中式部署、共享存储高可用部署</summary>
      
    
    
    
    <category term="GBase" scheme="https://shawnyan.cn/categories/gbase/"/>
    
    <category term="GBase 8s" scheme="https://shawnyan.cn/categories/gbase/gbase-8s/"/>
    
    
    <category term="gbase" scheme="https://shawnyan.cn/tags/gbase/"/>
    
    <category term="南大通用" scheme="https://shawnyan.cn/tags/%E5%8D%97%E5%A4%A7%E9%80%9A%E7%94%A8/"/>
    
    <category term="gbase 8s" scheme="https://shawnyan.cn/tags/gbase-8s/"/>
    
  </entry>
  
  <entry>
    <title>PG Style! 盘点几个常用的 Postgres 环境变量</title>
    <link href="https://shawnyan.cn/2024/postgresql/pg-env-vars/"/>
    <id>https://shawnyan.cn/2024/postgresql/pg-env-vars/</id>
    <published>2024-02-17T04:00:00.000Z</published>
    <updated>2024-02-17T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>PostgreSQL 是一个功能强大的开源对象关系数据库系统，它使用并扩展了 SQL 语言，并结合了许多功能，可以安全地存储和扩展最复杂的数据工作负载。PostgreSQL 的起源可以追溯到 1986 年，作为加州大学伯克利分校 POSTGRES 项目的一部分，并且在核心平台上拥有超过 35 年的积极开发经验。PostgreSQL 因其经过验证的架构、可靠性、数据完整性、强大的功能集、可扩展性以及软件背后的开源社区始终如一地提供高性能和创新解决方案的奉献精神而赢得了良好的声誉。PostgreSQL 可在所有主要操作系统上运行，自 2001 年以来一直符合 ACID 标准，并具有强大的附加组件，例如流行的 PostGIS 地理空间数据库扩展器。毫不奇怪，PostgreSQL 已成为许多人和组织选择的开源关系数据库。</p><p>PostgreSQL 除了其强大的功能外，还支持许多环境变量，这些环境变量可以通过在命令行中设置或在启动脚本中设置来使用，以控制其行为。了解这些环境变量可以帮助 DBA 更好地管理 PostgreSQL 数据库。</p><p>接下来，我们来介绍几个常用的Postgres环境变量。</p><h2 id="1-PGHOST">1. PGHOST</h2><p>指定 PostgreSQL 服务器的主机名或 IP 地址。它通常用于客户端工具，如psql，以指定要连接的数据库服务器的位置。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ export PGHOST=192.168.8.151</span><br><span class="line">[postgres@shawnyan ~]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(postgres@192) [postgres] 10:19:34# \conninfo</span><br><span class="line">You are connected to database &quot;postgres&quot; as user &quot;postgres&quot; on host &quot;192.168.8.151&quot; at port &quot;5432&quot;.</span><br></pre></td></tr></table></figure></div><h2 id="2-PGPORT">2. PGPORT</h2><p>指定 PostgreSQL 服务器的端口号。默认端口为5432，但是如果我们将其更改为其他端口，可以在PGPORT环境变量中指定相应的端口号。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ export PGPORT=6666</span><br><span class="line">[postgres@shawnyan ~]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(postgres@192) [postgres] 10:21:30# \conninfo</span><br><span class="line">You are connected to database &quot;postgres&quot; as user &quot;postgres&quot; on host &quot;192.168.8.151&quot; at port &quot;6666&quot;.</span><br></pre></td></tr></table></figure></div><h2 id="3-PGDATABASE">3. PGDATABASE</h2><p>指定连接到的数据库名称。例如，我们可以设置PGDATABASE为&quot;shawnyan&quot;，表示连接到名为&quot;shawnyan&quot;的数据库。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ export PGDATABASE=shawnyan</span><br><span class="line">[postgres@shawnyan ~]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(postgres@192) [shawnyan] 10:22:30# \conninfo</span><br><span class="line">You are connected to database &quot;shawnyan&quot; as user &quot;postgres&quot; on host &quot;192.168.8.151&quot; at port &quot;6666&quot;.</span><br></pre></td></tr></table></figure></div><h2 id="4-PGUSER">4. PGUSER</h2><p>指定连接到 PostgreSQL 的用户名。例如，我们可以设置PGUSER为&quot;shawnyan&quot;，表示使用&quot;shawnyan&quot;用户连接到PostgreSQL。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ export PGUSER=shawnyan</span><br><span class="line">[postgres@shawnyan ~]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(shawnyan@192) [shawnyan] 10:26:41# \conninfo</span><br><span class="line">You are connected to database &quot;shawnyan&quot; as user &quot;shawnyan&quot; on host &quot;192.168.8.151&quot; at port &quot;6666&quot;.</span><br></pre></td></tr></table></figure></div><h2 id="5-PGPASSWORD">5. PGPASSWORD</h2><p>指定连接到 PostgreSQL 的密码。出于安全考虑，建议仅在脚本或命令行中临时使用此环境变量，而不是在配置文件或脚本中硬编码密码。例如，我们可以设置PGPASSWORD为&quot;shawnyan&quot;，表示使用&quot;shawnyan&quot;密码连接到PostgreSQL。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan data]$ psql</span><br><span class="line">Password for user shawnyan: </span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(shawnyan@192) [shawnyan] 10:29:18# \q</span><br><span class="line">[postgres@shawnyan data]$ export PGPASSWORD=shawnyan</span><br><span class="line">[postgres@shawnyan data]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(shawnyan@192) [shawnyan] 10:29:28# \conninfo</span><br><span class="line">You are connected to database &quot;shawnyan&quot; as user &quot;shawnyan&quot; on host &quot;192.168.8.151&quot; at port &quot;6666&quot;.</span><br></pre></td></tr></table></figure></div><h2 id="6-PGDATA">6. PGDATA</h2><p>指定 PostgreSQL 数据库的数据目录。例如，我们可以设置PGDATA为/var/lib/pgsql/15/data，如此在使用pg_ctl命令时，无需再次指定-D数据目录。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan data]$ unset PGDATA</span><br><span class="line">[postgres@shawnyan data]$ pg_ctl restart</span><br><span class="line">pg_ctl: no database directory specified and environment variable PGDATA unset</span><br><span class="line">Try &quot;pg_ctl --help&quot; for more information.</span><br><span class="line">[postgres@shawnyan data]$ pg_ctl restart -D /var/lib/pgsql/15/data</span><br><span class="line">waiting for server to shut down.... done</span><br><span class="line">server stopped</span><br><span class="line">waiting for server to start....2024-02-17 10:31:02.876 CST [17844] LOG:  redirecting log output to logging collector process</span><br><span class="line">2024-02-17 10:31:02.876 CST [17844] HINT:  Future log output will appear in directory &quot;log&quot;.</span><br><span class="line"> done</span><br><span class="line">server started</span><br><span class="line">[postgres@shawnyan data]$ export PGDATA=/var/lib/pgsql/15/data</span><br><span class="line">[postgres@shawnyan data]$ pg_ctl restart</span><br><span class="line">waiting for server to shut down.... done</span><br><span class="line">server stopped</span><br><span class="line">waiting for server to start....2024-02-17 10:31:18.632 CST [17866] LOG:  redirecting log output to logging collector process</span><br><span class="line">2024-02-17 10:31:18.632 CST [17866] HINT:  Future log output will appear in directory &quot;log&quot;.</span><br><span class="line"> done</span><br><span class="line">server started</span><br></pre></td></tr></table></figure></div><h2 id="7-PGCLIENTENCODING">7. PGCLIENTENCODING</h2><p>指定客户端编码。如果不指定，则默认选择服务器设定。例如，如果我们想使用UTF-8编码，可以将PGCLIENTENCODING设置为&quot;UTF8&quot;。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan log]$ export PGCLIENTENCODING=EUC_TW</span><br><span class="line">[postgres@shawnyan log]$ psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(shawnyan@192) [shawnyan] 10:52:24# show client_encoding ;</span><br><span class="line"> client_encoding </span><br><span class="line">-----------------</span><br><span class="line"> EUC_TW</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure></div><h2 id="8-PGOPTIONS">8. PGOPTIONS</h2><p>指定自定义设置选项。例如，运行回归测试套件时使用的自定义服务器设置可以在 PGOPTIONS 环境变量中设置。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make check PGOPTIONS=&quot;-c debug_parallel_query=regress -c work_mem=50MB&quot;</span><br></pre></td></tr></table></figure></div><p>再如，可以在启用新客户端会话时加入变量设置。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ env PGOPTIONS=&quot;-c statement_timeout=10s&quot; psql</span><br><span class="line">psql (15.2)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">(shawnyan@192) [shawnyan] 10:59:47# select pg_sleep(15);</span><br><span class="line">ERROR:  canceling statement due to statement timeout</span><br></pre></td></tr></table></figure></div><h2 id="9-PGDATESTYLE">9. PGDATESTYLE</h2><p>指定服务器端或客户端的日期格式环境变量，也可以使用PGTZ来改变日期显示的时区。例如，</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[postgres@shawnyan ~]$ psql -c &#x27;select now()&#x27;</span><br><span class="line">              now              </span><br><span class="line">-------------------------------</span><br><span class="line"> 2024-02-17 11:12:58.144437+08</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">[postgres@shawnyan ~]$ export PGDATESTYLE=&#x27;Postgres, MDY&#x27;</span><br><span class="line">[postgres@shawnyan ~]$ psql -c &#x27;select now()&#x27;</span><br><span class="line">                 now                 </span><br><span class="line">-------------------------------------</span><br><span class="line"> Sat Feb 17 11:13:03.115172 2024 CST</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">[postgres@shawnyan ~]$ export PGTZ=&#x27;PST8PDT&#x27;</span><br><span class="line">[postgres@shawnyan ~]$ psql -c &#x27;select now()&#x27;</span><br><span class="line">                 now                 </span><br><span class="line">-------------------------------------</span><br><span class="line"> Fri Feb 16 19:13:12.459388 2024 PST</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure></div><p>类似地，还有其他一些不太常用的环境变量，如：PGLOCALEDIR，PGSSLMODE，PGCONNECT_TIMEOUT，PGAPPNAME，PG_OOM_ADJUST_FILE，PG_OOM_ADJUST_VALUE，PG_REGRESS_DIFF_OPTS，这里不再一一介绍。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PostgreSQL 是一个功能强大的开源对象关系数据库系统，它使用并扩展了 SQL 语言，并结合了许多功能，可以安全地存储和扩展最复杂的数据工作负载。PostgreSQL 的起源可以追溯到 1986 年，作为加州大学伯克利分校 POSTGRES 项目的一部分，并且在核心平</summary>
      
    
    
    
    <category term="PostgreSQL" scheme="https://shawnyan.cn/categories/postgresql/"/>
    
    
    <category term="PostgreSQL" scheme="https://shawnyan.cn/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>IvorySQL 3.1 和 2.3 系统参数变化（下篇）</title>
    <link href="https://shawnyan.cn/2024/postgresql/ivorysql-3.1-sys-vars-2/"/>
    <id>https://shawnyan.cn/2024/postgresql/ivorysql-3.1-sys-vars-2/</id>
    <published>2024-02-07T12:26:48.000Z</published>
    <updated>2024-02-07T12:26:48.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="ivorysql.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240207-d856ff9f-5e9e-474b-b5c0-0ff3718eb5c8.png"                      referrerpolicy="no-referrer"                ><h2 id="前情提要">前情提要</h2><p>在<a class="link"   href="https://mp.weixin.qq.com/s/UeX8mz2nFQ6rFvHKQZJoCQ" >上篇文章 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 中，我们介绍了 IvorySQL 3.1 和 2.3 系统参数有哪些删减和默认值变更，本文将介绍 23 个新增参数。</p><h2 id="新增参数">新增参数</h2><p>新增参数一览如下，共 23 个。</p><ul><li>4 个安全相关<ol><li>createrole_self_grant</li><li>gss_accept_delegation</li><li>reserved_connections</li><li>scram_iterations</li></ol></li><li>5 个开发选项<ol><li>debug_io_direct</li><li>debug_logical_replication_streaming</li><li>debug_parallel_query</li><li>send_abort_for_crash</li><li>send_abort_for_kill</li></ol></li><li>1 个优化器相关<ol><li>enable_presorted_aggregate</li></ol></li><li>1 个语言相关<ol><li>icu_validation_level</li></ol></li><li>1 个复制相关<ol><li>max_parallel_apply_workers_per_subscription</li></ol></li><li>1 个资源相关<ol><li>vacuum_buffer_usage_limit</li></ol></li><li>10 个兼容性相关<ol><li>nls_date_format</li><li>nls_timestamp_format</li><li>nls_timestamp_tz_format</li><li>ivorysql.compatible_mode</li><li>ivorysql.database_mode</li><li>ivorysql.datetime_ignore_nls_mask</li><li>ivorysql.enable_emptystring_to_NULL</li><li>ivorysql.identifier_case_switch</li><li>ivorysql.listen_addresses</li><li>ivorysql.port</li></ol></li></ul><p>接下来我们逐一介绍。</p><h3 id="1-createrole-self-grant">1. createrole_self_grant</h3><p>​<br>如果具有 <code>CREATEROLE</code> 但没有 <code>SUPERUSER</code> 的用户创建角色，并且将其设置为非空值，则新创建的角色将被授予具有指定选项的创建用户。该值必须是设置的、继承的或以逗号分隔的列表。默认值为空字符串，这会禁用该功能。</p><p>此选项的目的是允许非超级用户的 <code>CREATEROLE</code> 用户自动继承或自动获得对任何创建的用户设置 <code>ROLE</code> 的能力。由于 CREATEROLE 用户始终在创建的角色上隐式授予 <code>ADMIN OPTION</code>，因此该用户始终可以执行 <code>GRANT</code> 语句来实现与此设置相同的效果。但是，如果自动授予，出于可用性原因，可能会很方便。超级用户自动继承每个角色的权限，并且始终可以为任何角色设置 <code>ROLE</code>，并且此设置可用于为 <code>CREATEROLE</code> 用户创建的用户产生类似的行为。</p><p>用法示例如下：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql<span class="variable">@shawnyan</span> <span class="operator">~</span>]$ psql</span><br><span class="line">psql (<span class="number">16.1</span><span class="operator">-</span>ShawnYan)</span><br><span class="line">Type &quot;help&quot; <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> createrole_self_grant;</span><br><span class="line"> createrole_self_grant</span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">CREATE</span> <span class="keyword">USER</span> shawnyan_user_1 CREATEROLE NOINHERIT;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE</span><br><span class="line">ivorysql<span class="operator">=</span># \c <span class="operator">-</span> shawnyan_user_1</span><br><span class="line">You <span class="keyword">are</span> now connected <span class="keyword">to</span> database &quot;postgres&quot; <span class="keyword">as</span> <span class="keyword">user</span> &quot;shawnyan_user_1&quot;.</span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">USER</span> shawnyan_tenant_1;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE</span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">SET</span> createrole_self_grant <span class="operator">=</span> <span class="string">&#x27;set, inherit&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">SET</span> ROLE shawnyan_user_1;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> roleid::regrole, <span class="keyword">member</span>::regrole, grantor::regrole, <span class="operator">*</span> <span class="keyword">FROM</span> pg_auth_members;</span><br><span class="line">        roleid        <span class="operator">|</span>     <span class="keyword">member</span>      <span class="operator">|</span> grantor  <span class="operator">|</span>  oid  <span class="operator">|</span> roleid <span class="operator">|</span> <span class="keyword">member</span> <span class="operator">|</span> grantor <span class="operator">|</span> admin_option <span class="operator">|</span> inherit_option <span class="operator">|</span> set_option</span><br><span class="line"><span class="comment">----------------------+-----------------+----------+-------+--------+--------+---------+--------------+----------------+------------</span></span><br><span class="line">...</span><br><span class="line"> shawnyan_tenant_1    <span class="operator">|</span> shawnyan_user_1 <span class="operator">|</span> ivorysql <span class="operator">|</span> <span class="number">16398</span> <span class="operator">|</span>  <span class="number">16397</span> <span class="operator">|</span>  <span class="number">16396</span> <span class="operator">|</span>      <span class="number">10</span> <span class="operator">|</span> t            <span class="operator">|</span> f              <span class="operator">|</span> f</span><br><span class="line">(<span class="number">4</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> \c <span class="operator">-</span> shawnyan_user_1</span><br><span class="line">You <span class="keyword">are</span> now connected <span class="keyword">to</span> database &quot;ivorysql&quot; <span class="keyword">as</span> <span class="keyword">user</span> &quot;shawnyan_user_1&quot;.</span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">SET</span> createrole_self_grant <span class="operator">=</span> <span class="string">&#x27;set, inherit&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">USER</span> shawnyan_tenant_2;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE</span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> roleid::regrole, <span class="keyword">member</span>::regrole, grantor::regrole, <span class="operator">*</span> <span class="keyword">FROM</span> pg_auth_members;</span><br><span class="line">        roleid        <span class="operator">|</span>     <span class="keyword">member</span>      <span class="operator">|</span>     grantor     <span class="operator">|</span>  oid  <span class="operator">|</span> roleid <span class="operator">|</span> <span class="keyword">member</span> <span class="operator">|</span> grantor <span class="operator">|</span> admin_option <span class="operator">|</span> inherit_option <span class="operator">|</span> set_option</span><br><span class="line"><span class="comment">----------------------+-----------------+-----------------+-------+--------+--------+---------+--------------+----------------+------------</span></span><br><span class="line">...</span><br><span class="line"> shawnyan_tenant_1    <span class="operator">|</span> shawnyan_user_1 <span class="operator">|</span> ivorysql        <span class="operator">|</span> <span class="number">16398</span> <span class="operator">|</span>  <span class="number">16397</span> <span class="operator">|</span>  <span class="number">16396</span> <span class="operator">|</span>      <span class="number">10</span> <span class="operator">|</span> t            <span class="operator">|</span> f              <span class="operator">|</span> f</span><br><span class="line"> shawnyan_tenant_2    <span class="operator">|</span> shawnyan_user_1 <span class="operator">|</span> ivorysql        <span class="operator">|</span> <span class="number">16400</span> <span class="operator">|</span>  <span class="number">16399</span> <span class="operator">|</span>  <span class="number">16396</span> <span class="operator">|</span>      <span class="number">10</span> <span class="operator">|</span> t            <span class="operator">|</span> f              <span class="operator">|</span> f</span><br><span class="line"> shawnyan_tenant_2    <span class="operator">|</span> shawnyan_user_1 <span class="operator">|</span> shawnyan_user_1 <span class="operator">|</span> <span class="number">16401</span> <span class="operator">|</span>  <span class="number">16399</span> <span class="operator">|</span>  <span class="number">16396</span> <span class="operator">|</span>   <span class="number">16396</span> <span class="operator">|</span> f            <span class="operator">|</span> t              <span class="operator">|</span> t</span><br><span class="line">(<span class="number">6</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">show</span> createrole_self_grant;</span><br><span class="line"> createrole_self_grant</span><br><span class="line"><span class="comment">-----------------------</span></span><br><span class="line"> <span class="keyword">set</span>, inherit</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure></div><h3 id="2-gss-accept-delegation">2. gss_accept_delegation</h3><p>添加对 Kerberos 凭证委托的支持。</p><p>这可以通过服务器变量 <code>gss_accept_delegation</code> 和 libpq 连接参数 <code>gssdelegation</code> 来启用。</p><p>默认值为 <code>off</code>，这意味着不接受来自客户端的凭据。</p><h3 id="3-reserved-connections">3. reserved_connections</h3><p>确定具有 <code>pg_use_reserved_connections</code> 角色权限的角色为连接保留的连接“插槽”的数量。当空闲连接槽的数量大于 <code>superuser_reserved_connections</code>，但小于或等于 <code>superuser_reserved_connections</code> 和 <code>reserved_connections</code> 的总和时，新的连接将只被超级用户和具有 <code>pg_use_reserved_connections</code> 权限的角色接受。如果 <code>superuser_reserved_connections</code> 或更少的连接槽可用，则只接受超级用户的新连接。</p><p>缺省值为零连接。该值必须小于 <code>max_connections</code> 减去 <code>superuser_reserved_connections</code>。该参数只能在服务器启动时设置。</p><p>关联参数： <code>superuser_reserved_connections</code><br>关联角色： <code>pg_use_reserved_connections</code></p><h3 id="4-scram-iterations">4. scram_iterations</h3><p>允许使用服务器变量 <code>scram_iterations</code> 设置 SCRAM 迭代计数。<br>使用 SCRAM-SHA-256 加密密码时要执行的计算迭代次数。</p><h3 id="5-debug-io-direct">5. debug_io_direct</h3><p>从 IvorySQL 3 开始，新增 3 个用于开发调试的参数，<code>debug_io_direct</code>，<code>debug_logical_replication_streaming</code> 和 <code>debug_parallel_query</code>。</p><p>可以设置为空字符串(默认值)以禁用直接 I/O，或者应该使用直接 I/O 的逗号分隔的操作列表。</p><p>目前，该特性降低了性能，并且仅用于开发人员测试。</p><h3 id="6-debug-logical-replication-streaming">6. debug_logical_replication_streaming</h3><p>在逻辑复制中，添加服务器变量以控制逻辑解码发布者如何传输更改以及订阅者如何应用更改。</p><p>默认值为 <code>buffered</code>，还可选 <code>immediate</code>。</p><h3 id="7-debug-parallel-query">7. debug_parallel_query</h3><p>上篇文章提及过，该参数由 <code>force_parallel_mode</code> 更名而来。</p><p><code>debug_parallel_query</code> 允许的值是 <code>off</code>(仅在期望提高性能时使用并行模式)、<code>on</code>(对所有被认为是安全的查询强制并行查询)和<code>regress</code>(类似于 on，但会有例外行为)。</p><h3 id="8-send-abort-for-crash">8. send_abort_for_crash</h3><p>允许 postmaster 用中止信号终止子进程。</p><p>这允许为卡住的子进程收集核心转储 (core dump)。这是由 <code>send_abort_for_crash</code> 和 <code>send_abort_for_kill</code> 控制的。postmaster 的 <code>-T</code> 开关现在与设置 <code>send_abort_for_crash</code> 相同。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql@shawnyan bin]$ postgres --help | grep &#x27;\-T&#x27;</span><br><span class="line">  -T                 send SIGABRT to all backend processes if one dies</span><br></pre></td></tr></table></figure></div><h3 id="9-send-abort-for-kill">9. send_abort_for_kill</h3><p>同上。</p><p>区别在于 <code>send_abort_for_crash</code> 发送的是 SIGABRT，而 <code>send_abort_for_kill</code> 发送的是 SIGKILL。</p><h3 id="10-enable-presorted-aggregate">10. enable_presorted_aggregate</h3><p>优化器中为具有 <code>ORDER BY</code> 或 <code>DISTINCT</code> 的聚合添加使用预排序数据的能力，默认开启，通过该参数可将其关闭。</p><p>示例：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">create</span> <span class="keyword">table</span> t(id <span class="type">int</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># explain <span class="keyword">select</span> <span class="built_in">sum</span>(id <span class="keyword">order</span> <span class="keyword">by</span> id) <span class="keyword">from</span> t;</span><br><span class="line">                           QUERY PLAN</span><br><span class="line"><span class="comment">-----------------------------------------------------------------</span></span><br><span class="line"> Aggregate  (cost<span class="operator">=</span><span class="number">192.53</span>.<span class="number">.192</span><span class="number">.54</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">1</span> width<span class="operator">=</span><span class="number">8</span>)</span><br><span class="line">   <span class="operator">-</span><span class="operator">&gt;</span>  Sort  (cost<span class="operator">=</span><span class="number">179.78</span>.<span class="number">.186</span><span class="number">.16</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">2550</span> width<span class="operator">=</span><span class="number">4</span>)</span><br><span class="line">         Sort Key: id</span><br><span class="line">         <span class="operator">-</span><span class="operator">&gt;</span>  Seq Scan <span class="keyword">on</span> t  (cost<span class="operator">=</span><span class="number">0.00</span>.<span class="number">.35</span><span class="number">.50</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">2550</span> width<span class="operator">=</span><span class="number">4</span>)</span><br><span class="line">(<span class="number">4</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">set</span> enable_presorted_aggregate <span class="keyword">to</span> off;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span># explain <span class="keyword">select</span> <span class="built_in">sum</span>(id <span class="keyword">order</span> <span class="keyword">by</span> id) <span class="keyword">from</span> t;</span><br><span class="line">                        QUERY PLAN</span><br><span class="line"><span class="comment">-----------------------------------------------------------</span></span><br><span class="line"> Aggregate  (cost<span class="operator">=</span><span class="number">41.88</span>.<span class="number">.41</span><span class="number">.88</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">1</span> width<span class="operator">=</span><span class="number">8</span>)</span><br><span class="line">   <span class="operator">-</span><span class="operator">&gt;</span>  Seq Scan <span class="keyword">on</span> t  (cost<span class="operator">=</span><span class="number">0.00</span>.<span class="number">.35</span><span class="number">.50</span> <span class="keyword">rows</span><span class="operator">=</span><span class="number">2550</span> width<span class="operator">=</span><span class="number">4</span>)</span><br><span class="line">(<span class="number">2</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure></div><h3 id="11-icu-validation-level">11. icu_validation_level</h3><p>当遇到 ICU 语言环境验证问题时，控制使用哪个消息级别来报告问题。</p><p>如果设置为 <code>DISABLED</code> 则不报告验证问题。默认值是 <code>WARNING</code>。</p><p>示例：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">CREATE</span> <span class="keyword">COLLATION</span> nonsense (provider <span class="operator">=</span> icu, locale <span class="operator">=</span> <span class="string">&#x27;nonsense&#x27;</span>);</span><br><span class="line">WARNING:  ICU locale &quot;nonsense&quot; has <span class="literal">unknown</span> <span class="keyword">language</span> &quot;nonsense&quot;</span><br><span class="line">HINT:  <span class="keyword">To</span> disable ICU locale validation, <span class="keyword">set</span> the <span class="keyword">parameter</span> &quot;icu_validation_level&quot; <span class="keyword">to</span> &quot;disabled&quot;.</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">COLLATION</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">set</span> icu_validation_level <span class="keyword">to</span> disabled;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">CREATE</span> <span class="keyword">COLLATION</span> nonsense1 (provider <span class="operator">=</span> icu, locale <span class="operator">=</span> <span class="string">&#x27;nonsense&#x27;</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">COLLATION</span></span><br></pre></td></tr></table></figure></div><h3 id="12-max-parallel-apply-workers-per-subscription">12. max_parallel_apply_workers_per_subscription</h3><p>每次订阅的最大并行应用程序工作者数。该参数通过订阅参数 <code>streaming = parallel</code> 控制正在进行的事务流的并行度。</p><p>并行应用程序是从 <code>max_logical_replication_workers</code> 定义的池中获取的。</p><p>默认值为 2。此参数只能在 postgresql.conf 文件或服务器命令行中设置。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> max_parallel_apply_workers_per_subscription <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span></span><br><span class="line">...</span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> max_parallel_apply_workers_per_subscription;</span><br><span class="line"> max_parallel_apply_workers_per_subscription</span><br><span class="line"><span class="comment">---------------------------------------------</span></span><br><span class="line"> <span class="number">5</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure></div><!--select * from pg_subscription;create subscription s1 connection 'dbname=postgres' publication p1 with (streaming = parallel);--><h3 id="13-vacuum-buffer-usage-limit">13. vacuum_buffer_usage_limit</h3><p>允许通过 vacuum 和 analyze 来控制共享缓冲区的使用。</p><p>VACUUM/ANALYZE 选项是 <code>BUFFER_USAGE_LIMIT</code>, vacuumdb 选项是 <code>--buffer-usage-limit</code>。默认值由服务器变量 vacuum_buffer_usage_limit 设置，该变量还控制 autovacuum。</p><p>VACUUM 使用类似于顺序扫描的环，但是，这个环的大小由 vacuum_buffer_usage_limit GUC 控制。脏页不会从环上移除。相反，如果需要，则刷新 WAL 以允许重用缓冲区。在 8.3 引入缓冲区环策略之前，VACUUM 的缓冲区被发送到自由列表，这实际上是一个 1 缓冲区的缓冲区环，导致过多的 WAL 刷新。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># ANALYZE (BUFFER_USAGE_LIMIT <span class="number">128</span>) t;</span><br><span class="line">ANALYZE</span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> vacuum_buffer_usage_limit;</span><br><span class="line"> vacuum_buffer_usage_limit</span><br><span class="line"><span class="comment">---------------------------</span></span><br><span class="line"> <span class="number">256</span>kB</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure></div><h3 id="14-nls-date-format">14. nls_date_format</h3><p>接下来的 10 个参数是 IvorySQL 为兼容 Oracle 而增设参数，在 IvorySQL 官方文档中也有相关描述。</p><p><code>nls_date_format</code> 表示默认的日期格式。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> nls_date_format;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">---+-----------</span></span><br><span class="line">nls_date_format <span class="operator">|</span> YYYY<span class="operator">-</span>MM<span class="operator">-</span>DD</span><br></pre></td></tr></table></figure></div><h3 id="15-nls-timestamp-format">15. nls_timestamp_format</h3><p><code>nls_timestamp_format</code> 表示带时间的日期格式。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> nls_timestamp_format;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">--------+--------------------------</span></span><br><span class="line">nls_timestamp_format <span class="operator">|</span> YYYY<span class="operator">-</span>MM<span class="operator">-</span>DD HH24:MI:SS.FF6</span><br></pre></td></tr></table></figure></div><h3 id="16-nls-timestamp-tz-format">16. nls_timestamp_tz_format</h3><p><code>nls_timestamp_tz_format</code> 表示带时区的日期格式。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> nls_timestamp_tz_format;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">-----------+----------------------------------</span></span><br><span class="line">nls_timestamp_tz_format <span class="operator">|</span> YYYY<span class="operator">-</span>MM<span class="operator">-</span>DD HH24:MI:SS.FF6 TZH:TZM</span><br></pre></td></tr></table></figure></div><h3 id="17-ivorysql-compatible-mode">17. ivorysql.compatible_mode</h3><p>表示当前兼容 pg 还是 oracle。</p><p>普通连接到默认端口 5432，显示为 pg 模式。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql<span class="variable">@shawnyan</span> <span class="operator">~</span>]$ psql <span class="operator">-</span>x</span><br><span class="line">psql (<span class="number">16.1</span><span class="operator">-</span>ShawnYan)</span><br><span class="line">Type &quot;help&quot; <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> ivorysql.compatible_mode;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">------------+---</span></span><br><span class="line">ivorysql.compatible_mode <span class="operator">|</span> pg</span><br></pre></td></tr></table></figure></div><p>连接到兼容 oracle 的端口 1521，显示为 oracle 模式。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql<span class="variable">@shawnyan</span> bin]$ psql <span class="operator">-</span>p1521 <span class="operator">-</span>x</span><br><span class="line">psql (<span class="number">16.1</span><span class="operator">-</span>ShawnYan)</span><br><span class="line">Type &quot;help&quot; <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> ivorysql.compatible_mode;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">------------+-------</span></span><br><span class="line">ivorysql.compatible_mode <span class="operator">|</span> oracle</span><br></pre></td></tr></table></figure></div><h3 id="18-ivorysql-database-mode">18. ivorysql.database_mode</h3><p><code>ivorysql.database_mode</code> 表示当前数据库的模式（pg/oracle）。</p><h3 id="19-ivorysql-datetime-ignore-nls-mask">19. ivorysql.datetime_ignore_nls_mask</h3><p>表示日期格式是否会受 NLS 参数影响，默认为 0。</p><!--ivorysql=# show nls_date_format;-[ RECORD 1 ]---+-----------nls_date_format | YYYY-MM-DDivorysql=# select sys.current_date();-[ RECORD 1 ]+-----------current_date | 2024-02-07ivorysql=# show ivorysql.datetime_ignore_nls_mask;-[ RECORD 1 ]---------------------+--ivorysql.datetime_ignore_nls_mask | 0ivorysql=# set nls_date_format = 'YY/MM/DD';SETivorysql=# select sys.current_date();-[ RECORD 1 ]+---------current_date | 24/02/07ivorysql=# set ivorysql.datetime_ignore_nls_mask = 1;SETivorysql=# select sys.current_date();-[ RECORD 1 ]+---------current_date | 24/02/07ivorysql=#ivorysql=# select sys.current_date();-[ RECORD 1 ]+---------current_date | 24/02/07--><h3 id="20-ivorysql-enable-emptystring-to-NULL">20. ivorysql.enable_emptystring_to_NULL</h3><p>取值为（on/off），该变量为 on 时，会将插入的空字符串转成 NULL 值存储。</p><p>示例：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">select</span> name,setting <span class="keyword">from</span> pg_settings <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;ivory%&#x27;</span>;</span><br><span class="line">                name                 <span class="operator">|</span>   setting</span><br><span class="line"><span class="comment">-------------------------------------+-------------</span></span><br><span class="line"> ivorysql.compatible_mode            <span class="operator">|</span> oracle</span><br><span class="line"> ivorysql.database_mode              <span class="operator">|</span> oracle</span><br><span class="line"> ivorysql.datetime_ignore_nls_mask   <span class="operator">|</span> <span class="number">0</span></span><br><span class="line"> ivorysql.enable_emptystring_to_NULL <span class="operator">|</span> <span class="keyword">on</span></span><br><span class="line"> ivorysql.identifier_case_switch     <span class="operator">|</span> interchange</span><br><span class="line"> ivorysql.listen_addresses           <span class="operator">|</span> localhost</span><br><span class="line"> ivorysql.port                       <span class="operator">|</span> <span class="number">1521</span></span><br><span class="line">(<span class="number">7</span> <span class="keyword">rows</span>)</span><br><span class="line">...</span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">create</span> <span class="keyword">table</span> tnull (id <span class="type">int</span>, sal <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">insert</span> <span class="keyword">into</span> tnull <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tnull <span class="keyword">where</span> sal <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"> id <span class="operator">|</span> sal</span><br><span class="line"><span class="comment">----+-----</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">set</span> ivorysql.enable_emptystring_to_NULL <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tnull <span class="keyword">where</span> sal <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"> id <span class="operator">|</span> sal</span><br><span class="line"><span class="comment">----+-----</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">insert</span> <span class="keyword">into</span> tnull <span class="keyword">select</span> <span class="number">3</span>,<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tnull <span class="keyword">where</span> sal <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"> id <span class="operator">|</span> sal</span><br><span class="line"><span class="comment">----+-----</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tnull <span class="keyword">where</span> sal <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> id <span class="operator">|</span> sal</span><br><span class="line"><span class="comment">----+-----</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span></span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure></div><h3 id="21-ivorysql-identifier-case-switch">21. ivorysql.identifier_case_switch</h3><p>用于设置字符大小写转换模式。</p><p>可设置为 <code>NORMAL</code>，<code>LOWERCASE</code>，<code>INTERCHANGE</code>。</p><h3 id="22-ivorysql-listen-addresses">22. ivorysql.listen_addresses</h3><p>表示兼容模式监听的地址。</p><p>默认监听本地，可以设置为 <code>*</code>，允许所有地址访问。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> ivorysql.listen_addresses;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="comment">-------------+--</span></span><br><span class="line">ivorysql.listen_addresses <span class="operator">|</span> <span class="operator">*</span></span><br></pre></td></tr></table></figure></div><h3 id="23-ivorysql-port">23. ivorysql.port</h3><p>表示兼容模式下连接的端口号，这里默认为兼容 oracle 模式，端口号为 1521。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ivorysql<span class="operator">=</span># <span class="keyword">show</span> ivorysql.port;</span><br><span class="line"><span class="operator">-</span>[ RECORD <span class="number">1</span> ]<span class="operator">-</span><span class="operator">+</span><span class="comment">-----</span></span><br><span class="line">ivorysql.port <span class="operator">|</span> <span class="number">1521</span></span><br></pre></td></tr></table></figure></div><h2 id="总结">总结</h2><p>IvorySQL 3 的新增参数提供了更多的配置和调优选项。通过了解这些参数，我们可以适当调整安全策略，更好的完成去 O 和国产化替代任务。在未来的工作中，建议持续关注 IvorySQL 的更新和优化，以便更好地利用这些新功能。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;ivorysql.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://o</summary>
      
    
    
    
    <category term="IvorySQL" scheme="https://shawnyan.cn/categories/ivorysql/"/>
    
    
    <category term="postgresql" scheme="https://shawnyan.cn/tags/postgresql/"/>
    
    <category term="ivorysql" scheme="https://shawnyan.cn/tags/ivorysql/"/>
    
    <category term="highgo" scheme="https://shawnyan.cn/tags/highgo/"/>
    
    <category term="postgresql 16" scheme="https://shawnyan.cn/tags/postgresql-16/"/>
    
  </entry>
  
  <entry>
    <title>IvorySQL 3.1 和 2.3 系统参数变化（上篇）</title>
    <link href="https://shawnyan.cn/2024/postgresql/ivorysql-3.1-sys-vars-1/"/>
    <id>https://shawnyan.cn/2024/postgresql/ivorysql-3.1-sys-vars-1/</id>
    <published>2024-02-06T00:22:53.000Z</published>
    <updated>2024-02-06T00:22:53.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="ivorysql.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240207-d856ff9f-5e9e-474b-b5c0-0ff3718eb5c8.png"                      referrerpolicy="no-referrer"                ><h2 id="前情回顾">前情回顾</h2><p>IvorySQL 3.1 已经发版一段时间，前面写过几篇文章来介绍 IvorySQL。</p><ul><li><a class="link"   href="https://mp.weixin.qq.com/s/jZ0RcLg-muJ9_yiKq591Dw" >好消息！IvorySQL 库回归啦~ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a href="https://shawnyan.cn/2023/postgresql/ivorysql-v3.0-feature/">IvorySQL v3.0 新特性浅测</a></li><li><a href="https://shawnyan.cn/2023/postgresql/ivorysql-v2.3-feature/">象牙数据库 IvorySQL v2.3 特性浅析</a></li></ul><p>从 IvorySQL 3.0 到 3.1 变化较小，没有系统参数变化，主要修复了各种八阿哥。<br>接下来将用两篇文章的篇幅介绍 IvorySQL 3.1 和 2.3 的参数区别。</p><h2 id="系统参数变化（count）">系统参数变化（count）</h2><p>视图 <code>pg_settings</code> 提供对服务器运行时参数的访问。 它本质上是 <code>SHOW</code> 和 <code>SET</code> 命令的替代接口。它还提供对有关每个参数的一些事实的访问，这些事实不能从 <code>SHOW</code> 直接获得，例如最小值和最大值。</p><p>从 pg_settings 可以查询到当前版本数据库有多少个系统参数，以及设定值和默认值。</p><p>IvorySQL 2.3 共有 354 个参数，IvorySQL 3.1 共有 371 个参数。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- <span class="number">2.3</span></span><br><span class="line">ivorysql=<span class="meta"># select setting from pg_settings where name = <span class="string">&#x27;server_version&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----------</span><br><span class="line">setting | <span class="number">15.3</span>-ShawnYan</span><br><span class="line"></span><br><span class="line">ivorysql=<span class="meta"># select count(*) from pg_settings;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]</span><br><span class="line">count | <span class="number">354</span></span><br><span class="line"></span><br><span class="line">-- <span class="number">3.1</span></span><br><span class="line">ivorysql=<span class="meta"># select setting from pg_settings where name = <span class="string">&#x27;server_version&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----------</span><br><span class="line">setting | <span class="number">16.1</span>-ShawnYan</span><br><span class="line"></span><br><span class="line">ivorysql=<span class="meta"># select count(*) from pg_settings;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]</span><br><span class="line">count | <span class="number">371</span></span><br></pre></td></tr></table></figure></div><p>其中，有 6 个删减参数，2 个默认值变更参数，以及 23 个新增参数。</p><h2 id="系统参数变化（remove）">系统参数变化（remove）</h2><h3 id="1-compatible-mode">1. compatible_mode</h3><p>在之前的文章《象牙数据库 IvorySQL v2.3 特性浅析》中介绍过这个参数。</p><blockquote><p>IvorySQL 中增加了配置项 <code>compatible_mode</code> 用于选择兼容 PostgreSQL 模式还是 Oracle 模式，默认值为 <code>postgres</code></p></blockquote><p>在 IvorySQL 3 中，该参数被 <code>ivorysql.compatible_mode</code> 取代。</p><h3 id="2-force-parallel-mode">2. force_parallel_mode</h3><p>该参数用于强制开启并行查询，一般用于测试。从 IvorySQL 3 开始，更名为 <code>debug_parallel_query</code>。</p><h3 id="3-lc-collate">3. lc_collate</h3><p>从 IvorySQL 3 开始，只读参数 <code>lc_collate</code> 和 <code>lc_ctype</code> 被移除。</p><p>数据库之间的排序规则和区域设置可能有所不同，因此将它们作为只读服务器变量是没有帮助的。</p><p>除此之外，还在使用的 lc 参数还有： lc_messages, lc_monetary, lc_numeric, lc_time.</p><h3 id="4-lc-ctype">4. lc_ctype</h3><p>同上。</p><h3 id="5-promote-trigger-file">5. promote_trigger_file</h3><p>该参数意为指定触发器文件名称，该文件的存在将结束 standby 节点中的恢复。</p><p>用于将备用数据库升级为主数据库，现在使用 <code>pg_ctl promote</code> 或 <code>pg_promote()</code> 可以更轻松地完成。</p><p>该参数在 PG 12 中，名称由 <code>trigger_file</code> 变更为 <code>promote_trigger_file</code>，在 IvorySQL 3 中被移除。</p><h3 id="6-vacuum-defer-cleanup-age">6. vacuum_defer_cleanup_age</h3><p>该参数用于指定 VACUUM 和 HOT 更新在清除死亡行版本之前，应该推迟多久（以事务数量计）。默认为 0 个事务，死亡行版本将被尽可能快地清除。</p><p>可以在 standby 服务器上设定 <code>hot_standby_feedback</code> 和复制槽，该参数不再需要，在 IvorySQL 3 中被移除。</p><h2 id="系统参数变化（modify）">系统参数变化（modify）</h2><p>有两个参数的默认值发生了变化。</p><h3 id="1-nls-length-semantics">1. nls_length_semantics</h3><p><code>nls_length_semantics</code> 参数用于设定字符串长度单位，</p><p>在 IvorySQL 2.3 中，默认值为 <code>none</code>，在 IvorySQL 3.1 中，默认值变更为 <code>byte</code>。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- <span class="number">2.3</span></span><br><span class="line">ivorysql=<span class="meta"># select setting from pg_settings where name = <span class="string">&#x27;server_version&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----------</span><br><span class="line">setting | <span class="number">15.3</span>-ShawnYan</span><br><span class="line"></span><br><span class="line">ivorysql=<span class="meta"># select setting, source from pg_settings where name = <span class="string">&#x27;nls_length_semantics&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----</span><br><span class="line">setting | none</span><br><span class="line">source  | <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">-- <span class="number">3.1</span></span><br><span class="line">ivorysql=<span class="meta"># select setting from pg_settings where name = <span class="string">&#x27;server_version&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----------</span><br><span class="line">setting | <span class="number">16.1</span>-ShawnYan</span><br><span class="line"></span><br><span class="line">ivorysql=<span class="meta"># select setting, source from pg_settings where name = <span class="string">&#x27;nls_length_semantics&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----</span><br><span class="line">setting | byte</span><br><span class="line">source  | <span class="keyword">default</span></span><br></pre></td></tr></table></figure></div><h3 id="2-shared-preload-libraries">2. shared_preload_libraries</h3><p>IvorySQL 3 中，对 Oracle 兼容模式的实现进行了重构，所以系统参数也发生了调整，该参数受此影响。</p><p>在 2.3 中为空，在 3.1 中有 ora 相关设定。</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- <span class="number">2.3</span></span><br><span class="line">ivorysql=<span class="meta"># select setting, source from pg_settings where name = <span class="string">&#x27;shared_preload_libraries&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]----</span><br><span class="line">setting |</span><br><span class="line">source  | <span class="keyword">default</span></span><br><span class="line"></span><br><span class="line">-- <span class="number">3.1</span></span><br><span class="line">ivorysql=<span class="meta"># select setting, source from pg_settings where name = <span class="string">&#x27;shared_preload_libraries&#x27;</span>;</span></span><br><span class="line">-[ RECORD <span class="number">1</span> ]---------------------------</span><br><span class="line">setting | liboracle_parser, ivorysql_ora</span><br><span class="line">source  | configuration file</span><br></pre></td></tr></table></figure></div><h2 id="小结">小结</h2><p>在对比 IvorySQL 3.1 和 2.3 的系统参数时，共发现 31 个变化点，本文介绍了 6 个删减参数，和 2 个默认值变更参数。</p><p>关于 23 个新增参数，且听下回分解。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;ivorysql.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://o</summary>
      
    
    
    
    <category term="IvorySQL" scheme="https://shawnyan.cn/categories/ivorysql/"/>
    
    
    <category term="postgresql" scheme="https://shawnyan.cn/tags/postgresql/"/>
    
    <category term="ivorysql" scheme="https://shawnyan.cn/tags/ivorysql/"/>
    
    <category term="highgo" scheme="https://shawnyan.cn/tags/highgo/"/>
    
    <category term="postgresql 16" scheme="https://shawnyan.cn/tags/postgresql-16/"/>
    
  </entry>
  
  <entry>
    <title>抢鲜体验 GreatSQL 的 AP 引擎 Rapid</title>
    <link href="https://shawnyan.cn/2024/mysql/greatsql-ap-rapid/"/>
    <id>https://shawnyan.cn/2024/mysql/greatsql-ap-rapid/</id>
    <published>2024-02-05T04:07:12.000Z</published>
    <updated>2024-02-05T04:07:12.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="greatsql.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240205-b04a5749-440d-4d5b-a8cd-4700116b24d7.png"                      referrerpolicy="no-referrer"                ><h2 id="GreatSQL-及-Rapid-存储引擎简介">GreatSQL 及 Rapid 存储引擎简介</h2><p>GreatSQL 数据库是一款开源免费数据库，可在普通硬件上满足金融级应用场景，具有高可用、高性能、高兼容、高安全等特性，可作为 MySQL 或 Percona Server for MySQL 的理想可选替换。</p><p>从 GreatSQL 8.0.32-25 版本开始，新增 Rapid 存储引擎，该引擎使得 GreatSQL 能满足联机分析（OLAP）查询请求。Rapid 引擎不会直接面对客户端和应用程序，用户无需修改原有的数据访问方式。它是一个无共享、内存化、混合列式存储的查询处理引擎，其设计目的是为了高性能的处理分析型查询。</p><h2 id="GreatSQL-安装">GreatSQL 安装</h2><p>以下内容为 GreatSQL 在 CentOS 7 的安装步骤。</p><h3 id="1-下载-GreatSQL-8-0-32-25-安装包">1. 下载 GreatSQL 8.0.32-25 安装包</h3><p>这里下载的是适配 el7 的 RPM 包。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://product.greatdb.com/GreatSQL-8.0.32-25-Rapid/greatsql-8.0.32-25.1.el7.x86_64.rpm-bundle.tar.xz</span><br></pre></td></tr></table></figure></div><h3 id="2-解压压缩包">2. 解压压缩包</h3><p>解压后得到 6 个 RPM 包，这里没有 test 包，如需使用，需要另行下载。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~]# tar xf greatsql-8.0.32-25.1.el7.x86_64.rpm-bundle.tar.xz</span><br><span class="line">[root@shawnyan ~]# ls -alh greatsql-*</span><br><span class="line">-rw-r--r-- 1 root root 121M Feb  4 03:02 greatsql-8.0.32-25.1.el7.x86_64.rpm-bundle.tar.xz</span><br><span class="line">-rw-r--r-- 1 root root  19M Feb  2 15:51 greatsql-client-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root 1.9M Feb  2 15:51 greatsql-devel-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root 2.1M Feb  2 15:51 greatsql-icu-data-files-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root 5.0M Feb  2 15:51 greatsql-mysql-router-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root  93M Feb  2 15:51 greatsql-server-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r-- 1 root root 1.5M Feb  2 15:51 greatsql-shared-8.0.32-25.1.el7.x86_64.rpm</span><br><span class="line">[root@shawnyan ~]#</span><br></pre></td></tr></table></figure></div><h3 id="3-安装-RPM-包">3. 安装 RPM 包</h3><p>使用 YUM 命令直接安装即可，YUM 会自行分析依赖。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~]# yum install greatsql-*.rpm</span><br><span class="line">...</span><br><span class="line">Install  6 Packages (+46 Dependent packages)</span><br><span class="line">Upgrade             (  3 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total size: 624 M</span><br><span class="line">Total download size: 19 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">...</span><br><span class="line">Installed:</span><br><span class="line">  greatsql-client.x86_64 0:8.0.32-25.1.el7  greatsql-devel.x86_64 0:8.0.32-25.1.el7  greatsql-icu-data-files.x86_64 0:8.0.32-25.1.el7  greatsql-mysql-router.x86_64 0:8.0.32-25.1.el7  greatsql-server.x86_64 0:8.0.32-25.1.el7  greatsql-shared.x86_64 0:8.0.32-25.1.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  groff-base.x86_64 0:1.22.2-8.el7         keyutils-libs-devel.x86_64 0:1.5.8-3.el7    krb5-devel.x86_64 0:1.15.1-55.el7_9             libaio.x86_64 0:0.3.109-13.el7         libcom_err-devel.x86_64 0:1.42.9-19.el7        libkadm5.x86_64 0:1.15.1-55.el7_9</span><br><span class="line">  libselinux-devel.x86_64 0:2.5-15.el7     libsepol-devel.x86_64 0:2.5-10.el7          libverto-devel.x86_64 0:0.2.5-4.el7             make.x86_64 1:3.82-24.el7              net-tools.x86_64 0:2.0-0.25.20131004git.el7    numactl-libs.x86_64 0:2.0.12-5.el7</span><br><span class="line">  openssl.x86_64 1:1.0.2k-26.el7_9         openssl-devel.x86_64 1:1.0.2k-26.el7_9      pcre-devel.x86_64 0:8.32-17.el7                 perl.x86_64 4:5.16.3-299.el7_9         perl-Carp.noarch 0:1.26-244.el7                perl-Data-Dumper.x86_64 0:2.145-3.el7</span><br><span class="line">  perl-Digest.noarch 0:1.17-245.el7        perl-Digest-MD5.x86_64 0:2.52-3.el7         perl-Encode.x86_64 0:2.51-7.el7                 perl-Exporter.noarch 0:5.68-3.el7      perl-File-Path.noarch 0:2.09-2.el7             perl-File-Temp.noarch 0:0.23.01-3.el7</span><br><span class="line">  perl-Filter.x86_64 0:1.49-3.el7          perl-Getopt-Long.noarch 0:2.40-3.el7        perl-HTTP-Tiny.noarch 0:0.033-3.el7             perl-PathTools.x86_64 0:3.40-5.el7     perl-Pod-Escapes.noarch 1:1.04-299.el7_9       perl-Pod-Perldoc.noarch 0:3.20-4.el7</span><br><span class="line">  perl-Pod-Simple.noarch 1:3.28-4.el7      perl-Pod-Usage.noarch 0:1.63-3.el7          perl-Scalar-List-Utils.x86_64 0:1.27-248.el7    perl-Socket.x86_64 0:2.010-5.el7       perl-Storable.x86_64 0:2.45-3.el7              perl-Text-ParseWords.noarch 0:3.29-4.el7</span><br><span class="line">  perl-Time-HiRes.x86_64 4:1.9725-3.el7    perl-Time-Local.noarch 0:1.2300-2.el7       perl-constant.noarch 0:1.27-2.el7               perl-libs.x86_64 4:5.16.3-299.el7_9    perl-macros.x86_64 4:5.16.3-299.el7_9          perl-parent.noarch 1:0.225-244.el7</span><br><span class="line">  perl-podlators.noarch 0:2.5.1-3.el7      perl-threads.x86_64 0:1.87-4.el7            perl-threads-shared.x86_64 0:1.43-6.el7         zlib-devel.x86_64 0:1.2.7-21.el7_9</span><br><span class="line"></span><br><span class="line">Dependency Updated:</span><br><span class="line">  krb5-libs.x86_64 0:1.15.1-55.el7_9                                                       openssl-libs.x86_64 1:1.0.2k-26.el7_9                                                       zlib.x86_64 0:1.2.7-21.el7_9</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></div><h3 id="4-启动-GreatSQL-数据库">4. 启动 GreatSQL 数据库</h3><p>安装时会自行创建 <code>mysql</code> 用户，安装完成后，初始化数据目录。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id mysql</span><br><span class="line">/usr/bin/mysqld_pre_systemd --user=mysql</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~]# id mysql</span><br><span class="line">uid=27(mysql) gid=27(mysql) groups=27(mysql)</span><br></pre></td></tr></table></figure></div><p>使用 <code>mysqld_safe</code> 启动数据库。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqld_safe &amp;</span><br></pre></td></tr></table></figure></div><h3 id="5-连接-GreatSQL-数据库">5. 连接 GreatSQL 数据库</h3><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></div><p>查看状态和版本信息。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ~]# mysql -uroot -p&#x27;Greatsql@123&#x27;</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 15</span><br><span class="line">Server version: 8.0.32-25 GreatSQL (GPL), Release 25, Revision 79f57097e3f</span><br><span class="line"></span><br><span class="line">Copyright (c) 2021-2023 GreatDB Software Co., Ltd</span><br><span class="line">Copyright (c) 2009-2023 Percona LLC and/or its affiliates</span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">\s</span></span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 8.0.32-25 for Linux on x86_64 (GreatSQL (GPL), Release 25, Revision 79f57097e3f)</span><br><span class="line"></span><br><span class="line">Connection id:          15</span><br><span class="line">Current database:</span><br><span class="line">Current user:           root@localhost</span><br><span class="line">SSL:                    Not in use</span><br><span class="line">Current pager:          stdout</span><br><span class="line">Using outfile:          &#x27;&#x27;</span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         8.0.32-25 GreatSQL (GPL), Release 25, Revision 79f57097e3f</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             Localhost via UNIX socket</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    latin1</span><br><span class="line">Conn.  characterset:    latin1</span><br><span class="line">UNIX socket:            /var/lib/mysql/mysql.sock</span><br><span class="line">Binary data as:         Hexadecimal</span><br><span class="line">Uptime:                 55 min 51 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 462  Slow queries: 0  Opens: 366  Flush tables: 3  Open tables: 279  Queries per second avg: 0.137</span><br><span class="line">--------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> version();</span></span><br><span class="line">+-----------+</span><br><span class="line">| version() |</span><br><span class="line">+-----------+</span><br><span class="line">| 8.0.32-25 |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h3 id="6-查看第二引擎系统变量">6. 查看第二引擎系统变量</h3><p>这个版本的数据库提供了 9 个第二引擎的系统变量。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%secondary%&#x27;;</span><br><span class="line">+--------------------------------------------+----------------------+</span><br><span class="line">| Variable_name                              | Value                |</span><br><span class="line">+--------------------------------------------+----------------------+</span><br><span class="line">| secondary_engine_cost_threshold            | 100000.000000        |</span><br><span class="line">| secondary_engine_parallel_load_workers     | 4                    |</span><br><span class="line">| secondary_engine_read_delay_gtid_threshold | 100                  |</span><br><span class="line">| secondary_engine_read_delay_level          | TABLE_START_INC_TASK |</span><br><span class="line">| secondary_engine_read_delay_time_threshold | 60                   |</span><br><span class="line">| secondary_engine_read_delay_wait_mode      | WAIT_FOR_TRX         |</span><br><span class="line">| secondary_engine_read_delay_wait_timeout   | 60                   |</span><br><span class="line">| show_create_table_skip_secondary_engine    | OFF                  |</span><br><span class="line">| use_secondary_engine                       | OFF                  |</span><br><span class="line">+--------------------------------------------+----------------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h3 id="7-安装-Rapid-存储引擎">7. 安装 Rapid 存储引擎</h3><p>查看 Rapid 相关系统变量，由于尚未安装插件，所以查询结果为空。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%rapid%&#x27;;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>安装 Rapid 存储引擎插件。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSTALL PLUGIN Rapid SONAME &#x27;ha_rapid.so&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br></pre></td></tr></table></figure></div><p>再次查看相关系统变量，可以看到有 5 条记录。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%rapid%&#x27;;</span><br><span class="line">+-------------------------------+-----------------+</span><br><span class="line">| Variable_name                 | Value           |</span><br><span class="line">+-------------------------------+-----------------+</span><br><span class="line">| rapid_checkpoint_threshold    | 16777216        |</span><br><span class="line">| rapid_hash_table_memory_limit | 10              |</span><br><span class="line">| rapid_memory_limit            | 1073741824      |</span><br><span class="line">| rapid_temp_directory          | duckdb.data.tmp |</span><br><span class="line">| rapid_worker_threads          | 4               |</span><br><span class="line">+-------------------------------+-----------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></div><p>查看 Rapid 插件信息。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show plugins;</span><br><span class="line">+----------------------------------+----------+--------------------+-------------+---------+</span><br><span class="line">| Name                             | Status   | Type               | Library     | License |</span><br><span class="line">+----------------------------------+----------+--------------------+-------------+---------+</span><br><span class="line">...</span><br><span class="line">| Rapid                            | ACTIVE   | STORAGE ENGINE     | ha_rapid.so | GPL     |</span><br><span class="line">+----------------------------------+----------+--------------------+-------------+---------+</span><br><span class="line">51 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from information_schema.plugins where PLUGIN_NAME = &#x27;rapid&#x27;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           PLUGIN_NAME: Rapid</span><br><span class="line">        PLUGIN_VERSION: 0.1</span><br><span class="line">         PLUGIN_STATUS: ACTIVE</span><br><span class="line">           PLUGIN_TYPE: STORAGE ENGINE</span><br><span class="line">   PLUGIN_TYPE_VERSION: 80032.0</span><br><span class="line">        PLUGIN_LIBRARY: ha_rapid.so</span><br><span class="line">PLUGIN_LIBRARY_VERSION: 1.11</span><br><span class="line">         PLUGIN_AUTHOR: Oracle Corporation</span><br><span class="line">    PLUGIN_DESCRIPTION: Rapid storage engine</span><br><span class="line">        PLUGIN_LICENSE: GPL</span><br><span class="line">           LOAD_OPTION: ON</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h3 id="8-启用-Rapid-引擎，并加载数据">8. 启用 Rapid 引擎，并加载数据</h3><p>创建一个测试表，默认存储引擎为 InnoDB。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table t\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t</span><br><span class="line">Create Table: CREATE TABLE `t` (</span><br><span class="line">  `a` int DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>将该表的第二存储设置为 Rapid。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table t secondary_engine = rapid;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table t\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t</span><br><span class="line">Create Table: CREATE TABLE `t` (</span><br><span class="line">  `a` int DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci SECONDARY_ENGINE=rapid</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>查看表结构，描述里出现 <code>SECONDARY_ENGINE=rapid</code> 字样。</p><p>也可以通过参数 <code>show_create_table_skip_secondary_engine</code> 进行控制展示内容，跳过第二引擎展示。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set show_create_table_skip_secondary_engine = on;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table t\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t</span><br><span class="line">Create Table: CREATE TABLE `t` (</span><br><span class="line">  `a` int DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><p>加载数据到 Rapid 引擎。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table t secondary_load;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure></div><p>需要注意的是，需要先进行 load 再查询数据，否则会报错。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain analyze select /*+ set_var(use_secondary_engine=forced) */ * from t\G</span><br><span class="line">ERROR 3889 (HY000): Secondary engine operation failed. use_secondary_engine is FORCED but query could not be executed in secondary engine.</span><br></pre></td></tr></table></figure></div><h3 id="9-Rapid-的使用">9. Rapid 的使用</h3><p>使用 Hint 强制使用 Rapid 引擎，并查看执行计划。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select /*+ set_var(use_secondary_engine=forced) */ * from t;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                        |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+</span><br><span class="line">|  1 | SIMPLE      | t     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    1 |   100.00 | Using secondary engine RAPID |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">Note (Code 1003): /* select#1 */ select /*+ SET_VAR(use_secondary_engine=&#x27;forced&#x27;) */ `sbtest`.`t`.`a` AS `a` from `sbtest`.`t`</span><br></pre></td></tr></table></figure></div><p>不过，目前不支持 <code>explain analyze</code> 语法。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain analyze select /*+ set_var(use_secondary_engine=forced) */ * from t;</span><br><span class="line">ERROR 1235 (42000): This version of MySQL doesn&#x27;t yet support &#x27;EXPLAIN ANALYZE with secondary engine&#x27;</span><br></pre></td></tr></table></figure></div><p>在<a class="link"   href="https://greatsql.cn/docs/8032-25/user-manual/5-enhance/5-1-highperf-rapid-engine.html" >官方文档 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 中，还有描述了一些限制：</p><blockquote><p>在GreatSQL 8.0.32-25版本中，Rapid引擎支持的语句范围如下：</p><ol><li>表类型：InnoDB引擎的normal表。</li><li>SELECT stmt：不包含 SELECT INTO, SELECT locking clause 等语法。</li><li>PREPARE stmt：仅支持 PREPARE SELECT查询。</li></ol><p>其余类型的SQL语法暂时还不支持。</p><p>Rapid引擎暂时不支持表分区（partition），不支持外键（foreign key）。</p></blockquote><p>举例：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE partitioned_table (</span><br><span class="line">    -&gt;     id INT,</span><br><span class="line">    -&gt;     name VARCHAR(50),</span><br><span class="line">    -&gt;     date_created DATE</span><br><span class="line">    -&gt; )</span><br><span class="line">    -&gt; PARTITION BY RANGE (YEAR(date_created)) (</span><br><span class="line">    -&gt;     PARTITION p0 VALUES LESS THAN (1991),</span><br><span class="line">    -&gt;     PARTITION p1 VALUES LESS THAN (1992)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table partitioned_table secondary_engine = rapid;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table partitioned_table secondary_load;</span><br><span class="line">ERROR 3877 (HY000): The partition table is not supported for RAPID</span><br></pre></td></tr></table></figure></div><p>此外，也不支持整个库同时加载到 Rapid 引擎。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter database sbtest secondary_engine = rapid;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;secondary_engine = rapid&#x27; at line 1</span><br></pre></td></tr></table></figure></div><h3 id="10-查看-Rapid-引擎表的系统信息">10. 查看 Rapid 引擎表的系统信息</h3><p>在系统表中可以查看到 Rapid 相关信息，具体示例如下。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select TABLE_NAME,ENGINE,CREATE_OPTIONS from information_schema.tables where TABLE_SCHEMA = &#x27;sbtest&#x27;;</span><br><span class="line">+-------------------+--------+---------------------------------------------------------+</span><br><span class="line">| TABLE_NAME        | ENGINE | CREATE_OPTIONS                                          |</span><br><span class="line">+-------------------+--------+---------------------------------------------------------+</span><br><span class="line">| partitioned_table | InnoDB | partitioned SECONDARY_ENGINE=&quot;rapid&quot; SECONDARY_LOAD=&quot;0&quot; |</span><br><span class="line">| t                 | InnoDB | SECONDARY_ENGINE=&quot;rapid&quot; SECONDARY_LOAD=&quot;1&quot;             |</span><br><span class="line">+-------------------+--------+---------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc information_schema.SECONDARY_ENGINE_INCREMENT_LOAD_TASK;</span><br><span class="line">+--------------------+----------------+------+-----+---------+-------+</span><br><span class="line">| Field              | Type           | Null | Key | Default | Extra |</span><br><span class="line">+--------------------+----------------+------+-----+---------+-------+</span><br><span class="line">| DB_NAME            | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| TABLE_NAME         | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| START_TIME         | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| START_GTID         | varchar(65535) | NO   |     |         |       |</span><br><span class="line">| COMMITTED_GTID_SET | varchar(65535) | NO   |     |         |       |</span><br><span class="line">| READ_GTID          | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| READ_BINLOG_FILE   | varchar(1024)  | NO   |     |         |       |</span><br><span class="line">| READ_BINLOG_POS    | bigint         | NO   |     |         |       |</span><br><span class="line">| DELAY              | bigint         | NO   |     |         |       |</span><br><span class="line">| STATUS             | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| END_TIME           | varchar(192)   | NO   |     |         |       |</span><br><span class="line">| INFO               | varchar(1024)  | NO   |     |         |       |</span><br><span class="line">+--------------------+----------------+------+-----+---------+-------+</span><br><span class="line">12 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h2 id="总结">总结</h2><p>GreatSQL 于 2/4 正式推出 AP 引擎 Rapid，并提供下载试用。本文简要介绍了如何安装 GreatSQL，及 Rapid 引擎的基础用法。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;greatsql.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://o</summary>
      
    
    
    
    <category term="GreatSQL" scheme="https://shawnyan.cn/categories/greatsql/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="percona" scheme="https://shawnyan.cn/tags/percona/"/>
    
    <category term="greatsql" scheme="https://shawnyan.cn/tags/greatsql/"/>
    
  </entry>
  
  <entry>
    <title>🎉好消息！IvorySQL 库回归啦~</title>
    <link href="https://shawnyan.cn/2024/postgresql/ivorysql-3.1-released/"/>
    <id>https://shawnyan.cn/2024/postgresql/ivorysql-3.1-released/</id>
    <published>2024-02-02T11:24:42.000Z</published>
    <updated>2024-02-11T04:00:01.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="ivorysql.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240207-d856ff9f-5e9e-474b-b5c0-0ff3718eb5c8.png"                      referrerpolicy="no-referrer"                ><h2 id="IvorySQL-3-1-发版">IvorySQL 3.1 发版</h2><p>先让我们来回一下时间线：</p><ul><li><p>PostgreSQL 16</p><ul><li>2023-09-14, PostgreSQL 16.0 Released</li><li>2023-11-09, PostgreSQL 16.1 Released</li></ul></li><li><p>IvorySQL 3</p><ul><li>2023-11-17, IvorySQL 3.0 Released</li><li>2024-01-26, IvorySQL 3.1 Released</li></ul></li></ul><p>再来看下 IvorySQL 3.2 的发版说明：</p><ol><li><p>版本介绍</p><p>[发行日期：2024年1月26日]</p><p>IvorySQL 3.1 基于 PostgreSQL 16.1 ，包含来自 PostgreSQL 16.1 的各种修复。有关 PostgreSQL 16.1 中更详细的更新和错误修复，请参阅官方 PostgreSQL 16.1 发行说明 。</p></li><li><p>已知问题</p><p>暂无</p></li><li><p>增强功能</p><p>暂无</p></li><li><p>问题修复</p><p>暂无</p></li><li><p>源代码</p><p>IvorySQL主要包含2个代码仓库，数据库IvorySQL代码仓、IvorySQL网站仓：</p><ul><li>IvorySQL代码仓： <a class="link"   href="https://github.com/IvorySQL/IvorySQL" >https://github.com/IvorySQL/IvorySQL <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>IvorySQL网站仓： <a class="link"   href="https://github.com/IvorySQL/Ivory-www" >https://github.com/IvorySQL/Ivory-www <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul></li><li><p>贡献人员</p><p>以下个人作为补丁作者、提交者、审阅者、测试者或问题报告者为本版本做出了贡献。</p><ul><li>Grant Zhou</li><li>矫顺田</li><li>牛世继</li><li>梁翔宇</li><li>高雪玉</li><li>Cary Huang</li><li>David Zhang</li><li>谭洋</li><li>王杰</li><li>穆帅楠</li><li>张洪源</li><li>王守波</li><li>任娇</li><li>刘政</li><li>肖哲凯</li><li>金华建</li><li>王丽</li><li>尚雷</li><li>冯磊</li><li>宋金周</li><li>Leo X.M. Zeng</li><li>严少安</li><li>M.Imran Zaheer</li><li>Yunhe Xu</li><li>王皓</li><li>董小姐</li><li>韩伟博</li></ul></li></ol><h2 id="IvorySQL-3-1-编译安装">IvorySQL 3.1 编译安装</h2><p>之前介绍过 IvorySQL 2.x/3.0 的编译安装，3.1 和 3.0 的步骤基本一致。</p><p>只是，这次的编译环境是在 Rocky Linux 9.3 上运行的 Rocky Linux 9.3 容器中。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[mysql@shawnyan ~]$ cat /etc/redhat-release</span><br><span class="line">Rocky Linux release 9.3 (Blue Onyx)</span><br><span class="line">[mysql@shawnyan ~]$ podman images</span><br><span class="line">REPOSITORY                    TAG         IMAGE ID      CREATED       SIZE</span><br><span class="line">shawnyan.cn/rl9-builder       latest      9e887e48ed6c  4 hours ago   297 MB</span><br><span class="line">shawnyan.cn/rl9-systemd       latest      be8b85ec9c17  4 hours ago   205 MB</span><br><span class="line">docker.io/library/rockylinux  9.3         b72d2d915008  2 months ago  181 MB</span><br><span class="line">[mysql@shawnyan ~]$ podman ps</span><br><span class="line">CONTAINER ID  IMAGE                               COMMAND               CREATED       STATUS       PORTS       NAMES</span><br><span class="line">b1547a08c6a1  shawnyan.cn/rl9-builder:latest      /usr/lib/systemd/...  3 hours ago   Up 3 hours               shawnyan</span><br><span class="line">[mysql@shawnyan ~]$ podman exec -it shawnyan bash</span><br><span class="line">[root@shawnyan /]#</span><br><span class="line">[root@shawnyan /]# cat /etc/redhat-release</span><br><span class="line">Rocky Linux release 9.3 (Blue Onyx)</span><br><span class="line">[root@shawnyan /]# uname -a</span><br><span class="line">Linux shawnyan 5.14.0-362.13.1.el9_3.x86_64 #1 SMP PREEMPT_DYNAMIC Wed Dec 13 14:07:45 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">[root@shawnyan /]# gcc --version</span><br><span class="line">gcc (GCC) 11.4.1 20230605 (Red Hat 11.4.1-2)</span><br><span class="line">Copyright (C) 2021 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure></div><p>编译步骤也很简单，下面是主要步骤：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export IVORY_VERSION=3.1</span><br><span class="line">wget https://github.com/IvorySQL/IvorySQL/archive/refs/tags/IvorySQL_$IVORY_VERSION.tar.gz</span><br><span class="line">tar zxf IvorySQL_$IVORY_VERSION.tar.gz</span><br><span class="line">cd IvorySQL-IvorySQL_$IVORY_VERSION</span><br><span class="line">./configure --prefix=/opt/ivorysql-$IVORY_VERSION --with-extra-version=&quot;-ShawnYan&quot;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></div><p>编译完成后，进行数据目录初始化：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initdb</span><br></pre></td></tr></table></figure></div><p>输出结果如下：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan /]# cd /data/ivorysql-3.1/</span><br><span class="line">[root@shawnyan ivorysql-3.1]# ls -al</span><br><span class="line">total 68</span><br><span class="line">drwx------ 19 ivorysql ivorysql  4096 Feb  2 07:35 .</span><br><span class="line">drwxr-xr-x  4 ivorysql ivorysql    46 Feb  2 07:40 ..</span><br><span class="line">-rw-------  1 ivorysql ivorysql     3 Feb  2 07:17 PG_VERSION</span><br><span class="line">drwx------  6 ivorysql ivorysql    46 Feb  2 07:17 base</span><br><span class="line">drwx------  2 ivorysql ivorysql  4096 Feb  2 07:29 global</span><br><span class="line">-rw-------  1 ivorysql ivorysql   718 Feb  2 07:17 ivorysql.conf</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_commit_ts</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_dynshmem</span><br><span class="line">-rw-------  1 ivorysql ivorysql  5779 Feb  2 07:19 pg_hba.conf</span><br><span class="line">-rw-------  1 ivorysql ivorysql  2640 Feb  2 07:17 pg_ident.conf</span><br><span class="line">drwx------  4 ivorysql ivorysql    68 Feb  2 07:35 pg_logical</span><br><span class="line">drwx------  4 ivorysql ivorysql    36 Feb  2 07:17 pg_multixact</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_notify</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_replslot</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_serial</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_snapshots</span><br><span class="line">drwx------  2 ivorysql ivorysql    25 Feb  2 07:35 pg_stat</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_stat_tmp</span><br><span class="line">drwx------  2 ivorysql ivorysql    18 Feb  2 07:17 pg_subtrans</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_tblspc</span><br><span class="line">drwx------  2 ivorysql ivorysql     6 Feb  2 07:17 pg_twophase</span><br><span class="line">drwx------  3 ivorysql ivorysql    92 Feb  2 07:23 pg_wal</span><br><span class="line">drwx------  2 ivorysql ivorysql    18 Feb  2 07:17 pg_xact</span><br><span class="line">-rw-------  1 ivorysql ivorysql    88 Feb  2 07:17 postgresql.auto.conf</span><br><span class="line">-rw-------  1 ivorysql ivorysql 29841 Feb  2 07:18 postgresql.conf</span><br><span class="line">-rw-------  1 ivorysql ivorysql    31 Feb  2 07:23 postmaster.opts</span><br><span class="line">[root@shawnyan ivorysql-3.1]#</span><br></pre></td></tr></table></figure></div><p>启动数据库：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql@shawnyan ~]$ pg_ctl start</span><br><span class="line">waiting for server to start....2024-02-02 07:23:37.656 UTC [11422] LOG:  starting PostgreSQL 16.1-ShawnYan (IvorySQL 3.1) on x86_64-pc-linux-gnu, compiled by gcc (GCC) 11.4.1 20230605 (Red Hat 11.4.1-2), 64-bit</span><br><span class="line">2024-02-02 07:23:37.656 UTC [11422] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432</span><br><span class="line">2024-02-02 07:23:37.656 UTC [11422] LOG:  listening on IPv6 address &quot;::&quot;, port 5432</span><br><span class="line">2024-02-02 07:23:37.661 UTC [11422] LOG:  listening on IPv6 address &quot;::1&quot;, port 1521</span><br><span class="line">2024-02-02 07:23:37.661 UTC [11422] LOG:  listening on IPv4 address &quot;127.0.0.1&quot;, port 1521</span><br><span class="line">2024-02-02 07:23:37.661 UTC [11422] LOG:  listening on Unix socket &quot;/tmp/.s.PGSQL.5432&quot;</span><br><span class="line">2024-02-02 07:23:37.665 UTC [11422] LOG:  listening on Unix socket &quot;/tmp/.s.PGSQL.1521&quot;</span><br><span class="line">2024-02-02 07:23:37.676 UTC [11425] LOG:  database system was shut down at 2024-02-02 07:23:30 UTC</span><br><span class="line">2024-02-02 07:23:37.681 UTC [11422] LOG:  database system is ready to accept connections</span><br><span class="line"> done</span><br><span class="line">server started</span><br></pre></td></tr></table></figure></div><p>连接 IvorySQL 数据库：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql@shawnyan ~]$ psql</span><br><span class="line">psql (16.1-ShawnYan)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">ivorysql=# \l</span><br><span class="line">                                                   List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Locale Provider | Collate |  Ctype  | ICU Locale | ICU Rules |   Access privileges</span><br><span class="line">-----------+----------+----------+-----------------+---------+---------+------------+-----------+-----------------------</span><br><span class="line"> ivorysql  | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |</span><br><span class="line"> postgres  | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |</span><br><span class="line"> template0 | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/ivorysql          +</span><br><span class="line">           |          |          |                 |         |         |            |           | ivorysql=CTc/ivorysql</span><br><span class="line"> template1 | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/ivorysql          +</span><br><span class="line">           |          |          |                 |         |         |            |           | ivorysql=CTc/ivorysql</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br><span class="line">ivorysql=# select version();</span><br><span class="line">                                                             version</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> PostgreSQL 16.1-ShawnYan (IvorySQL 3.1) on x86_64-pc-linux-gnu, compiled by gcc (GCC) 11.4.1 20230605 (Red Hat 11.4.1-2), 64-bit</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">ivorysql=#</span><br></pre></td></tr></table></figure></div><p><strong>惊喜</strong>的是，在 IvorySQL 3.0 中，已经被移除的 <strong><code>ivorysql</code></strong> 库又重新加回来了。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql@shawnyan ivorysql-3.0]$ psql</span><br><span class="line">2024-02-02 07:42:30.310 UTC [20979] FATAL:  database &quot;ivorysql&quot; does not exist</span><br><span class="line">psql: error: connection to server on socket &quot;/tmp/.s.PGSQL.5432&quot; failed: FATAL:  database &quot;ivorysql&quot; does not exist</span><br><span class="line">[ivorysql@shawnyan ivorysql-3.0]$ createdb ivorysql</span><br><span class="line">[ivorysql@shawnyan ivorysql-3.0]$ psql</span><br><span class="line">psql (16.0-ShawnYan)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">ivorysql=# \l</span><br><span class="line">                                                   List of databases</span><br><span class="line">   Name    |  Owner   | Encoding | Locale Provider | Collate |  Ctype  | ICU Locale | ICU Rules |   Access privileges</span><br><span class="line">-----------+----------+----------+-----------------+---------+---------+------------+-----------+-----------------------</span><br><span class="line"> ivorysql  | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |</span><br><span class="line"> postgres  | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           |</span><br><span class="line"> template0 | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/ivorysql          +</span><br><span class="line">           |          |          |                 |         |         |            |           | ivorysql=CTc/ivorysql</span><br><span class="line"> template1 | ivorysql | UTF8     | libc            | C.UTF-8 | C.UTF-8 |            |           | =c/ivorysql          +</span><br><span class="line">           |          |          |                 |         |         |            |           | ivorysql=CTc/ivorysql</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br><span class="line">ivorysql=# </span><br></pre></td></tr></table></figure></div><p>到此，IvorySQL 3.1 已安装完成，并顺利启动。</p><p>另外，需要注意的是，由于 IvorySQL 3 支持双端口策略，所以可以在 <code>postgresql.conf</code> 文件中配置 pg 模式的监听地址，以及在 <code>ivorysql.conf</code> 文件中配置 ora 模式的监听地址，默认为 <code>localhost</code>，这里改为 <code>*</code> 监听所有地址。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@shawnyan ivorysql-3.1]# grep listen_addr postgresql.conf</span><br><span class="line">listen_addresses = &#x27;*&#x27;</span><br><span class="line">[root@shawnyan ivorysql-3.1]# grep listen_addr ivorysql.conf</span><br><span class="line">ivorysql.listen_addresses = &#x27;*&#x27;</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ivorysql@shawnyan ~]$ ss -antpl</span><br><span class="line">State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port  Process</span><br><span class="line">LISTEN   0        200              0.0.0.0:5432          0.0.0.0:*      users:((&quot;postgres&quot;,pid=21040,fd=6))</span><br><span class="line">LISTEN   0        200              0.0.0.0:1521          0.0.0.0:*      users:((&quot;postgres&quot;,pid=21040,fd=8))</span><br><span class="line">LISTEN   0        200                 [::]:5432             [::]:*      users:((&quot;postgres&quot;,pid=21040,fd=7))</span><br><span class="line">LISTEN   0        200                 [::]:1521             [::]:*      users:((&quot;postgres&quot;,pid=21040,fd=9))</span><br><span class="line">[ivorysql@shawnyan ~]$</span><br></pre></td></tr></table></figure></div><p>OK, 简单做个小结，IvorySQL 3.1 是 IvorySQL 3.x 系列在 2024 年发布的第一个版本，支持 pg/ora 双模式双端口，合并了若干 PostgreSQL 16.1 中修复的问题，并将 IvorySQL 3.0 中移除的 <code>ivorysql</code> 库重新加回。</p><h2 id="相关阅读">相关阅读</h2><ul><li><a href="https://shawnyan.cn/2023/postgresql/ivorysql-v3.0-feature/">IvorySQL v3.0 新特性浅测</a></li><li><a href="https://shawnyan.cn/2023/postgresql/ivorysql-v2.3-feature/">象牙数据库 IvorySQL v2.3 特性浅析</a></li></ul><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;ivorysql.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://o</summary>
      
    
    
    
    <category term="IvorySQL" scheme="https://shawnyan.cn/categories/ivorysql/"/>
    
    
    <category term="postgresql" scheme="https://shawnyan.cn/tags/postgresql/"/>
    
    <category term="ivorysql" scheme="https://shawnyan.cn/tags/ivorysql/"/>
    
    <category term="highgo" scheme="https://shawnyan.cn/tags/highgo/"/>
    
    <category term="postgresql 16" scheme="https://shawnyan.cn/tags/postgresql-16/"/>
    
  </entry>
  
  <entry>
    <title>浅尝在 Rocky 9 下自助生成 PDF 格式的 TiDB 文档</title>
    <link href="https://shawnyan.cn/2024/tidb/tidb-docs-gen-pdf/"/>
    <id>https://shawnyan.cn/2024/tidb/tidb-docs-gen-pdf/</id>
    <published>2024-01-07T04:00:00.000Z</published>
    <updated>2024-01-07T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="img1.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240108-dfb9b292-6804-4902-a0b4-55ffede33402.png"                      referrerpolicy="no-referrer"                ><blockquote><p>图片选自: <a class="link"   href="https://asktug.com/t/topic/1020117" >https://asktug.com/t/topic/1020117 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><h2 id="TL-DR">TL;DR</h2><p><a class="link"   href="https://asktug.com" >Asktug.com <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 论坛里偶有小伙伴询问如何自助生成 PDF 格式的 TiDB 文档，或是 PDF 太长，经常查阅的只是其中一部分，如何只生成那一部分的 TiDB 文档。本文将介绍如何在 Rocky Linux 9 上自助生成 PDF 格式的 TiDB 文档。</p><p>没听过十年二手玫瑰，是不会轻易做这种尝试的，对于 LaTaX 新手来说，积累本文素材的过程极为痛苦。不建议各位看官实操本文的第二种方法，还是推荐使用第一种方法，基本按照官方推荐的、经过测试的方法来，便捷、有效、易用。</p><h2 id="环境准备">环境准备</h2><ol><li>操作系统：Rocky Linux 9.3</li></ol><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]$ <span class="built_in">cat</span> /etc/redhat-release </span><br><span class="line">Rocky Linux release 9.3 (Blue Onyx)</span><br><span class="line">[shawnyan@rocky9 ~]$ <span class="built_in">uname</span> -rsm</span><br><span class="line">Linux 5.14.0-362.13.1.el9_3.x86_64 x86_64</span><br></pre></td></tr></table></figure></div><ol start="2"><li>前置安装：git, podman</li></ol><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]$ git --version</span><br><span class="line">git version 2.39.3</span><br><span class="line">[shawnyan@rocky9 ~]$ </span><br><span class="line">[shawnyan@rocky9 ~]$ podman --version</span><br><span class="line">podman version 4.6.1</span><br></pre></td></tr></table></figure></div><p>注：OS 和相关软件不是本文重点，遂一笔带过。</p><ol start="3"><li>拉取 <code>pandoc/latex</code> 镜像</li></ol><p>使用 podman 拉取 pandoc 镜像：</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">podman pull pandoc/latex</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]<span class="comment"># podman pull pandoc/latex</span></span><br><span class="line">✔ docker.io/pandoc/latex:latest</span><br><span class="line">Trying to pull docker.io/pandoc/latex:latest...</span><br><span class="line">Getting image <span class="built_in">source</span> signatures</span><br><span class="line">Copying blob 13d63ff5f1df <span class="keyword">done</span>  </span><br><span class="line">...</span><br><span class="line">Copying config 11172c3435 <span class="keyword">done</span>  </span><br><span class="line">Writing manifest to image destination</span><br><span class="line">11172c3435762783d582093f4eae6cf80548ff4443a26532e35f36dac8b2ec77</span><br></pre></td></tr></table></figure></div><p>查看镜像信息：</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]<span class="comment"># podman images | grep pandoc</span></span><br><span class="line">docker.io/pandoc/latex            latest      11172c343576  9 months ago   550 MB</span><br></pre></td></tr></table></figure></div><ol start="4"><li>克隆 TiDB 文档库代码</li></ol><p>这里以 TiDB 中文文档为例，克隆文档：</p><p>（为加速下载，也避免网路问题，这里选择从 gitee 克隆代码）</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/shawnyan/docs-cn.git --depth=1</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]$ git <span class="built_in">clone</span> https://gitee.com/shawnyan/docs-cn.git --depth=1</span><br><span class="line">Cloning into <span class="string">&#x27;docs-cn&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 2472, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (2472/2472), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2392/2392), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 2472 (delta 122), reused 1622 (delta 80), pack-reused 0</span><br><span class="line">Receiving objects: 100% (2472/2472), 160.93 MiB | 8.04 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (122/122), <span class="keyword">done</span>.</span><br><span class="line">Updating files: 100% (2440/2440), <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure></div><p>克隆完成后，查看版本，确认当前文档源码为最新版。</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 docs-cn]$ git lg</span><br><span class="line">* a19b956 - (grafted, HEAD -&gt; master, origin/master, origin/HEAD) upgrade TiDB: check DDL and backup status before checking cluster health (<span class="comment">#15936) (2 days ago) &lt;Aolin&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="方法一：使用-pandoc-latex-镜像生成-PDF-文档">方法一：使用 <code>pandoc/latex</code> 镜像生成 PDF 文档</h2><p>在 TiDB 中文文档代码库的 <a class="link"   href="https://github.com/pingcap/docs-cn#tidb-%E6%96%87%E6%A1%A3" >README <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 中有这样一段介绍，并给出了相关教程。</p><blockquote><p>如果你想在本地定制输出符合特定场景需求的 PDF 格式的 TiDB 文档，例如对 TiDB 文档目录进行自由排序和删减，请参考自助生成 TiDB 文档 PDF 教程。</p></blockquote><p>只是教程中介绍的是 Windows 和 macOS 环境，下面将介绍在 Linux 环境下的相关操作流程，推荐有需求的同学使用这种方法。</p><p>TiDB 文档目录在 <code>TOC.md</code> 文件中，编辑此文件按需进行调整、删减。</p><p>例如，在本例中，为便于演示，只保留部分内容。</p><div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- markdownlint-disable MD007 --&gt;</span><br><span class="line">&lt;!-- markdownlint-disable MD041 --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> [<span class="string">文档中心</span>](<span class="link">https://docs.pingcap.com/zh</span>)</span><br><span class="line"><span class="bullet">-</span> 关于 TiDB</span><br><span class="line"><span class="bullet">  -</span> [<span class="string">TiDB 简介</span>](<span class="link">/overview.md</span>)</span><br><span class="line"><span class="bullet">  -</span> [<span class="string">TiDB 7.5 Release Notes</span>](<span class="link">/releases/release-7.5.0.md</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><p>将所有 Markdown 文档文件按照 <code>TOC.md</code> 整合到一个 <code>doc.md</code> 文件中。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd docs-cn</span><br><span class="line">python scripts/merge_by_toc.py</span><br></pre></td></tr></table></figure></div><p>运行 <code>andelf/doc-build</code> 容器，在本例中，文档源码目录为 <code>/root/docs-cn</code> 。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">podman run -it -v /root/docs-cn:/opt/data:rw --privileged=true andelf/doc-build:0.1.9</span><br></pre></td></tr></table></figure></div><p>在容器中运行生产 PDF 的脚本。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/data</span><br><span class="line">bash scripts/generate_pdf.sh</span><br></pre></td></tr></table></figure></div><p>预期输出：将在宿主机上的文档源码目录下生成一个 <code>output.pdf</code> 文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 docs-cn]# ls output.pdf </span><br><span class="line">output.pdf</span><br></pre></td></tr></table></figure></div><p>//img</p><p>到此，演示结束，只是在 PDF 文档属性中还发现一处小问题，PDF 文件文档属性中的标题和作者在生成过程中未填充，需要在 <code>generate_pdf.sh</code> 文件中补充两行内容。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-V title-meta=&quot;TiDB 中文手册&quot; \</span><br><span class="line">-V author-meta=&quot;PingCAP Inc.&quot; \</span><br></pre></td></tr></table></figure></div><p>//img</p><p>补充后，效果如图：</p><p>//img</p><h2 id="方法二：直接安装-pandoc-texlive-软件并生成-PDF-文档">方法二：直接安装 pandoc,texlive 软件并生成 PDF 文档</h2><p>这种方法过程极为复杂繁琐，好处是可以使用最新版本的 pandoc 和 texlive。</p><ol><li>安装一些依赖包。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf install curl wget git bzr mercurial openssl-client subversion procps</span><br><span class="line">dnf install autoconf automake bzip2 dpkg-dev file g++ gcc imagemagick</span><br><span class="line">dnf install tcl tcl-devel tk tk-devel python3 libbz2-dev libc6-dev</span><br></pre></td></tr></table></figure></div><ol start="2"><li>安装 pandoc。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install pandoc</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# pandoc --version</span><br><span class="line">pandoc 2.14.0.3</span><br><span class="line">Compiled with pandoc-types 1.22.1, texmath 0.12.3.3, skylighting 0.10.5.2,</span><br><span class="line">citeproc 0.4.0.1, ipynb 0.1.0.1</span><br><span class="line">User data directory: /root/.local/share/pandoc</span><br><span class="line">Copyright (C) 2006-2021 John MacFarlane. Web:  https://pandoc.org</span><br><span class="line">This is free software; see the source for copying conditions. There is no</span><br><span class="line">warranty, not even for merchantability or fitness for a particular purpose.</span><br><span class="line">[root@rocky9 ~]# </span><br></pre></td></tr></table></figure></div><ol start="3"><li>安装 texlive。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirror.ctan.org/systems/texlive/tlnet/install-tl-unx.tar.gz</span><br><span class="line">tar zxf install-tl-unx.tar.gz</span><br><span class="line">cd install-tl-20240101/</span><br><span class="line">perl ./install-tl</span><br></pre></td></tr></table></figure></div><ol start="4"><li>安装中文字体，官方使用的是 文泉驛（WenQuanYi），或是其他中文字体。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">fc-list :lang-zh | grep -i wenq</span></span><br><span class="line">/usr/share/fonts/truetype/wqy/wqy-microhei.ttc: WenQuanYi Micro Hei,文泉驛微米黑,文泉驿微米黑:style=Regular</span><br><span class="line">/usr/share/fonts/truetype/wqy/wqy-microhei.ttc: WenQuanYi Micro Hei Mono,文泉驛等寬微米黑,文泉驿等宽微米黑:style=Regular</span><br></pre></td></tr></table></figure></div><ol start="5"><li>生成 PDF 文档。</li></ol><p>由于 pandoc 版本升级更新，原有的参数发生变化，比如 <code>--latex-engine</code> 不再支持，需要替换为 <code>--pdf-engine</code>。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MAINFONT=&quot;Microsoft YaHei&quot;</span><br><span class="line">MONOFONT=&quot;Microsoft YaHei&quot;</span><br><span class="line"></span><br><span class="line">pandoc --pdf-engine=xelatex doc.md -o output2.pdf --toc -s \</span><br><span class="line">-V title=&quot;TiDB 文档（节选）&quot; \</span><br><span class="line">-V author=&quot;ShawnYan&quot; \</span><br><span class="line">-V title-meta=&quot;TiDB 文档（节选）&quot; \</span><br><span class="line">-V author-meta=&quot;ShawnYan&quot; \</span><br><span class="line">-V CJKmainfont=&quot;$&#123;MAINFONT&#125;&quot; \</span><br><span class="line">-V mainfont=&quot;$&#123;MAINFONT&#125;&quot; \</span><br><span class="line">-V sansfont=&quot;$&#123;MAINFONT&#125;&quot; \</span><br><span class="line">-V monofont=&quot;$&#123;MONOFONT&#125;&quot;</span><br></pre></td></tr></table></figure></div><p>对于模板文件，直接用新版 pandoc 调用会报错，需要做些调整，如下图。</p><img  alt="img2.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240108-97c591c9-387f-4ea9-8214-112a9397262a.png"                      referrerpolicy="no-referrer"                ><h2 id="小结">小结</h2><p>方法一足够简单、实用，推荐有需求的同学使用，方法二只是其他途径探索，不做推荐。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;img1.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://oss-e</summary>
      
    
    
    
    <category term="TiDB" scheme="https://shawnyan.cn/categories/tidb/"/>
    
    <category term="TiDB Docs" scheme="https://shawnyan.cn/categories/tidb/tidb-docs/"/>
    
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="tidb 7.x" scheme="https://shawnyan.cn/tags/tidb-7-x/"/>
    
    <category term="tidb docs" scheme="https://shawnyan.cn/tags/tidb-docs/"/>
    
  </entry>
  
  <entry>
    <title>【合集】2023 &amp; 2024 年 MySQL 文章清单</title>
    <link href="https://shawnyan.cn/2024/mysql/mysql-articles-23-24/"/>
    <id>https://shawnyan.cn/2024/mysql/mysql-articles-23-24/</id>
    <published>2024-01-01T04:00:00.000Z</published>
    <updated>2024-03-24T04:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>If You Want To Go Fast, Go Alone.</p><p>If You Want To Go Far, Go With Others.</p></blockquote><p>整理 2023 &amp; 2024 年的 MySQL 文章，其中，2023 年 10 篇，2024 年 5 篇。</p><h2 id="MySQL-8-x">MySQL 8.x</h2><ol><li>2023-11-08, <a href="https://shawnyan.cn/2023/mysql/mysql-8.2.0-compile-customization/">【MySQL 8.x】定制化 MySQL 8.2.0 编译选项（文末彩蛋）</a></li><li>2023-10-31, <a href="https://shawnyan.cn/2023/mysql/mysql-8.2.0-compile-on-rocky-9/">【MySQL 8.x】在 Rocky 9 上编译 MySQL 8.2.0 Debug 版本编译指南</a></li><li>2023-10-27, <a href="https://shawnyan.cn/2023/mysql/mysql-8.2.0-sys-vars/">【MySQL 8.x】从参数变化解读 MySQL 8.2.0 发版说明</a></li><li>2023-07-18, <a href="https://shawnyan.cn/2023/mysql/mysql-8.1.0-release/">【MySQL 8.x】重磅！MySQL 8.1.0 已来！有彩蛋~</a></li></ol><h2 id="MySQL-Cloud">MySQL Cloud</h2><ol><li>2023-06-18, <a href="https://shawnyan.cn/2023/mysql/mysql-heatwave-1/">MySQL HeatWave 窥探（1）</a></li></ol><h2 id="管理运维-Maintain">管理运维 (Maintain)</h2><ol><li>2024-03-15, <a href="https://shawnyan.cn/2024/mysql/mysql-upgrade-deprecated/">MySQL 升级：使用 mysql_upgrade 注意事项（再见 mysql_upgrade）</a></li><li>2023-06-11, <a href="https://shawnyan.cn/2023/mysql/mysql-8-component_validate_password/">MySQL 管理运维：root 密码还可以这样改</a></li><li>2023-05-21, <a href="https://shawnyan.cn/2023/mysql/mysql-8.0.20-values-deprecated/">MySQL 管理运维：这类 VALUES() 已被弃用</a></li><li>2023-05-08, <a href="https://shawnyan.cn/2023/mysql/mysql-8-case-datetime-default/">MySQL 管理运维：妙用 DATETIME 数据类型的默认值</a></li><li>2023-04-30, <a href="https://shawnyan.cn/2023/mysql/mysql-8-case-drop-column/">MySQL 管理运维：删除列导致索引变化</a></li></ol><h2 id="故障分析-Troubleshoot">故障分析 (Troubleshoot)</h2><ol><li>2023-07-25, <a href="https://shawnyan.cn/2023/mysql/mysql-8.0.26-bug-crash/">再遇 MySQL “一招必杀” Bug</a></li></ol><h2 id="应用开发-Develop">应用开发 (Develop)</h2><ol><li>2024-02-29, <a href="https://shawnyan.cn/2024/mysql/mysql-connector-j-8-x/">如何选择适合的 MySQL Connector/J 版本</a></li><li>2024-03-19, <a href="https://shawnyan.cn/2023/mysql/mysql-tool-sql-developer/">MySQL 必备工具：SQL Developer</a></li></ol><h2 id="MySQL-认证-Certification">MySQL 认证 (Certification)</h2><ol><li>2024-03-17, <a href="https://shawnyan.cn/2023/mysql/mysql-certification-intro/">MySQL 数据库认证考试介绍（2024 版）</a></li></ol><h2 id="开源分支-Fork">开源分支 Fork</h2><ol><li>2024-02-05, <a href="https://shawnyan.cn/2024/mysql/greatsql-ap-rapid/">抢鲜体验 GreatSQL 的 AP 引擎 Rapid</a></li></ol><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                ><p>如果这篇文章为你带来了灵感或启发，就帮忙点『赞』or『在看』or『转发』吧，这对我非常重要，感谢！(๑˃̵ᴗ˂̵)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;If You Want To Go Fast, Go Alone.&lt;/p&gt;
&lt;p&gt;If You Want To Go Far, Go With Others.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;整理 2023 &amp;amp; 2024 年的 M</summary>
      
    
    
    
    <category term="MySQL" scheme="https://shawnyan.cn/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://shawnyan.cn/tags/mysql/"/>
    
    <category term="mysql 5.7" scheme="https://shawnyan.cn/tags/mysql-5-7/"/>
    
    <category term="mysql 8.0" scheme="https://shawnyan.cn/tags/mysql-8-0/"/>
    
    <category term="linux" scheme="https://shawnyan.cn/tags/linux/"/>
    
    <category term="mysql 8.x" scheme="https://shawnyan.cn/tags/mysql-8-x/"/>
    
    <category term="ocp" scheme="https://shawnyan.cn/tags/ocp/"/>
    
  </entry>
  
  <entry>
    <title>如何为 TiDB 文档提交第一个 PR</title>
    <link href="https://shawnyan.cn/2024/tidb/tidb-docs-1st-pr/"/>
    <id>https://shawnyan.cn/2024/tidb/tidb-docs-1st-pr/</id>
    <published>2024-01-01T02:26:16.000Z</published>
    <updated>2024-01-01T02:26:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>今日已是 2024 年，2023 已成过往，去年我曾说，如果中国数据库的文档有排行榜，那么 TiDB 文档注定“遥遥领先”（褒义词）。</p><h2 id="TiDB-Docs-Dash">TiDB Docs Dash</h2><img  alt="dash.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-4f791564-7f5d-4152-bd6b-67a9f0880080.png"                      referrerpolicy="no-referrer"                ><p>2024 TiDB 文档挑战赛来啦!</p><p>首届 TiDB 文档挑战赛 (TiDB Docs Dash) 将于 2024 年 1 月 9 日 - 12 日进行。同时，我们也希望将借此机会将 TiDB 社区成员聚集到一起，为大家带来一次有趣的协作体验。</p><p>通过此次活动，你将有机会结识其他社区成员，与大家一起共同改进 TiDB 和 TiDB Cloud 文档。</p><p>详细活动介绍，请参阅帖子：<a class="link"   href="https://asktug.com/t/topic/1019364?u=shawnyan" >TiDB 文档挑战赛 2024 来了！ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>或公众号文章：<a class="link"   href="https://mp.weixin.qq.com/s/875zEvSi2ys3lUykuHolSA" >2024 TiDB 文档挑战赛｜提 PR 和 Issue 来赢取 Bose 耳机、机械键盘等奖品吧！ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="TiDB-文档">TiDB 文档</h2><p>TiDB 文档目前支持中、英、日三种语言。文档站链接分别是：</p><ul><li>简体中文：<a class="link"   href="https://docs.pingcap.com/zh/tidb/stable" >https://docs.pingcap.com/zh/tidb/stable <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>English：<a class="link"   href="https://docs.pingcap.com/tidb/stable" >https://docs.pingcap.com/tidb/stable <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>日本語：<a class="link"   href="https://docs.pingcap.com/ja/tidb/stable" >https://docs.pingcap.com/ja/tidb/stable <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><p>其中，日本语文档站是由英文机翻的。(このページは英語版のページを機械翻訳しています。)</p><p>TiDB 文档也是开源的，中文和英文站的文档仓库分别是：</p><ul><li>TiDB 中文文档仓库：<a class="link"   href="https://github.com/pingcap/docs-cn" >https://github.com/pingcap/docs-cn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li>TiDB 和 TiDB Cloud 英文文档仓库：<a class="link"   href="https://github.com/pingcap/docs" >https://github.com/pingcap/docs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><p>欢迎点个 Star 🌟</p><img  alt="star.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-a1cb517f-cde5-41fb-baaf-5226e4ed2777.png"                      referrerpolicy="no-referrer"                ><h2 id="提交-PR">提交 PR</h2><p>下面演示一下如何为 TiDB 文档提交 PR (Pull Reuest) 。<br>需要准备的环境有 git, vscode，注册 GitHub 账号，并 fork 文档的源码仓库。</p><h3 id="Fork">Fork</h3><p>点击仓库右上角的 Fork 按钮，或直接点击这里 <strong><a class="link"   href="https://github.com/pingcap/docs-cn/fork" >Fork <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></strong>，等待 Fork 完成即可。</p><img  alt="fork.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-e8b52214-bf01-4b12-b8b6-f5791b31b37c.png"                      referrerpolicy="no-referrer"                ><p>Fork 完成后，会在自己的用户下出现一个源码仓，这里看到已经 Fork 完成，并且是最新版本。</p><img  alt="forked.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-3acd341f-7fa6-43d1-aa35-b62b81c957ab.png"                      referrerpolicy="no-referrer"                ><h3 id="Clone">Clone</h3><p>打开 VS Code，源码控制，登录 GitHub 账户，如果浏览器已经登陆，点击【Clone from GitHub】会自动登录。</p><img  alt="clone1.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-b915c0de-74a7-4774-8421-28d3d56a9184.png"                      referrerpolicy="no-referrer"                ><p>登录后，输入【username/docs-cn】。</p><img  alt="clone2.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-669c6308-e503-4ca8-95dd-40a89376c0ac.png"                      referrerpolicy="no-referrer"                ><h3 id="Branch">Branch</h3><p>克隆代码后，创建一个新分支，用于修改、维护，这里命名为【br-1st-pr】。</p><img  alt="branch.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-2a02bbd8-274c-4a0f-9de4-6460b29fdac5.png"                      referrerpolicy="no-referrer"                ><h3 id="Modify">Modify</h3><p>找到需要修改的文件，按需修改后提交。</p><p>关于如何找到文件所在路径的问题，我们在查阅文档时，右上角有个【文档反馈】的链接，点击后会提示文件所在路径。</p><p>例如，我想修改 【TiDB 7.5.0 Release Notes】 页面，点击右上角【文档反馈】，</p><img  alt="modify.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-480a9c01-c4ea-46a6-b176-4baeb2d82dcb.png"                      referrerpolicy="no-referrer"                ><p>将会跳转到【pingcap/docs-cn】的 Issues 页面，并给出了源码路径。</p><img  alt="modify2.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-59d5179b-4014-47bc-bd02-f9fc0b8ec839.png"                      referrerpolicy="no-referrer"                ><p>修改后，Source Control 会提示 Changes ，Commit 后会先提交到本地，</p><img  alt="modify3.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-8a3dfd94-3aab-4a43-9800-3e04cce67665.png"                      referrerpolicy="no-referrer"                ><p>还需要 Push 到远程。</p><img  alt="modify4.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-65c3f2c4-309c-4ce8-be72-82eaf394d0c6.png"                      referrerpolicy="no-referrer"                ><h3 id="PR">PR</h3><p>Push 成功后，可以在 GitHub 上看到修改后的内容，</p><img  alt="modify5.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-4b951651-52db-4bf4-b4e4-7ab154618dbd.png"                      referrerpolicy="no-referrer"                ><p>并提示进行【Compare &amp; pull request】。</p><img  alt="modify6.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-92b88444-08d5-46af-b531-9d895c304dd7.png"                      referrerpolicy="no-referrer"                ><h3 id="CLA">CLA</h3><p>需要注意的是，首次在本仓库提 PR 时，请务必签署 <a class="link"   href="https://cla-assistant.io/pingcap/docs-cn" >Contributor License Agreement <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> (CLA)，否则我们将无法合并你的 PR。成功签署 CLA 后，可继续进行后续操作。</p><img  alt="CLA.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-95731be3-dbb4-4c8b-bdc9-e66ceed75372.png"                      referrerpolicy="no-referrer"                ><h3 id="Merge">Merge</h3><p>提交 PR 后，贵司会有同学定期来进行 Review 和 Approve，静待 Merge 就好。</p><h2 id="Done">Done</h2><p>恭喜你，到此已经基本了解如何对 TiDB 文档进行修改和提 PR 了，欢迎参与 2024 TiDB Docs Dash 活动。</p><h2 id="番外篇">番外篇</h2><p>搜了下记录，2022、2023年给 TiDB 文档提了若干 Issue &amp; PR，希望在正确的道路上继续飞驰。</p><img  alt="图片.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240101-28d89e8f-d033-4a46-9e3d-97f5ca0d9baa.png"                      referrerpolicy="no-referrer"                ><h2 id="Ref">Ref</h2><p>更多内容请参考: <a class="link"   href="https://github.com/pingcap/docs-cn/blob/master/CONTRIBUTING.md" >TiDB 中文文档贡献指南 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>(2024-01-01, 2024 年第 001 篇原创文章)</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今日已是 2024 年，2023 已成过往，去年我曾说，如果中国数据库的文档有排行榜，那么 TiDB 文档注定“遥遥领先”（褒义词）。&lt;/p&gt;
&lt;h2 id=&quot;TiDB-Docs-Dash&quot;&gt;TiDB Docs Dash&lt;/h2&gt;
&lt;img  alt=&quot;dash.png&quot; </summary>
      
    
    
    
    <category term="TiDB" scheme="https://shawnyan.cn/categories/tidb/"/>
    
    <category term="TiDB Docs" scheme="https://shawnyan.cn/categories/tidb/tidb-docs/"/>
    
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="tidb 7.x" scheme="https://shawnyan.cn/tags/tidb-7-x/"/>
    
    <category term="tidb docs" scheme="https://shawnyan.cn/tags/tidb-docs/"/>
    
  </entry>
  
  <entry>
    <title>使用 HyBench 测试 TiDB</title>
    <link href="https://shawnyan.cn/2024/tidb/tidb-test-with-hybench/"/>
    <id>https://shawnyan.cn/2024/tidb/tidb-test-with-hybench/</id>
    <published>2024-01-01T02:26:16.000Z</published>
    <updated>2024-01-01T02:26:16.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240108-dfb9b292-6804-4902-a0b4-55ffede33402.png"                      referrerpolicy="no-referrer"                ><blockquote><p>图片选自: <a class="link"   href="https://asktug.com/t/topic/1020117" >https://asktug.com/t/topic/1020117 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p></blockquote><p>本文将介绍如何使用 HyBench 对 TiDB 进行测试，并简述 HyBench 适配 TiDB 的注意事项。</p><p>Hybench 是一款由中国软件评测中心、清华大学联合牵头，多家公司共同研发的 HTAP 数据库基准测试工具。</p><p>TiDB 是一款兼容 MySQL 的数据库，Hybench 已在 Gitee 开源，支持 MySQL 数据库，通过修改 HyBench 源码以适配 TiDB。</p><h2 id="前置需求">前置需求</h2><ol><li>为方便演示，这里直接启动一个 TiDB 本地测试集群。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# tiup playground display</span><br><span class="line">tiup is checking updates for component playground ...</span><br><span class="line">Starting component `playground`: /root/.tiup/components/playground/v1.14.1/tiup-playground display</span><br><span class="line">Pid   Role     Uptime</span><br><span class="line">---   ----     ------</span><br><span class="line">7146  pd       4h4m9.520051218s</span><br><span class="line">7164  tikv     4h3m23.583874294s</span><br><span class="line">7320  tidb     4h3m10.59454483s</span><br><span class="line">7332  tiflash  4h1m54.080597745s</span><br></pre></td></tr></table></figure></div><ol start="2"><li>准备 JDK 17，并配置环境变量。</li></ol><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# java -version</span><br><span class="line">openjdk version &quot;17.0.9&quot; 2023-10-17 LTS</span><br><span class="line">OpenJDK Runtime Environment (Red_Hat-17.0.9.0.9-1) (build 17.0.9+9-LTS)</span><br><span class="line">OpenJDK 64-Bit Server VM (Red_Hat-17.0.9.0.9-1) (build 17.0.9+9-LTS, mixed mode, sharing)</span><br><span class="line">[root@rocky9 ~]# env | grep -i java</span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-17-openjdk-17.0.9.0.9-2.el9.x86_64</span><br><span class="line">PATH=/root/.tiup/bin:/usr/lib/jvm/java-17-openjdk-17.0.9.0.9-2.el9.x86_64/bin:...</span><br></pre></td></tr></table></figure></div><ol start="3"><li>安装 Maven。</li></ol><p>直接使用 <code>dnf</code> 安装即可，版本信息如下。</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# mvn --version</span><br><span class="line">Apache Maven 3.6.3 (Red Hat 3.6.3-15)</span><br><span class="line">Maven home: /usr/share/maven</span><br><span class="line">Java version: 17.0.9, vendor: Red Hat, Inc., runtime: /usr/lib/jvm/java-17-openjdk-17.0.9.0.9-2.el9.x86_64</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;5.14.0-362.13.1.el9_3.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure></div><img  alt="02.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240117-319d8aaa-67ab-4f1a-b7ec-ae2327f1397c.png"                      referrerpolicy="no-referrer"                ><!--dnf install java-17-openjdk java-17-openjdk-develdnf install mavenvi ~/.bashrcexport JAVA_HOME=/usr/lib/jvm/java-17-openjdk-17.0.9.0.9-2.el9.x86_64export PATH=$JAVA_HOME/bin:$PATH--><h2 id="运行测试">运行测试</h2><h3 id="1-修改数据库连接信息">1. 修改数据库连接信息</h3><p>依据实际需求修改配置文件 <code>conf/db.prop</code> 中的 HOST, IP, USERNAME, PASSWORD 等信息。</p><h3 id="2-生成测试数据">2. 生成测试数据</h3><p>运行生成数据的命令：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t gendata -c conf/db.prop</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t gendata -c conf/db.prop</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:57 - ===============configuration==================</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - xapclient = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at2_percent = 25</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at1_percent = 35</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - apclient = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - xpRunMins = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at4_percent = 15</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - apround = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - url = jdbc:mysql://192.168.8.92:4000/hybench?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - tpRunMins = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at3_percent = 15</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - password = </span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - tpclient = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - fresh_interval = 20</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - sf = 1x</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - classname = com.mysql.cj.jdbc.Driver</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - xtpclient = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - apRunMins = 1</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at5_percent = 7</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - db = tidb</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - username = root</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:59 - at6_percent = 3</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:07:30 [main] INFO  ConfigLoader:62 - </span><br><span class="line">This is a data generator of HyBench, Version 0.1</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">Data is generating...</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">WARNING: dir:/root/hybench/Data_1x not exists! will created.</span><br><span class="line">Data generate not skipped!</span><br><span class="line">Data is ready under the Data folder!</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">----------------</span><br><span class="line">Data generation took 11831 ms</span><br><span class="line">No autoloader, do nothing!</span><br></pre></td></tr></table></figure></div><p>查看生成的数据文件：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 Data_1x]# ll -h</span><br><span class="line">total 11M</span><br><span class="line">-rw-r--r-- 1 root root 1.4M Jan 16 23:07 checkingAccount.csv</span><br><span class="line">-rw-r--r-- 1 root root 315K Jan 16 23:07 checking.csv</span><br><span class="line">-rw-r--r-- 1 root root 305K Jan 16 23:07 company.csv</span><br><span class="line">-rw-r--r-- 1 root root 3.6M Jan 16 23:07 customer.csv</span><br><span class="line">-rw-r--r-- 1 root root 320K Jan 16 23:07 loanApps.csv</span><br><span class="line">-rw-r--r-- 1 root root 411K Jan 16 23:07 loanTrans.csv</span><br><span class="line">-rw-r--r-- 1 root root 1.4M Jan 16 23:07 savingAccount.csv</span><br><span class="line">-rw-r--r-- 1 root root 3.2M Jan 16 23:07 transfer.csv</span><br><span class="line">[root@rocky9 Data_1x]# </span><br></pre></td></tr></table></figure></div><img  alt="03.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240117-868d7816-3444-4eaf-b22c-d292b8e6e451.png"                      referrerpolicy="no-referrer"                ><h3 id="3-初始化表结构">3. 初始化表结构</h3><p>运行生成表结构的命令：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t sql -f conf/tidb/ddl_tidb.sql -c conf/db.prop</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t sql -f conf/tidb/ddl_tidb.sql -c conf/db.prop</span><br><span class="line">2024-01-16 23:11:10 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:11:10 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:11:10 [main] INFO  ConfigLoader:62 - </span><br><span class="line">2024-01-16 23:11:11 [main] INFO  ExecSQL:58 - execute query:CREATE TABLE IF NOT EXISTS  customer (</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><h3 id="4-初始化表索引">4. 初始化表索引</h3><p>运行生成表索引的命令：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t sql -f conf/tidb/create_index_tidb.sql -c conf/db.prop</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t sql -f conf/tidb/create_index_tidb.sql -c conf/db.prop</span><br><span class="line">2024-01-16 23:11:56 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:11:56 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:11:56 [main] INFO  ConfigLoader:62 - </span><br><span class="line">2024-01-16 23:11:58 [main] INFO  ExecSQL:58 - execute query:create index idx_loanapps_1 on loanapps ( applicantid );</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><h3 id="5-导入测试数据">5. 导入测试数据</h3><p>运行导入数据的命令：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t sql -f conf/tidb/load_data_tidb.sql -c conf/db.prop</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t sql -f conf/tidb/load_data_tidb.sql -c conf/db.prop</span><br><span class="line">2024-01-16 23:30:20 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:30:20 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:30:20 [main] INFO  ConfigLoader:62 - </span><br><span class="line">2024-01-16 23:30:22 [main] INFO  ExecSQL:58 - execute query:LOAD DATA LOCAL INFILE &#x27;Data_1x/customer.csv&#x27; INTO TABLE customer FIELDS TERMINATED BY &#x27;,&#x27;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><h3 id="6-连接数据库，查看库表信息">6. 连接数据库，查看库表信息</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="comment">--comments --host 192.168.8.92 --port 4000 -u root</span></span><br><span class="line">use hybench</span><br><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure></div><p>共导入 8 张表。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_hybench <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> checking          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> checkingAccount   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> company           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> loanapps          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> loantrans         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> savingAccount     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> transfer          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></div><h3 id="7-运行-TP-负载测试">7. 运行 TP 负载测试</h3><p>运行负载测试：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t runtp -c conf/db.prop -f conf/tidb/stmt_tidb.toml</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t runtp -c conf/db.prop -f conf/tidb/stmt_tidb.toml</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:57 - ===============configuration==================</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - xapclient = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at2_percent = 25</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at1_percent = 35</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - apclient = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - xpRunMins = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at4_percent = 15</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - apround = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - url = jdbc:mysql://192.168.8.92:4000/hybench?useUnicode=true&amp;characterEncoding=utf-8&amp;allowLoadLocalInfile=true</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - tpRunMins = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at3_percent = 15</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - password = </span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - tpclient = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - fresh_interval = 20</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - sf = 1x</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - classname = com.mysql.cj.jdbc.Driver</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - xtpclient = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - apRunMins = 1</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at5_percent = 7</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - db = tidb</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - username = root</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:59 - at6_percent = 3</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:38:57 [main] INFO  ConfigLoader:62 - </span><br><span class="line">2024-01-16 23:38:58 [main] INFO  HyBench:61 - Begin TP Workload</span><br><span class="line">2024-01-16 23:38:58 [pool-3-thread-1] INFO  Client:263 - Begin to run :TPClient, Test Duration is 1 mins</span><br><span class="line">2024-01-16 23:39:04 [Thread-0] INFO  Client:297 - Transaction 3 : max rt : 38.0 | min rt :23.0 | avg rt : 28.33 | 95% rt : 38.00 | 99% rt : 38.00</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:39:04 [Thread-0] INFO  Client:307 - Current 1/10 time TP TPS is 6.50</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:39:58 [Thread-0] INFO  Client:307 - Current 10/10 time TP TPS is 10.88</span><br><span class="line">2024-01-16 23:39:58 [pool-3-thread-1] INFO  Client:397 - Finished to execute TPClient</span><br><span class="line">2024-01-16 23:39:58 [main] INFO  HyBench:105 - TP Workload is done.</span><br><span class="line">2024-01-16 23:39:58 [main] INFO  HyBench:407 - Congs~ Test is done! Bye!</span><br><span class="line">====================Test Summary========================</span><br><span class="line">Test starts at 2024-01-16 23:38:58</span><br><span class="line">Test ends at 2024-01-16 23:39:58</span><br><span class="line">AP Concurrency is 0</span><br><span class="line">TP Concurrency is 1</span><br><span class="line">Total amount of TP Transaction is 654</span><br><span class="line">TPS is 10.9</span><br><span class="line">Query/Transaction response time(ms) histogram : </span><br><span class="line">------------TP-------------------</span><br><span class="line">TP Transaction  1 : max rt :      30.00 | min rt :      15.00 | avg rt :      21.28 | 95% rt :      30.00 | 99% rt :      30.00 </span><br><span class="line">TP Transaction  2 : max rt :      59.00 | min rt :      16.00 | avg rt :      27.83 | 95% rt :      59.00 | 99% rt :      59.00 </span><br><span class="line">TP Transaction  3 : max rt :      43.00 | min rt :      17.00 | avg rt :      24.08 | 95% rt :      41.25 | 99% rt :      43.00 </span><br><span class="line">TP Transaction  4 : max rt :      47.00 | min rt :      14.00 | avg rt :      24.52 | 95% rt :      41.40 | 99% rt :      47.00 </span><br><span class="line">TP Transaction  5 : max rt :      76.00 | min rt :      23.00 | avg rt :      37.18 | 95% rt :      72.55 | 99% rt :      76.00 </span><br><span class="line">TP Transaction  6 : max rt :      55.00 | min rt :      18.00 | avg rt :      29.35 | 95% rt :      54.30 | 99% rt :      55.00 </span><br><span class="line">TP Transaction  7 : max rt :      99.00 | min rt :      17.00 | avg rt :      32.33 | 95% rt :      99.00 | 99% rt :      99.00 </span><br><span class="line">TP Transaction  8 : max rt :      47.00 | min rt :      14.00 | avg rt :      25.90 | 95% rt :      46.20 | 99% rt :      47.00 </span><br><span class="line">TP Transaction  9 : max rt :     107.00 | min rt :      50.00 | avg rt :      70.00 | 95% rt :      99.75 | 99% rt :     107.00 </span><br><span class="line">TP Transaction 10 : max rt :     683.00 | min rt :     214.00 | avg rt :     393.02 | 95% rt :     617.40 | 99% rt :     683.00 </span><br><span class="line">TP Transaction 11 : max rt :     108.00 | min rt :      45.00 | avg rt :      66.57 | 95% rt :      93.00 | 99% rt :     108.00 </span><br><span class="line">TP Transaction 12 : max rt :     111.00 | min rt :      41.00 | avg rt :      64.20 | 95% rt :      98.20 | 99% rt :     111.00 </span><br><span class="line">TP Transaction 13 : max rt :     267.00 | min rt :      70.00 | avg rt :     122.98 | 95% rt :     219.45 | 99% rt :     267.00 </span><br><span class="line">TP Transaction 14 : max rt :     256.00 | min rt :      70.00 | avg rt :     116.97 | 95% rt :     236.20 | 99% rt :     256.00 </span><br><span class="line">TP Transaction 15 : max rt :     101.00 | min rt :      46.00 | avg rt :      67.52 | 95% rt :      99.40 | 99% rt :     101.00 </span><br><span class="line">TP Transaction 16 : max rt :     209.00 | min rt :      65.00 | avg rt :     102.05 | 95% rt :     205.90 | 99% rt :     209.00 </span><br><span class="line">TP Transaction 17 : max rt :     150.00 | min rt :      48.00 | avg rt :      71.58 | 95% rt :     116.50 | 99% rt :     150.00 </span><br><span class="line">TP Transaction 18 : max rt :     124.00 | min rt :      46.00 | avg rt :      69.42 | 95% rt :     103.00 | 99% rt :     124.00 </span><br><span class="line">====================Thank you!========================</span><br></pre></td></tr></table></figure></div><h3 id="8-清理测试表数据">8. 清理测试表数据</h3><p>运行清理脚本：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hybench -t sql -f conf/dropTables.sql -c conf/db.prop</span><br></pre></td></tr></table></figure></div><p>输出结果：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 hybench]# ./hybench -t sql -f conf/dropTables.sql -c conf/db.prop</span><br><span class="line">2024-01-16 23:43:07 [main] INFO  HyBench:324 - Hi~Bench, HyBench</span><br><span class="line">...</span><br><span class="line">2024-01-16 23:43:07 [main] INFO  ConfigLoader:61 - ===============configuration==================</span><br><span class="line">2024-01-16 23:43:07 [main] INFO  ConfigLoader:62 - </span><br><span class="line">2024-01-16 23:43:09 [main] INFO  ExecSQL:58 - execute query:drop table if exists customer;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div><h2 id="注意事项">注意事项</h2><ol><li><p>HyBench 需要使用 JDK 17，这在 README 中有一处提及，全文搜索一下比较容易找到。</p><blockquote><p>封装了java执行命令(需要配置jdk17)</p></blockquote></li><li><p>目前，开源版本只支持1X、10x数据，后续在商业版本中会增加100x,1000x及更大规模的数据。</p><p>对应文件 <code>src/main/resource/parameters.toml</code> 中可以看到 <code>[1x]</code> 和 <code>[10x]</code>。</p></li><li><p>导入数据使用的 SQL 命令为 <code>LOAD DATA LOCAL INFILE</code>，是 <code>db.prop</code> 配置文件中，JDBC 连接串需要增加参数 <code>allowLoadLocalInfile=true</code>。</p></li><li><p>自 v7.4.0 起，TiDB 已经兼容 MySQL 8.0 的主要功能，推荐使用最新版本的 MySQL Connector/J 来连接 TiDB，因此源码工程依赖升级为 <code>mysql-connector-j:8.2.0</code>。</p></li></ol><h2 id="总结">总结</h2><p>本文基于开源数据库压测软件 HyBench 对 TiDB 进行适配，并做简单测试。</p><p>项目地址：<a class="link"   href="https://gitee.com/shawnyan/hybench/" >shawnyan/hybench <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>如果没有特殊需求，优先推荐使用 TiUP bench 组件对 TiDB 进行压测。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;img01.png&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://oss-</summary>
      
    
    
    
    <category term="TiDB" scheme="https://shawnyan.cn/categories/tidb/"/>
    
    <category term="TiDB Docs" scheme="https://shawnyan.cn/categories/tidb/tidb-docs/"/>
    
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="tidb 7.x" scheme="https://shawnyan.cn/tags/tidb-7-x/"/>
    
    <category term="tidb docs" scheme="https://shawnyan.cn/tags/tidb-docs/"/>
    
  </entry>
  
  <entry>
    <title>【2023年终盘点】那些今年考下的国产数据库认证</title>
    <link href="https://shawnyan.cn/2023/other/my-db-cert-2023/"/>
    <id>https://shawnyan.cn/2023/other/my-db-cert-2023/</id>
    <published>2023-12-28T02:11:15.000Z</published>
    <updated>2023-12-28T02:11:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>几个月前讨论过 <a class="link"   href="https://www.modb.pro/db/1688384690087092224" >如何成为一名国产数据库DBA <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ，如今到了年末，是时候来盘点一下今年考取了几个国产数据库认证。<br>需要提前说明的是，本文中涉及的几个证书都是 FREE 的，也就不能抵个税了，合法、合规。</p><p>这四个证书分别是：</p><ol><li>TiDB 从业者认证</li><li>GBase 8c GDCA 认证</li><li>YashanDB YCA 认证</li><li>Galaxybase CBCA 认证</li></ol><h2 id="TiDB">TiDB</h2><p><a class="link"   href="https://learn.pingcap.com/learner/exam-market/detail/2010035" >PingCAP 认证 TiDB 数据库从业者考试 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 是今年新推出的认证，不同于之前推出的 PCTA 和 PCTP 认证，从业者认证的考点更加基础，每一位对数据库感兴趣的同学都可以来尝试一下，是国产数据库从业者（产品经理、销售人员等）的必备证书之一。</p><img  alt="图片.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231228-d1114515-8e18-43cc-9d7a-bbba8068e1cc.png"                      referrerpolicy="no-referrer"                ><p>特别提示，考试形式是选择题，共20道，满分100，如果获得60分，那么恭喜你，成功通过考试。</p><p>关于考试题库的问题，没有题库，但是有些参考资料会助你一臂之力。</p><p>PingCAP 官方推出的限时免费课程： <a class="link"   href="https://learn.pingcap.com/learner/course/960001" >TiDB 数据库核心原理与架构（101） <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>本课程专为将在工作中使用 TiDB 数据库的开发人员、DBA 和架构师设计。 本门课侧重于 TiDB 数据库的架构和设计原则，这是未来管理、开发、性能调整和故障排除的基础。</p></blockquote><p>还有 PingCAP 文档中文站： <a class="link"   href="https://docs.pingcap.com/zh/" >PingCAP 文档中心 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>如果国产数据库的文档也有排行榜，那么，TiDB 文档将会是“遥遥领先”。</p><p>顺便安利一个新活动，<a class="link"   href="https://asktug.com/t/topic/1019364" >2024 TiDB 文档挑战赛 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 提PR或Issue可以赢取Bose耳机、机械键盘等奖品。</p><img  alt="0.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231226-a26f188c-9ec5-4520-be93-3e800467fd6f.png"                      referrerpolicy="no-referrer"                ><h2 id="GBase">GBase</h2><p>今年 GBase 培训中心举办了十二期培训班，其中 GBase 8a / 8s / 8c 三个方向分别举办了 4 期，并且在3月举办首期“GBase 8c 多模多态分布式数据库认证培训班”，我参加的正是8c首期。</p><p>预计 2024 年一月份将迎来 24年第一期培训班，欢迎还未接触过 GBase 数据库的同学报名参加。</p><p>还有一个好消息是今年 GBase 网站全面升级改版，可以更加便利地从官网下载证书。直达链接： <a class="link"   href="https://www.gbase.cn/learn/certification-query" >https://www.gbase.cn/learn/certification-query <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><img  alt="图片.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231228-23b63027-3e2d-48e1-8f89-e02bc71638c1.png"                      referrerpolicy="no-referrer"                ><p>GBase 8a 是面向大数据分析类应用领域的一款高性能国产新型数据库产品，用于满足数据密集型行业日益增大的数据查询、数据统计、数据分析、数据挖掘和数据备份等需求，可用做数据仓库系统、BI系统和决策支持系统的承载数据库。</p><p>GBase 8s 是天津南大通用数据技术股份有限公司自主研发的、成熟稳定的基于共享存储的数据库集群，拥有自主知识产权。GBase 8s适用于OLTP 应用场景，包括金融、电信行业的关键核心业务系统，安全、党政、国防等行业对信息安全性有较高要求的信息系统，以及大型企业的经营类、管理类信息系统，能够提供7*24小时不间断运行处理能力，在80%以上场景中可以替代国际主流数据库。</p><p>GBase 8c 是基于openGauss3.0构建的一款多模多态的分布式数据库，支持行存、列存、内存等多种存储模式和单机、主备式、分布式等多种部署形态。GBase 8c具备高性能、高可用、弹性伸缩、高安全性等特性，可以部署在物理机、虚拟机、容器、私有云和公有云，为关键行业核心系统、互联网业务系统和政企业务系统提供安全、稳定、可靠的数据存储和管理服务。</p><img  alt="1.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231226-f80eb142-6554-41ec-84da-552d26157932.jpg"                      referrerpolicy="no-referrer"                ><h2 id="YashanDB">YashanDB</h2><p>再次 <a class="link"   href="https://www.modb.pro/db/1734114896265175040" >恭喜这些体验官！首批 YashanDB 尝鲜征文活动获奖名单公布！ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>崖山数据库系统YashanDB是深圳计算科学研究院完全自主研发设计的新型数据库系统，融入原创理论，支持单机/主备、共享集群、分布式等多种部署方式，覆盖OLTP/HTAP/OLAP交易和分析混合负载场景，为客户提供一站式的企业级融合数据管理解决方案。</p></blockquote><p>YashanDB个人版已正式向所有用户和开发者全面开放下载，从试用情况来看，YashanDB目前是最像Oracle数据的国产数据库，可以实现Oracle的平滑替代，完成数据库国产化目标。</p><p>关于 YashanDB 的 YCA 认证（YashanDB认证管理员），今年已经举办五期，通过YCA认证的学习，学员可以深入了解崖山数据库的架构、功能和运维管理等方面的知识，从而更好地应用崖山数据库解决实际业务问题。</p><img  alt="图片.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231228-9bf7326f-932c-47b0-878b-28261b98a921.png"                      referrerpolicy="no-referrer"                ><p>对于Oracle DBA来说，YCA认证过于简单，甚至可以裸考通过，而且YashanDB个人版也只能搭建单体或者主从架构，无法体验集群架构，所以更多精彩内容目前还处于“封印”状态。</p><img  alt="2.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231226-1ba30f89-831d-45db-a676-e175249e629d.jpg"                      referrerpolicy="no-referrer"                ><h2 id="Galaxybase">Galaxybase</h2><p>Galaxybase是中国自主知识产权的通用商业化分布式图数据库。本月在中国数据库排行榜图库分类中排名第五。</p><img  alt="图片.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231228-9b556905-bb50-4c48-8560-7dafe3739380.png"                      referrerpolicy="no-referrer"                ><p>之前撰文介绍过 Galaxybase 的 GBCA 认证， <a class="link"   href="https://www.modb.pro/db/645884" >GBCA (Galaxybase) 认证学习资料内参 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>如果对图数据库感兴趣，可以了解 创邻科技 Galaxybase 以及这个 GBCA 认证。</p><p>此外，创邻科技 Galaxybase 的中级认证 GBCP（Galaxybase Certified Professional） 也已经正式开课了，作为从 GBCA 图数据库入门跃升到 GBCM 图技术专家的中间课程，GBCP培训注重提升学员的图数据库实操能力，解决实际开发应用难题。</p><p>具体可以戳文了解： <a class="link"   href="https://www.modb.pro/db/1732615042200330240" >拿下创邻科技GBCP证书，成为图数据库专家！ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><img  alt="3.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231226-eaf3c487-4190-40fe-b8e2-878c34b4f81c.png"                      referrerpolicy="no-referrer"                ><h2 id="尾声">尾声</h2><p>盘点是一种总结，认证是一个学习阶段的见证，我们都在负重前行，期待明年会更好。</p><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;几个月前讨论过 &lt;a class=&quot;link&quot;   href=&quot;https://www.modb.pro/db/1688384690087092224&quot; &gt;如何成为一名国产数据库DBA &lt;i class=&quot;fa-regular fa-arrow-up-right-from-</summary>
      
    
    
    
    <category term="清单" scheme="https://shawnyan.cn/categories/%E6%B8%85%E5%8D%95/"/>
    
    
    <category term="gbase" scheme="https://shawnyan.cn/tags/gbase/"/>
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="yashan" scheme="https://shawnyan.cn/tags/yashan/"/>
    
  </entry>
  
  <entry>
    <title>AntDB v7.2.0 社区版适配 Rocky 9 及体验笔记</title>
    <link href="https://shawnyan.cn/2023/other/antdb-install/"/>
    <id>https://shawnyan.cn/2023/other/antdb-install/</id>
    <published>2023-12-11T07:52:04.000Z</published>
    <updated>2023-12-11T07:52:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="关于-AntDB">关于 AntDB</h2><p>2023年12月的 墨天轮中国数据库流行度排行 火热出炉，目前，AntDB 排在第十位。<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><p>AntDB 数据库始于2008年，隶属于亚信科技旗下通用型企业级数据库产品，在运营商的核心系统上，为全国24个省份的10亿多用户提供在线服务，具备高性能、弹性扩展、可靠性等产品特性，峰值每秒可处理百万笔通信核心交易，应用范围包含通信、金融、交通、能源、物联网等行业。<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p><img  alt="img.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231211-b4d45c01-ec47-4a8f-8487-8d9d947eee23.png"                      width=800px referrerpolicy="no-referrer"                ><h2 id="关于-AntDB-社区版">关于 AntDB 社区版</h2><p>3月1日，亚信科技AntDB数据库社区版正式开放免费下载。作为AntDB数据库的首个社区版产品，AntDB-CE（Community Edition）V7.2.0具有完整、易用、兼容度高的企业级分布式数据库产品特性。<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p><p>AntDB-CE社区版采用了Share-Nothing的无共享架构，包括计算节点(Coordinator)、数据节点(DB)、全局事务管理器（GTM）和管理节点四种组件。</p><ul><li>计算节点（Coordinator）</li></ul><p>提供SQL解析、优化、路由、结果汇聚、分布式事务控制等功能</p><ul><li>数据节点(DB)</li></ul><p>真正存储业务数据的组件，通过分库分表实现数据库能力的水平扩展，提供多种分片函数，支持定制开发；支持数据节点的分组管理</p><ul><li>全局事务管理器(GTMCoordinator）</li></ul><p>分布式事务管理的重要组件；提供事务ID和事务快照以及全局序列号、时间戳，参与2PC提供分布式MVCC 能力，同时提供Coordinator 的能力</p><ul><li>管理节点（Manager）</li></ul><p>管理整个集群节点的添加、配置、删除、启停、初始化、主备倒换等所有状态。</p><h2 id="AntDB-社区版集中式部署安装">AntDB 社区版集中式部署安装</h2><p>从官方网站<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> 下载安装包，由于我本地操作系统为 Rocky Linux 9.3，网站并没有提供对应版本的安装包，这里选择了 centos8 作为替代。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]$ cat /etc/system-release</span><br><span class="line">Rocky Linux release 9.3 (Blue Onyx)</span><br></pre></td></tr></table></figure></div><p>官方网站已经给出了安装步骤，可以参考：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">仅需 4 步，完成 AntDB 社区版安装：</span><br><span class="line"></span><br><span class="line">1. 下载在root用户下</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">wget http://gz.antdb.net/zip/antdb-ce-7.2.0.centos8.x86_64.tar.gz</span></span><br><span class="line">                  </span><br><span class="line">2. 解压</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">tar-zxvf antdb-ce-7.2.0.centos8.x86_64.tar.gz</span></span><br><span class="line">                  </span><br><span class="line">3. 安装</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">cd</span> antdb-ce-7.2.0.centos8.x86_64</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sh antdb_install.sh -s</span></span><br><span class="line">                  </span><br><span class="line">4. 进入客户端</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">su - antdb</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">psql -d antdb -p 6655</span></span><br><span class="line">//根据部署的结果修改端口号</span><br><span class="line"></span><br><span class="line">操作系统：CentOS 8 </span><br></pre></td></tr></table></figure></div><h3 id="适配-Rocky-9">适配 Rocky 9</h3><p>在执行安装脚本时，遇到报错，提示不支持 Rocky 操作系统。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 antdb-ce-7.2.0.centos8.x86_64]$ ./antdb_install.sh -s</span><br><span class="line">[Info] AntDB install begins</span><br><span class="line">The current operating system hardware resources are less than the recommended hardware requirements for antdb operation.</span><br><span class="line">...</span><br><span class="line">Continue the installation.</span><br><span class="line">It is recommended to improve the hardware configuration to improve the user experience.</span><br><span class="line">No package was found.</span><br><span class="line">The current operating system needs a package like antdb-.*.rocky.x86_64.tar.gz.</span><br><span class="line">Please check the installation package. Exit.</span><br><span class="line">[shawnyan@rocky9 antdb-ce-7.2.0.centos8.x86_64]$</span><br></pre></td></tr></table></figure></div><p>找到相关的判断逻辑，然后增加 Rocky 部分即可。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ./setup/common/setup-common</span><br></pre></td></tr></table></figure></div><p>在第 252 行增加如下判断。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//:252</span><br><span class="line">         Rocky)</span><br><span class="line">             os_version=8</span><br><span class="line">             os_name=&quot;CentOS&quot;</span><br><span class="line">             ;;</span><br></pre></td></tr></table></figure></div><p>再次安装，遇到报错，提示缺少共享库文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/shawnyan/app/antdb/bin/initdb: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure></div><p>需要安装 <code>compat-openssl11</code> 依赖。</p><p>再次安装，提示成功。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 antdb-ce-7.2.0.centos8.x86_64]$ ./antdb_install.sh -s</span><br><span class="line">[Info] AntDB install begins</span><br><span class="line">...</span><br><span class="line">/data/stonedb/antdb-ce-7.2.0.centos8.x86_64/setup/common/AntDB-license-agreement-Community.txt</span><br><span class="line">chown: invalid group: ‘shawnyan:shawnyanwheel’</span><br><span class="line">...</span><br><span class="line">[Info] AntDB install succeeds!</span><br><span class="line">[Info] AntDB init begins</span><br><span class="line">[Info] AntDB info:</span><br><span class="line">+----------+-----------+------+-------------------------------+-------+----------+</span><br><span class="line">| database |    ip     | port |             data              | user  | password |</span><br><span class="line">+----------+-----------+------+-------------------------------+-------+----------+</span><br><span class="line">| antdb    | localhost | 6655 | /home/shawnyan/app/antdb/data | antdb | antdb    |</span><br><span class="line">+----------+-----------+------+-------------------------------+-------+----------+</span><br><span class="line"></span><br><span class="line">[Info] AntDB logon:</span><br><span class="line">         adb -d &quot;database&quot; -U &quot;user&quot; -p &quot;port&quot;</span><br><span class="line"></span><br><span class="line">[Info] AntDB init succeeds</span><br></pre></td></tr></table></figure></div><!--额外增加环境变量<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PGDATABASE=antdb</span><br><span class="line">export PGDATA=/home/shawnyan/app/antdb/data</span><br><span class="line">export PGPORT=6655</span><br></pre></td></tr></table></figure></div><p>–&gt;</p><p>此时，AntDB 已经初始化成功，并且启动，如上面信息所示，监听端口为 6655。</p><h3 id="连接-AntDB">连接 AntDB</h3><p>使用 <code>adb</code> 命令，连接 AntDB，并查看版本信息和数据库信息。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 ~]$ adb</span><br><span class="line">adb (13.3)</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">antdb=# select version();</span><br><span class="line">                                   version</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"> PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 9.5.0, 64-bit</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">antdb=# \l</span><br><span class="line">                                  List of databases</span><br><span class="line">   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges</span><br><span class="line">-----------+----------+----------+-------------+-------------+-----------------------</span><br><span class="line"> antdb     | shawnyan | UTF8     | en_US.UTF-8 | en_US.UTF-8 |</span><br><span class="line"> postgres  | shawnyan | UTF8     | en_US.UTF-8 | en_US.UTF-8 |</span><br><span class="line"> template0 | shawnyan | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/shawnyan          +</span><br><span class="line">           |          |          |             |             | shawnyan=CTc/shawnyan</span><br><span class="line"> template1 | shawnyan | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/shawnyan          +</span><br><span class="line">           |          |          |             |             | shawnyan=CTc/shawnyan</span><br><span class="line">(4 rows)</span><br></pre></td></tr></table></figure></div><h2 id="开启-Oracle-兼容参数">开启 Oracle 兼容参数</h2><p>AntDB 与 Oracle 数据库高度兼容，使得企业现有的基于Oracle数据库开发的应用程序无需做任何修改或只做少量的修改便可以运行在AntDB平台之上，由此降低了程序迁移的风险，减少了重写应用的成本，从而实现高效快捷的应用迁移。AntDB与Oracle数据库的兼容性包括两个大的方面：多模态SQL解析引擎和语法的兼容性。<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></p><p>AntDB 中的 Oracle 兼容参数，可以通过全局变量和会话变量进行修改。并支持打印相关调试信息，由参数 <code>debug_print_grammar</code> 进行控制。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> debug_print_grammar<span class="operator">=</span>t;</span><br></pre></td></tr></table></figure></div><p>修改会话变量，并测试 Oracle 语法：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> grammar <span class="keyword">to</span> oracle;</span><br><span class="line"><span class="keyword">show</span> grammar;</span><br><span class="line"><span class="comment">/*ora*/</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure></div><p>输出：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">antdb<span class="operator">=</span># <span class="keyword">set</span> grammar <span class="keyword">to</span> oracle;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">show</span> grammar;</span><br><span class="line"> grammar</span><br><span class="line"><span class="comment">---------</span></span><br><span class="line"> oracle</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># <span class="comment">/*ora*/</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual;</span><br><span class="line"> DUMMY</span><br><span class="line"><span class="comment">-------</span></span><br><span class="line"> X</span><br><span class="line">(<span class="number">1</span> <span class="type">row</span>)</span><br></pre></td></tr></table></figure></div><p>查看命名空间信息：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">antdb<span class="operator">=</span># <span class="keyword">SELECT</span> oid, nspname</span><br><span class="line">antdb<span class="operator">-</span># <span class="keyword">FROM</span> pg_namespace;</span><br><span class="line">  OID  <span class="operator">|</span>      NSPNAME</span><br><span class="line"><span class="comment">-------+--------------------</span></span><br><span class="line">    <span class="number">99</span> <span class="operator">|</span> pg_toast</span><br><span class="line">    <span class="number">11</span> <span class="operator">|</span> pg_catalog</span><br><span class="line">  <span class="number">2200</span> <span class="operator">|</span> public</span><br><span class="line"> <span class="number">13391</span> <span class="operator">|</span> information_schema</span><br><span class="line">  <span class="number">9098</span> <span class="operator">|</span> oracle</span><br><span class="line"> <span class="number">13765</span> <span class="operator">|</span> dbms_output</span><br><span class="line"> <span class="number">13767</span> <span class="operator">|</span> dbms_lock</span><br><span class="line"> <span class="number">13781</span> <span class="operator">|</span> dbms_random</span><br><span class="line">(<span class="number">8</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure></div><h2 id="简单-SQL-测试">简单 SQL 测试</h2><h3 id="创建序列、表">创建序列、表</h3><p>创建序列 <code>t1_seq</code>，创建表 <code>t1</code>，插入测试数据，并查询表数据。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SEQUENCE t1_seq;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (id <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> nextval(<span class="string">&#x27;t1_seq&#x27;</span>), name VARCHAR2(<span class="number">10</span>), c3 NUMBER);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 (name, c3) <span class="keyword">VALUES</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;B &#x27;</span>, <span class="number">2</span>),(<span class="string">&#x27; c&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>, length(name) <span class="keyword">from</span> t1;</span><br></pre></td></tr></table></figure></div><p>输出：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan<span class="variable">@rocky9</span> <span class="operator">~</span>]$ adb</span><br><span class="line">adb (<span class="number">13.3</span>)</span><br><span class="line">Type &quot;help&quot; <span class="keyword">for</span> help.</span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">set</span> grammar <span class="keyword">to</span> oracle;</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">CREATE</span> SEQUENCE t1_seq;</span><br><span class="line"><span class="keyword">CREATE</span> SEQUENCE</span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (id <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> nextval(<span class="string">&#x27;t1_seq&#x27;</span>), name VARCHAR2(<span class="number">10</span>), c3 NUMBER);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 (name, c3) <span class="keyword">VALUES</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;B &#x27;</span>, <span class="number">2</span>),(<span class="string">&#x27; c&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">3</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span>, length(name) <span class="keyword">from</span> t1;</span><br><span class="line"> ID <span class="operator">|</span> NAME <span class="operator">|</span> C3 <span class="operator">|</span> LENGTH(NAME)</span><br><span class="line"><span class="comment">----+------+----+--------------</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> A    <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>            <span class="number">1</span></span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> B    <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>            <span class="number">2</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span>  c   <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>            <span class="number">2</span></span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure></div><h3 id="创建、刷新物化视图">创建、刷新物化视图</h3><p>创建物化视图 <code>mv_t1</code>，并测试刷新物化视图命令。创建物化视图的同时，导入6条数据，再插入6条数据，刷新物化视图后，物化视图中有12条数据。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> MATERIALIZED <span class="keyword">VIEW</span> mv_t1 <span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> t1;</span><br><span class="line"></span><br><span class="line">REFRESH MATERIALIZED <span class="keyword">VIEW</span> mv_t1;</span><br></pre></td></tr></table></figure></div><p>输出：</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">antdb<span class="operator">=</span># <span class="keyword">CREATE</span> MATERIALIZED <span class="keyword">VIEW</span> mv_t1 <span class="keyword">AS</span></span><br><span class="line">antdb<span class="operator">-</span># <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">antdb<span class="operator">-</span># <span class="keyword">FROM</span> t1;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># \d<span class="operator">+</span> mv_t1</span><br><span class="line">                                   Materialized <span class="keyword">view</span> &quot;public.mv_t1&quot;</span><br><span class="line"> <span class="keyword">Column</span> <span class="operator">|</span>        Type         <span class="operator">|</span> <span class="keyword">Collation</span> <span class="operator">|</span> Nullable <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Storage  <span class="operator">|</span> Stats target <span class="operator">|</span> Description</span><br><span class="line"><span class="comment">--------+---------------------+-----------+----------+---------+----------+--------------+-------------</span></span><br><span class="line"> id     <span class="operator">|</span> <span class="type">integer</span>             <span class="operator">|</span>           <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span> plain    <span class="operator">|</span>              <span class="operator">|</span></span><br><span class="line"> name   <span class="operator">|</span> oracle.varchar2(<span class="number">10</span>) <span class="operator">|</span>           <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span> extended <span class="operator">|</span>              <span class="operator">|</span></span><br><span class="line"> c3     <span class="operator">|</span> <span class="type">numeric</span>             <span class="operator">|</span>           <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span> main     <span class="operator">|</span>              <span class="operator">|</span></span><br><span class="line"><span class="keyword">View</span> definition:</span><br><span class="line"> <span class="keyword">SELECT</span> t1.id,</span><br><span class="line">    t1.name,</span><br><span class="line">    t1.c3</span><br><span class="line">   <span class="keyword">FROM</span> t1;</span><br><span class="line">Access <span class="keyword">method</span>: heap</span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">insert</span> <span class="keyword">into</span> t1(name) <span class="keyword">select</span> name <span class="keyword">from</span> t1;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">6</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mv_t1;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span> c3</span><br><span class="line"><span class="comment">----+------+----</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> A    <span class="operator">|</span>  <span class="number">1</span></span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> B    <span class="operator">|</span>  <span class="number">2</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span>  c   <span class="operator">|</span>  <span class="number">3</span></span><br><span class="line">  <span class="number">4</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">5</span></span><br><span class="line">  <span class="number">5</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">6</span></span><br><span class="line">  <span class="number">6</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">4</span></span><br><span class="line">(<span class="number">6</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># REFRESH MATERIALIZED <span class="keyword">VIEW</span> mv_t1;</span><br><span class="line">REFRESH MATERIALIZED <span class="keyword">VIEW</span></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mv_t1;</span><br><span class="line"> id <span class="operator">|</span> name <span class="operator">|</span> c3</span><br><span class="line"><span class="comment">----+------+----</span></span><br><span class="line">  <span class="number">1</span> <span class="operator">|</span> A    <span class="operator">|</span>  <span class="number">1</span></span><br><span class="line">  <span class="number">2</span> <span class="operator">|</span> B    <span class="operator">|</span>  <span class="number">2</span></span><br><span class="line">  <span class="number">3</span> <span class="operator">|</span>  c   <span class="operator">|</span>  <span class="number">3</span></span><br><span class="line">  <span class="number">4</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">5</span></span><br><span class="line">  <span class="number">5</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">6</span></span><br><span class="line">  <span class="number">6</span> <span class="operator">|</span>      <span class="operator">|</span>  <span class="number">4</span></span><br><span class="line">  <span class="number">7</span> <span class="operator">|</span> A    <span class="operator">|</span></span><br><span class="line">  <span class="number">8</span> <span class="operator">|</span> B    <span class="operator">|</span></span><br><span class="line">  <span class="number">9</span> <span class="operator">|</span>  c   <span class="operator">|</span></span><br><span class="line"> <span class="number">10</span> <span class="operator">|</span>      <span class="operator">|</span></span><br><span class="line"> <span class="number">11</span> <span class="operator">|</span>      <span class="operator">|</span></span><br><span class="line"> <span class="number">12</span> <span class="operator">|</span>      <span class="operator">|</span></span><br><span class="line">(<span class="number">12</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure></div><h3 id="数据类型隐式转换测试">数据类型隐式转换测试</h3><ul><li>test case</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1 (</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> key(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;123456789012345611&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">values</span> (<span class="number">2</span>,<span class="string">&#x27;123456789012345612&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">values</span> (<span class="number">3</span>,<span class="string">&#x27;123123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2 (</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">name <span class="type">bigint</span> <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line"><span class="keyword">primary</span> key(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;123456789012345611&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> (<span class="number">2</span>,<span class="string">&#x27;123456789012345611&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> (<span class="number">3</span>,<span class="string">&#x27;123123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t1.id id1, t1.name name1, t2.id id2, t2.name name2</span><br><span class="line"><span class="keyword">from</span> t1,t2</span><br><span class="line"><span class="keyword">where</span> t1.name <span class="operator">=</span> t2.name;</span><br></pre></td></tr></table></figure></div><ul><li>output</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> t1.id id1, t1.name name1, t2.id id2, t2.name name2</span><br><span class="line">antdb<span class="operator">-</span># <span class="keyword">from</span> t1,t2</span><br><span class="line">antdb<span class="operator">-</span># <span class="keyword">where</span> t1.name <span class="operator">=</span> t2.name;</span><br><span class="line">ERROR:  operator does <span class="keyword">not</span> exist: <span class="type">character</span> <span class="type">varying</span> <span class="operator">=</span> <span class="type">bigint</span></span><br><span class="line">LINE <span class="number">3</span>: <span class="keyword">where</span> t1.name <span class="operator">=</span> t2.name;</span><br><span class="line">                      <span class="operator">^</span></span><br><span class="line">HINT:  <span class="keyword">No</span> operator <span class="keyword">matches</span> the given name <span class="keyword">and</span> argument types. You might need <span class="keyword">to</span> <span class="keyword">add</span> explicit type casts.</span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> t1.id id1, t1.name name1, t2.id id2, t2.name name2<span class="operator">^</span>Jfrom t1,t2<span class="operator">^</span>Jwhere t1.name <span class="operator">=</span> t2.name::<span class="type">varchar</span>;</span><br><span class="line"> id1 <span class="operator">|</span>       name1        <span class="operator">|</span> id2 <span class="operator">|</span>       name2</span><br><span class="line"><span class="comment">-----+--------------------+-----+--------------------</span></span><br><span class="line">   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span> <span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span></span><br><span class="line">   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span> <span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> <span class="number">123456789012345611</span></span><br><span class="line">   <span class="number">3</span> <span class="operator">|</span> <span class="number">123123</span>             <span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span>             <span class="number">123123</span></span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">antdb<span class="operator">=</span># <span class="keyword">select</span> t1.id id1, t1.name name1, t2.id id2, t2.name name2<span class="operator">^</span>Jfrom t1,t2<span class="operator">^</span>Jwhere t1.name::<span class="type">bigint</span> <span class="operator">=</span> t2.name;</span><br><span class="line"> id1 <span class="operator">|</span>       name1        <span class="operator">|</span> id2 <span class="operator">|</span>       name2</span><br><span class="line"><span class="comment">-----+--------------------+-----+--------------------</span></span><br><span class="line">   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span> <span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span></span><br><span class="line">   <span class="number">1</span> <span class="operator">|</span> <span class="number">123456789012345611</span> <span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> <span class="number">123456789012345611</span></span><br><span class="line">   <span class="number">3</span> <span class="operator">|</span> <span class="number">123123</span>             <span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span>             <span class="number">123123</span></span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br></pre></td></tr></table></figure></div><h2 id="总结">总结</h2><p>到此，AntDB 社区版 v7.2.0 的安装、适配已介绍完毕，并演示了 Oracle 兼容功能，以及部分 SQL 基础测试。</p><p>BTW，墨天轮课程中心上架了《AntDB ACA初级认证课程》<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup> ，有兴趣的同学可以学起来。</p><hr><p><a class="link"   href="https://www.modb.pro/db/1734117877862178816" >https://www.modb.pro/db/1734117877862178816 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a class="link"   href="https://www.modb.pro/db/1731856399742345216" >https://www.modb.pro/db/1731856399742345216 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a class="link"   href="https://www.modb.pro/wiki/55" >https://www.modb.pro/wiki/55 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a class="link"   href="http://www.antdb.net/news/detail/84" >http://www.antdb.net/news/detail/84 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a class="link"   href="http://www.antdb.net/download" >http://www.antdb.net/download <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a class="link"   href="http://www.antdb.net/72_benefit" >http://www.antdb.net/72_benefit <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p><a class="link"   href="https://www.modb.pro/course/196" >https://www.modb.pro/course/196 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref6" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;关于-AntDB&quot;&gt;关于 AntDB&lt;/h2&gt;
&lt;p&gt;2023年12月的 墨天轮中国数据库流行度排行 火热出炉，目前，AntDB 排在第十位。&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;#fn1&quot; id=&quot;fnref1&quot;&gt;[1]&lt;/a&gt;&lt;</summary>
      
    
    
    
    <category term="AntDB" scheme="https://shawnyan.cn/categories/antdb/"/>
    
    
    <category term="AntDB" scheme="https://shawnyan.cn/tags/antdb/"/>
    
    <category term="亚信科技" scheme="https://shawnyan.cn/tags/%E4%BA%9A%E4%BF%A1%E7%A7%91%E6%8A%80/"/>
    
    <category term="Postgres" scheme="https://shawnyan.cn/tags/postgres/"/>
    
  </entry>
  
  <entry>
    <title>TiDB v7.5.0 LTS 升级必读 | 新特性补充说明</title>
    <link href="https://shawnyan.cn/2023/tidb/tidb-7.5-new-feature/"/>
    <id>https://shawnyan.cn/2023/tidb/tidb-7.5-new-feature/</id>
    <published>2023-12-07T05:20:10.000Z</published>
    <updated>2023-12-07T05:20:10.000Z</updated>
    
    <content type="html"><![CDATA[<img  alt="tidb75.jpeg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231207-ea124805-d3bc-43ee-8115-79b85b203df6.jpeg"                      referrerpolicy="no-referrer"                ><h2 id="前言">前言</h2><p>12 月 1 日，期待已久的 TiDB v7.5.0 LTS 发版。 <a class="link"   href="https://docs.pingcap.com/zh/tidb/stable/release-7.5.0" >TiDB 7.5.0 Release Notes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><blockquote><p>作为 TiDB 7 系列的第二个长期支持版本 (LTS) ，TiDB 7.5 着眼于提升规模化场景下关键应用的稳定性。新版本中，TiDB 在可扩展性与性能、稳定性与高可用、SQL 以及可观测性等方面获得了持续的提升。TiDB 7.5 LTS 包含了已发布的 7.2.0-DMR、7.3.0-DMR 和 7.4.0-DMR 版本中的新功能、提升改进和错误修复，累计优化和修复功能 70 余项。</p></blockquote><p>前文中，我们详细地介绍了 TiDB Server 在 v7.1 到 v7.4 的新特性，彼时 TiDB v7.5.0 LTS 尚未发版。</p><ul><li><a class="link"   href="https://tidb.net/blog/8f6af887" >TiDB 7.x 源码编译之 TiDB Server 篇，及新特性详解（文末彩蛋） <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><img  alt="img01.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231207-5447f5cb-9149-4346-9193-27a4db174b41.png"                      referrerpolicy="no-referrer"                ><p>本文作为前文的补充，来观察一下该版本中的其他新特性。</p><h2 id="版本选择">版本选择</h2><p>前文中的彩蛋，这里更新了一下 TiDB v7.5.0 LTS 的发版日期。</p><img  alt="TiDBReleaseTimelineMap1201.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231207-67bd57de-0d14-4720-a654-94664b6fed50.png"                      referrerpolicy="no-referrer"                ><p>关于生产环境版本的选择，是论坛里经常讨论的问题，如果明年有项目上线，又期望使用到新特性，那么 TiDB v7.5 LTS 将是首选。</p><p>至于 DMR 版本，强烈不建议上生产，仅可用于功能验证。</p><h2 id="DDL-ADD-INDEX">DDL: ADD INDEX</h2><h3 id="支持并行运行多个-ADD-INDEX-语句">支持并行运行多个 ADD INDEX 语句</h3><p>通过该功能，为同一个表添加多个索引的任务可以变为并发运行。以前同时运行 2 个添加索引语句 X 和 Y 需要花费 X 的时间 + Y 的时间，现在在一个 SQL 语句中同时添加索引 X 和 Y，并发运行后，添加索引总耗时显著减少了。尤其是在宽表的场景，内部测试数据显示同时添加多个索引的性能最高可提升 94%。</p><h3 id="支持设置-TiDB-节点的服务范围，用于选择适用的-TiDB-节点分布式执行-ADD-INDEX-GA">支持设置 TiDB 节点的服务范围，用于选择适用的 TiDB 节点分布式执行 ADD INDEX (GA)</h3><p>在资源密集型集群中，并行执行 <code>ADD INDEX</code> 或 <code>IMPORT INTO</code> 任务可能占用大量 TiDB 节点的资源，从而导致集群性能下降。为了避免对已有业务造成性能影响，v7.4.0 以实验特性引入了变量 <code>tidb_service_scope</code>，用于控制 <a class="link"   href="https://docs.pingcap.com/zh/tidb/stable/tidb-distributed-execution-framework" >TiDB 后端任务分布式框架 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 下各 TiDB 节点的服务范围。你可以从现有 TiDB 节点中选择几个节点，或者对新增 TiDB 节点设置服务范围，所有分布式执行的 <code>ADD INDEX</code> 和 <code>IMPORT INTO</code> 的任务只会运行在这些节点。该方法可以实现与其他 TiDB 节点的资源隔离，确保在执行上述语句时的最佳性能，并避免对已有业务造成性能影响。在 v7.5.0 中，该功能正式 GA。</p><p>在系统变量 <a href="https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_service_scope-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5"><code>tidb_service_scope</code></a> 的相关文档中，有这样一段描述：</p><p>如果集群内所有节点均未配置 <code>tidb_service_scope</code>，所有节点均会执行分布式框架的任务。如果你担心对存量业务有性能影响，可以对其中几个 TiDB 节点设置为 <code>background</code>，只有这些节点才会执行分布式框架的任务。</p><!--https://github.com/pingcap/tidb/issues/46258Enhance distributed task execution framework #46258https://github.com/pingcap/tidb/issues/41602Optimize multi-schema change for add indexes #41602--><h3 id="实例演示">实例演示</h3><p>创建测试表，并行运行多个 ADD INDEX 语句，并在执行过程中，执行 DDL 的暂停、恢复。</p><ul><li>SESSION 1</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> t2 (c1 <span class="type">int</span>, c2 <span class="type">int</span>, c3 <span class="type">int</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.191</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test]<span class="operator">&gt;</span> <span class="keyword">alter</span> <span class="keyword">table</span> t2 <span class="keyword">add</span> index idx_c1 (c1), <span class="keyword">add</span> index idx_c2 (c2), <span class="keyword">add</span> index idx_c3 (c3), <span class="keyword">add</span> index idx_c1_c2 (c1, c2), <span class="keyword">add</span> <span class="keyword">unique</span> idx_uni_c3 (c3), <span class="keyword">add</span> <span class="keyword">primary</span> key (c1), <span class="keyword">add</span> fulltext (c2);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">8</span> min <span class="number">37.725</span> sec)</span><br><span class="line"></span><br><span class="line">Warning (Code <span class="number">1214</span>): The used <span class="keyword">table</span> type doesn<span class="string">&#x27;t support FULLTEXT indexes</span></span><br></pre></td></tr></table></figure></div><ul><li>SESSION 2</li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> admin <span class="keyword">show</span> ddl jobs;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------------------------+-------------------------------------+----------------------+-----------+----------+-----------+---------------------+---------------------+---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> JOB_ID <span class="operator">|</span> DB_NAME <span class="operator">|</span> TABLE_NAME              <span class="operator">|</span> JOB_TYPE                            <span class="operator">|</span> SCHEMA_STATE         <span class="operator">|</span> SCHEMA_ID <span class="operator">|</span> TABLE_ID <span class="operator">|</span> ROW_COUNT <span class="operator">|</span> CREATE_TIME         <span class="operator">|</span> START_TIME          <span class="operator">|</span> END_TIME            <span class="operator">|</span> STATE    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------------------------+-------------------------------------+----------------------+-----------+----------+-----------+---------------------+---------------------+---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">alter</span> <span class="keyword">table</span> multi<span class="operator">-</span>schema change     <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">49</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span>              <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span>              <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span>              <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> <span class="keyword">primary</span> key <span class="comment">/* subjob */</span>        <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">106</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">create</span> <span class="keyword">table</span>                        <span class="operator">|</span> public               <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> synced   <span class="operator">|</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> ADMIN PAUSE DDL JOBS <span class="number">107</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="operator">|</span> JOB_ID <span class="operator">|</span> <span class="keyword">RESULT</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">107</span>    <span class="operator">|</span> successful <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">2</span> min <span class="number">48.559</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> admin <span class="keyword">show</span> ddl jobs;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------------------------+-------------------------------------+----------------------+-----------+----------+-----------+---------------------+---------------------+---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> JOB_ID <span class="operator">|</span> DB_NAME <span class="operator">|</span> TABLE_NAME              <span class="operator">|</span> JOB_TYPE                            <span class="operator">|</span> SCHEMA_STATE         <span class="operator">|</span> SCHEMA_ID <span class="operator">|</span> TABLE_ID <span class="operator">|</span> ROW_COUNT <span class="operator">|</span> CREATE_TIME         <span class="operator">|</span> START_TIME          <span class="operator">|</span> END_TIME            <span class="operator">|</span> STATE    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+-------------------------+-------------------------------------+----------------------+-----------+----------+-----------+---------------------+---------------------+---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">alter</span> <span class="keyword">table</span> multi<span class="operator">-</span>schema change     <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> paused   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">49</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">50</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span> <span class="comment">/* ingest */</span> <span class="operator">|</span> write reorganization <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">51</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">running</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> index <span class="comment">/* subjob */</span>              <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">107</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">add</span> <span class="keyword">primary</span> key <span class="comment">/* subjob */</span>        <span class="operator">|</span> <span class="keyword">none</span>                 <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">15</span>:<span class="number">47</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span> queueing <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">106</span> <span class="operator">|</span> test    <span class="operator">|</span> t2                      <span class="operator">|</span> <span class="keyword">create</span> <span class="keyword">table</span>                        <span class="operator">|</span> public               <span class="operator">|</span>         <span class="number">2</span> <span class="operator">|</span>      <span class="number">105</span> <span class="operator">|</span>         <span class="number">0</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">12</span>:<span class="number">52</span> <span class="operator">|</span> synced   <span class="operator">|</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">MySQL [information_schema]<span class="operator">&gt;</span> ADMIN RESUME DDL JOBS <span class="number">107</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="operator">|</span> JOB_ID <span class="operator">|</span> <span class="keyword">RESULT</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">107</span>    <span class="operator">|</span> successful <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.024</span> sec)</span><br></pre></td></tr></table></figure></div><h2 id="DDL-IMPORT-INTO">DDL: IMPORT INTO</h2><p><a href="https://docs.pingcap.com/zh/tidb/stable/sql-statement-import-into"><code>IMPORT INTO</code></a> 语句使用 TiDB Lightning 的物理导入模式，用于将 CSV、SQL、PARQUET 等格式的数据导入到 TiDB 的一张空表中。</p><p><code>IMPORT INTO</code> 支持导入存储在 Amazon S3、GCS、Azure Blob Storage 和 TiDB 本地的数据文件。</p><p>在 v7.5.0 中，<code>IMPORT INTO</code> SQL 语句正式 GA。这种导入方式无需单独部署和管理 TiDB Lightning，在降低了数据导入难度的同时，大幅提升了数据导入效率。</p><h3 id="实例演示-2">实例演示</h3><p>演示将表数据导出到本地文件，创建新表，并使用 <code>IMPORT INTO</code> 语句将数据导入。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">MySQL [test]<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1 <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/tmp/t1.csv&#x27;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">2</span> <span class="keyword">rows</span> affected (<span class="number">0.004</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test]<span class="operator">&gt;</span> \<span class="operator">!</span> cat <span class="operator">/</span>tmp<span class="operator">/</span>t1.csv</span><br><span class="line">&quot;1&quot;,&quot;1&quot;,&quot;1&quot;</span><br><span class="line">&quot;1&quot;,&quot;2&quot;,&quot;3&quot;</span><br><span class="line"></span><br><span class="line">MySQL [test]<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> t1_1 <span class="keyword">like</span> t1;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.375</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test]<span class="operator">&gt;</span> IMPORT <span class="keyword">INTO</span> t1_1 <span class="keyword">FROM</span> <span class="string">&#x27;/tmp/t1.csv&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+---------------+----------+-------+----------+------------------+---------------+----------------+----------------------------+----------------------------+----------------------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Job_ID <span class="operator">|</span> Data_Source <span class="operator">|</span> Target_Table  <span class="operator">|</span> Table_ID <span class="operator">|</span> Phase <span class="operator">|</span> Status   <span class="operator">|</span> Source_File_Size <span class="operator">|</span> Imported_Rows <span class="operator">|</span> Result_Message <span class="operator">|</span> Create_Time                <span class="operator">|</span> Start_Time                 <span class="operator">|</span> End_Time                   <span class="operator">|</span> Created_By <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+---------------+----------+-------+----------+------------------+---------------+----------------+----------------------------+----------------------------+----------------------------+------------+</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">2</span> <span class="operator">|</span> <span class="operator">/</span>tmp<span class="operator">/</span>t1.csv <span class="operator">|</span> `test`.`t1_1` <span class="operator">|</span>      <span class="number">110</span> <span class="operator">|</span>       <span class="operator">|</span> finished <span class="operator">|</span> <span class="number">24</span>B              <span class="operator">|</span>             <span class="number">2</span> <span class="operator">|</span>                <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">59</span>:<span class="number">36.500342</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">59</span>:<span class="number">39.038744</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-07</span> <span class="number">11</span>:<span class="number">59</span>:<span class="number">45.550724</span> <span class="operator">|</span> root@<span class="operator">%</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-------------+---------------+----------+-------+----------+------------------+---------------+----------------+----------------------------+----------------------------+----------------------------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">9.382</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test]<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1_1;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span> c1   <span class="operator">|</span> c2   <span class="operator">|</span> c3   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.013</span> sec)</span><br></pre></td></tr></table></figure></div><h2 id="全局变量、配置参数对比-v7-1-2-vs-v7-5-0">全局变量、配置参数对比 v7.1.2 vs v7.5.0</h2><p>关于 TiDB Server 的系统变量和配置参数，可从 Release Notes 获取信息，官方文档中，更直接的办法是用工具直接对比。</p><p>下面将列举 v7.1.2 和 v7.5.0 两个版本的全局变量、配置参数差异。感谢 @人如其名 贡献的“炒鸡”好用小工具。</p><p>对比结果如下：</p><img  alt="diff1.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231207-66c011b0-9364-435c-8f02-5f7454dffe39.png"                      referrerpolicy="no-referrer"                ><img  alt="diff2.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231207-55c75ab5-69a6-4f8f-a8b5-cf783d287fbf.png"                      referrerpolicy="no-referrer"                ><p>全局系统变量变更 24 项，tidb-server 配置参数新增 6 项。<br>全局系统变量变更 5 项，tidb-server 配置参数变更 3 项。<br>合计，38 项。</p><!--依赖<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnf install mysql sqlite python3</span><br><span class="line"></span><br><span class="line">./main.py collect -H 192.168.8.92</span><br><span class="line">./main.py report</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> type,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.cluster_config <span class="keyword">group</span> <span class="keyword">by</span> type;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- v7.5.0</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="operator">|</span> type    <span class="operator">|</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="operator">|</span> tidb    <span class="operator">|</span>      <span class="number">392</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tikv    <span class="operator">|</span>      <span class="number">685</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> pd      <span class="operator">|</span>      <span class="number">180</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tiflash <span class="operator">|</span>      <span class="number">678</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.06</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- v7.1.2</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="operator">|</span> type    <span class="operator">|</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="operator">|</span> tidb    <span class="operator">|</span>      <span class="number">190</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tikv    <span class="operator">|</span>      <span class="number">664</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> pd      <span class="operator">|</span>      <span class="number">171</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tiflash <span class="operator">|</span>      <span class="number">656</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 tidb_config_diff]# ./main.py report</span><br><span class="line">┌──────────┬─────────┬──────────┬────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┬──────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">│   Number │ scope   │ type     │ var_name                                   │ var_value_v7.1.2_host_192.168.8.92:4000                                  │ var_value_v7.5.0_host_192.168.8.92:4000                                  │</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        1 │ global  │ variable │ default_collation_for_utf8mb4              │ NotFound                                                                 │ utf8mb4_bin                                                              │https://docs.pingcap.com/zh/tidb/stable/system-variables#default_collation_for_utf8mb4-span-classversion-mark%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5span</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        2 │ global  │ variable │ tidb_allow_tiflash_cop                     │ NotFound                                                                 │ OFF                                                                      │https://asktug.com/t/topic/1018633</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        3 │ global  │ variable │ tidb_analyze_skip_column_types             │ NotFound                                                                 │ json,blob,mediumblob,longblob                                            │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_analyze_skip_column_types-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        4 │ global  │ variable │ tidb_build_sampling_stats_concurrency      │ NotFound                                                                 │ 2                                                                        │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_build_sampling_stats_concurrency-%E4%BB%8E-v750-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        5 │ global  │ variable │ tidb_cloud_storage_uri                     │ NotFound                                                                 │                                                                          │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_cloud_storage_uri-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        6 │ global  │ variable │ tidb_enable_async_merge_global_stats       │ NotFound                                                                 │ ON                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_enable_async_merge_global_stats-%E4%BB%8E-v750-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        7 │ global  │ variable │ tidb_enable_check_constraint               │ NotFound                                                                 │ OFF                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_enable_check_constraint-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        8 │ global  │ variable │ tidb_enable_fast_table_check               │ NotFound                                                                 │ ON                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_enable_fast_table_check-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│        9 │ global  │ variable │ tidb_enable_tiflash_pipeline_model         │ NotFound                                                                 │ ON                                                                       │https://asktug.com/t/topic/1018634</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       10 │ global  │ variable │ tidb_expensive_txn_time_threshold          │ NotFound                                                                 │ 600                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_expensive_txn_time_threshold-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       11 │ global  │ variable │ tidb_gogc_tuner_max_value                  │ NotFound                                                                 │ 500                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_gogc_tuner_max_value-%E4%BB%8E-v750-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       12 │ global  │ variable │ tidb_gogc_tuner_min_value                  │ NotFound                                                                 │ 100                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_gogc_tuner_min_value-%E4%BB%8E-v750-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       13 │ global  │ variable │ tidb_opt_enable_mpp_shared_cte_execution   │ NotFound                                                                 │ OFF                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_opt_enable_mpp_shared_cte_execution-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       14 │ global  │ variable │ tidb_opt_enable_non_eval_scalar_subquery   │ NotFound                                                                 │ OFF                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_opt_enable_non_eval_scalar_subquery-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       15 │ global  │ variable │ tidb_opt_objective                         │ NotFound                                                                 │ moderate                                                                 │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_opt_objective-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       16 │ global  │ variable │ tidb_runtime_filter_mode                   │ NotFound                                                                 │ OFF                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_runtime_filter_mode-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       17 │ global  │ variable │ tidb_runtime_filter_type                   │ NotFound                                                                 │ IN                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_runtime_filter_type-%E4%BB%8E-v720-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       18 │ global  │ variable │ tidb_schema_version_cache_limit            │ NotFound                                                                 │ 16                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_schema_version_cache_limit-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       19 │ global  │ variable │ tidb_service_scope                         │ NotFound                                                                 │                                                                          │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_service_scope-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       20 │ global  │ variable │ tidb_skip_missing_partition_stats          │ NotFound                                                                 │ ON                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_skip_missing_partition_stats-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       21 │ global  │ variable │ tiflash_mem_quota_query_per_node           │ NotFound                                                                 │ 0                                                                        │https://docs.pingcap.com/zh/tidb/stable/system-variables#tiflash_mem_quota_query_per_node-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       22 │ global  │ variable │ tiflash_query_spill_ratio                  │ NotFound                                                                 │ 0.7                                                                      │https://docs.pingcap.com/zh/tidb/stable/system-variables#tiflash_query_spill_ratio-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       23 │ global  │ variable │ tiflash_replica_read                       │ NotFound                                                                 │ all_replicas                                                             │https://docs.pingcap.com/zh/tidb/stable/system-variables#tiflash_replica_read-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       24 │ global  │ variable │ tikv_client_read_timeout                   │ NotFound                                                                 │ 0                                                                        │https://docs.pingcap.com/zh/tidb/stable/system-variables#tikv_client_read_timeout-%E4%BB%8E-v740-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       25 │ global  │ tidb     │ enable-32bits-connection-id                │ NotFound                                                                 │ true                                                                     │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#enable-32bits-connection-id-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       26 │ global  │ tidb     │ in-mem-slow-query-recent-num               │ NotFound                                                                 │ 500                                                                      │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#in-mem-slow-query-recent-num-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       27 │ global  │ tidb     │ in-mem-slow-query-topn-num                 │ NotFound                                                                 │ 30                                                                       │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#in-mem-slow-query-topn-num-%E4%BB%8E-v730-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       28 │ global  │ tidb     │ instance.tidb_expensive_txn_time_threshold │ NotFound                                                                 │ 600                                                                      │https://asktug.com/t/topic/1018636</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       29 │ global  │ tidb     │ instance.tidb_service_scope                │ NotFound                                                                 │                                                                          │https://asktug.com/t/topic/1018636</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       30 │ global  │ tidb     │ tikv-client.copr-req-timeout               │ NotFound                                                                 │ 60000000000                                                              │https://asktug.com/t/topic/1018632</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       31 │ global  │ variable │ tidb_analyze_partition_concurrency         │ 1                                                                        │ 2                                                                        │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_analyze_partition_concurrency</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       32 │ global  │ variable │ tidb_build_stats_concurrency               │ 4                                                                        │ 2                                                                        │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_build_stats_concurrency</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       33 │ global  │ variable │ tidb_remove_orderby_in_subquery            │ OFF                                                                      │ ON                                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#tidb_remove_orderby_in_subquery-%E4%BB%8E-v610-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       34 │ global  │ variable │ version                                    │ 5.7.25-TiDB-v7.1.2                                                       │ 8.0.11-TiDB-v7.5.0                                                       │https://docs.pingcap.com/zh/tidb/stable/system-variables#version</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       35 │ global  │ variable │ version_comment                            │ TiDB Server (Apache License 2.0) Community Edition, MySQL 5.7 compatible │ TiDB Server (Apache License 2.0) Community Edition, MySQL 8.0 compatible │https://asktug.com/t/topic/1018635</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       36 │ global  │ tidb     │ log.file.filename                          │ /root/.tiup/data/7.1.2/tidb-0/tidb.log                                   │ /root/.tiup/data/7.5/tidb-0/tidb.log                                     │</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       37 │ global  │ tidb     │ performance.enable-stats-cache-mem-quota   │ false                                                                    │ true                                                                     │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#enable-stats-cache-mem-quota-%E4%BB%8E-v610-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       38 │ global  │ tidb     │ performance.force-init-stats               │ false                                                                    │ true                                                                     │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#force-init-stats-%E4%BB%8E-v710-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">├──────────┼─────────┼──────────┼────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│       39 │ global  │ tidb     │ performance.lite-init-stats                │ false                                                                    │ true                                                                     │https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#lite-init-stats-%E4%BB%8E-v710-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5</span><br><span class="line">└──────────┴─────────┴──────────┴────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────┘</span><br><span class="line">[root@rocky9 tidb_config_diff]# </span><br></pre></td></tr></table></figure></div><p>–&gt;</p><p>此外， 需要注意的是，如下系统变量已被废弃，请勿使用。</p><ul><li><code>tidb_enable_fast_analyze</code></li><li><code>tidb_enable_tiflash_pipeline_model</code></li></ul><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> tidb_enable_fast_analyze<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.071</span> sec)</span><br><span class="line"></span><br><span class="line">Warning (Code <span class="number">1105</span>): the fast analyze feature has already been removed <span class="keyword">in</span> TiDB v7<span class="number">.5</span><span class="number">.0</span>, so this will have <span class="keyword">no</span> effect</span><br><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span></span><br><span class="line">MySQL [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> tidb_enable_tiflash_pipeline_model<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.013</span> sec)</span><br><span class="line"></span><br><span class="line">Warning (Code <span class="number">1681</span>): tidb_enable_tiflash_pipeline_model <span class="keyword">is</span> deprecated <span class="keyword">and</span> will be removed <span class="keyword">in</span> a future release.</span><br></pre></td></tr></table></figure></div><h2 id="尾声">尾声</h2><p>今年第二个 LTS 版本 TiDB v7.5.0 LTS 已发布上线，欢迎各位 TiDBer 来尝鲜、试用、推生产、升级生产。</p><h2 id="参考阅读">参考阅读</h2><ul><li><a class="link"   href="https://docs.pingcap.com/zh/tidb/stable/smooth-upgrade-tidb#%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6" >平滑升级 TiDB 的限制 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><img  alt="logo.jpg"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20240222-e133c9a2-37fa-47e9-9f67-d49bfdc02bdf.jpg"                      referrerpolicy="no-referrer"                >]]></content>
    
    
      
      
    <summary type="html">&lt;img  alt=&quot;tidb75.jpeg&quot; 
                     lazyload
                     src=&quot;/img/loading.svg&quot;
                     data-src=&quot;https://os</summary>
      
    
    
    
    <category term="TiDB" scheme="https://shawnyan.cn/categories/tidb/"/>
    
    <category term="TiDB 7.x" scheme="https://shawnyan.cn/categories/tidb/tidb-7-x/"/>
    
    
    <category term="tidb" scheme="https://shawnyan.cn/tags/tidb/"/>
    
    <category term="pingcap" scheme="https://shawnyan.cn/tags/pingcap/"/>
    
    <category term="tidb 7.x" scheme="https://shawnyan.cn/tags/tidb-7-x/"/>
    
    <category term="ddl" scheme="https://shawnyan.cn/tags/ddl/"/>
    
  </entry>
  
  <entry>
    <title>StoneDB 企业版 8.0-v2.2.0 初体验</title>
    <link href="https://shawnyan.cn/2023/stonedb/stonedb-8.0-v2.2.0-ee/"/>
    <id>https://shawnyan.cn/2023/stonedb/stonedb-8.0-v2.2.0-ee/</id>
    <published>2023-12-06T01:35:38.000Z</published>
    <updated>2023-12-06T01:35:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>前段时间已经体验过 StoneDB 5.7 ，对这款石原子数据库也有了初步印象。尤其是 StoneDB 5.7 开源版本未适配 Rocky Linux 9 的情况下，编译安装遇到了若干问题，本文来看看 StoneDB 8.0 企业版在 Rocky 9 上是否安装顺利。</p><ul><li><a href="https://shawnyan.cn/2023/stonedb/stonedb-compile-on-rocky-9/">三天三夜的三更半夜! StoneDB on Rocky 9</a></li><li><a href="https://shawnyan.cn/2023/stonedb/stonedb-install/">StoneDB 初体验 | StoneDB-5.7-v1.0.4 安装及新特性速览</a></li></ul><h2 id="介绍">介绍</h2><p>StoneDB 是由石原子科技公司自主设计、研发的国内首款基于 MySQL 内核打造的开源 HTAP（Hybrid Transactional and Analytical Processing）融合型数据库，可实现与 MySQL 的无缝切换。StoneDB 具备超高性能、实时分析等特点，为用户提供一站式 HTAP 解决方案。</p><p>StoneDB 100% 兼容 MySQL 5.6、5.7、8.0 协议和 MySQL 生态等重要特性，支持 MySQL 常用的功能及语法，支持 MySQL 生态中的系统工具和客户端，如 Navicat、Workbench、mysqldump、mydumper。由于 100% 兼容 MySQL，因此 StoneDB 的所有工作负载都可以继续使用 MySQL 数据库体系运行。</p><p>StoneDB 专门针对 OLAP 应用程序进行了设计和优化，支持百亿数据场景下进行高性能、多维度字段组合的复杂查询，相对比社区版的 MySQL，其查询速度提升了十倍以上。</p><p>StoneDB 采用基于知识网格技术和列式存储引擎，该存储引擎为海量数据背景下 OLAP 应用而设计，通过列式存储数据、知识网格过滤、高效数据压缩等技术，为应用系统提供低成本和高性能的数据查询支持。</p><img  alt="stonedbarch.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231205-56490e85-ee65-4a41-95d3-6d43a3c35df1.png"                      referrerpolicy="no-referrer"                ><h3 id="Release-Notes">Release Notes</h3><p>11月30日，石原子科技正式发布 StoneDB-8.0-V2.2.0 企业版。</p><img  alt="stonedb.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231205-d8e4747d-22dd-41cc-ae61-f39577303f1e.png"                      referrerpolicy="no-referrer"                ><p>Release Notes for StoneDB-ee-8.0-v2.2.0</p><ol><li>New Futures</li></ol><ul><li>支持自定义函数create/drop function</li><li>支持存储过程create/drop procedurecall procedure</li><li>支持触发器create/drop trigger</li><li>支持alter table rename table_name2</li><li>支持select into out file</li><li>支持unsiged singed zerofill等列属性</li><li>Read Committed 隔离级实现</li></ul><ol start="2"><li>Bug Fixes</li></ol><ul><li>主从功能对NULL处理错误</li><li>Release 版本 init db 失败</li><li>存储过程执行后，查询导致 core</li><li>drop table 不能正确删除</li><li>Item::send 对 decimal 处理不完全，导致 decimal(5,3)  结果显示 null</li><li>使用 with as 导致 core</li><li>部分子查询导致 core</li><li>主从复制中，double 数据插入错误</li><li>TPC-H Q8 error</li><li>备库同步失败导致 core</li><li>备库同步，切换db后，建表失败</li><li>传入错误的指针，导致 slave mode stop</li></ul><ol start="3"><li>Refactors</li></ol><ul><li>重构对 MySQL 标识符`的支持</li><li>重构 create table 语句的 SQL 支持</li></ul><ol start="4"><li>性能优化</li></ol><ul><li>备库insert同步性能提升1-2倍</li></ul><h2 id="环境信息">环境信息</h2><p>本文所使用的是最新的 StoneDB 8.0 v2.2.0 企业版，目前 StoneDB-8.0-V2.2.0 企业版正在免费公测中，下载地址为： <a class="link"   href="https://www.stoneatom.com/download" >StoneAtom 软件下载中心 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>这里选择 【8.0-v2.2.0 RPM】： <a class="link"   href="https://stoneatom-static.oss-cn-hangzhou.aliyuncs.com/stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm" >https://stoneatom-static.oss-cn-hangzhou.aliyuncs.com/stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>可以看到这个 RPM 包适配的是 el8，理论上也是可以安装在 Rocky 9 上的，我们来尝试一下。</p><p>主机安装的系统为 Rocky Linux 9.3，关于 Rocky 9 的安装，可参考文章：</p><ul><li><a class="link"   href="https://www.modb.pro/db/1716634949384757248" >【Rocky 9】Step by Step 安装 Rocky Linux 9.2 系统 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li><li><a class="link"   href="https://www.modb.pro/db/1726849694440185856" >【Rocky 9】Rocky Linux 9.2 升级 9.3，及新特性实践 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li></ul><h3 id="Q1-OS-适配">Q1: OS 适配</h3><p>如果操作系统是 EL 系，除了 RPM 格式，还有 TAR 格式的安装包可以选，</p><p>【8.0-v2.2.0 TAR】： <a class="link"   href="https://stoneatom-static.oss-cn-hangzhou.aliyuncs.com/stonedb-ee-8.0-v2.2.0.el7.x86_64.tar.gz" >https://stoneatom-static.oss-cn-hangzhou.aliyuncs.com/stonedb-ee-8.0-v2.2.0.el7.x86_64.tar.gz <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>可以看到 RPM 适配的是 el8 系统，而 TAR 包适配的是 el7。<br>这里建议提供不同版本操作系统不同格式的包，比如，</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stonedb-ee-8.0-v2.2.0.el9.x86_64.rpm</span><br><span class="line">stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm</span><br><span class="line">stonedb-ee-8.0-v2.2.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">stonedb-ee-8.0-v2.2.0.el9.x86_64.tar.gz</span><br><span class="line">stonedb-ee-8.0-v2.2.0.el8.x86_64.tar.gz</span><br><span class="line">stonedb-ee-8.0-v2.2.0.el7.x86_64.tar.gz</span><br></pre></td></tr></table></figure></div><h2 id="安装-StoneDB">安装 StoneDB</h2><h3 id="安装-RPM">安装 RPM</h3><p>直接通过 yum 进行安装 RPM 包：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 stonedb]$ ls</span><br><span class="line">stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm</span><br><span class="line">[shawnyan@rocky9 stonedb]$ sudo yum install ./stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm</span><br><span class="line">Last metadata expiration check: 1:31:49 ago on Tue 05 Dec 2023 01:02:18 PM UTC.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package            Architecture  Version             Repository           Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> stonedb_2.0        x86_64        2.2.0-1.el8         @commandline        434 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total size: 434 M</span><br><span class="line">Installed size: 1.1 G</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Error: Transaction test error:</span><br><span class="line">  file /usr/lib64/libsnappy.so.1 from install of stonedb_2.0-2.2.0-1.el8.x86_64 conflicts with file from package snappy-1.1.8-8.el9.x86_64</span><br></pre></td></tr></table></figure></div><p>这里遇到了冲突，这里先将 <code>snappy</code> 卸载。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 stonedb]$ sudo yum remove snappy-1.1.8-8.el9.x86_64</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package                       Arch   Version                  Repository  Size</span><br><span class="line">================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> snappy                        x86_64 1.1.8-8.el9              @anaconda   63 k</span><br><span class="line">Removing dependent packages:</span><br><span class="line"> cockpit                       x86_64 300.1-1.el9_3            @baseos     58 k</span><br><span class="line"> cockpit-storaged              noarch 300.1-1.el9_3            @appstream 882 k</span><br><span class="line"> cockpit-system                noarch 300.1-1.el9_3            @baseos    5.2 M</span><br><span class="line"> kexec-tools                   x86_64 2.0.26-8.el9             @baseos    1.3 M</span><br><span class="line"> snappy-devel                  x86_64 1.1.8-8.el9              @devel      44 k</span><br><span class="line">Removing unused dependencies:</span><br><span class="line"> clevis                        x86_64 18-112.el9               @appstream 122 k</span><br><span class="line"> clevis-luks                   x86_64 18-112.el9               @appstream  71 k</span><br><span class="line"> device-mapper-multipath       x86_64 0.8.7-22.el9             @baseos    320 k</span><br><span class="line"> device-mapper-multipath-libs  x86_64 0.8.7-22.el9             @baseos    876 k</span><br><span class="line"> dracut-network                x86_64 057-44.git20230822.el9   @baseos    190 k</span><br><span class="line"> dracut-squash                 x86_64 057-44.git20230822.el9   @baseos    3.2 k</span><br><span class="line"> iscsi-initiator-utils         x86_64 6.2.1.4-3.git2a8f9d8.el9 @anaconda  1.5 M</span><br><span class="line"> iscsi-initiator-utils-iscsiuio</span><br><span class="line">                               x86_64 6.2.1.4-3.git2a8f9d8.el9 @anaconda  189 k</span><br><span class="line"> isns-utils-libs               x86_64 0.101-4.el9              @anaconda  488 k</span><br><span class="line"> jose                          x86_64 11-3.el9                 @AppStream 134 k</span><br><span class="line"> jq                            x86_64 1.6-15.el9               @appstream 408 k</span><br><span class="line"> libblockdev-lvm               x86_64 2.28-7.el9               @appstream  68 k</span><br><span class="line"> libjose                       x86_64 11-3.el9                 @AppStream 154 k</span><br><span class="line"> libluksmeta                   x86_64 9-12.el9                 @AppStream  46 k</span><br><span class="line"> luksmeta                      x86_64 9-12.el9                 @AppStream  32 k</span><br><span class="line"> oniguruma                     x86_64 6.9.6-1.el9.5            @AppStream 746 k</span><br><span class="line"> python3-dasbus                noarch 1.4-5.el9                @AppStream 329 k</span><br><span class="line"> setroubleshoot-plugins        noarch 3.3.14-4.el9             @AppStream 2.5 M</span><br><span class="line"> setroubleshoot-server         x86_64 3.3.32-1.el9             @appstream 1.3 M</span><br><span class="line"> squashfs-tools                x86_64 4.4-8.git1.el9           @anaconda  420 k</span><br><span class="line"> tpm2-tools                    x86_64 5.2-3.el9                @baseos    1.4 M</span><br><span class="line"> udisks2-iscsi                 x86_64 2.9.4-9.el9              @appstream  56 k</span><br><span class="line"> udisks2-lvm2                  x86_64 2.9.4-9.el9              @appstream 104 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Remove  29 Packages</span><br><span class="line"></span><br><span class="line">Freed space: 19 M</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">...</span><br><span class="line">Removed:</span><br><span class="line">  clevis-18-112.el9.x86_64</span><br><span class="line">  clevis-luks-18-112.el9.x86_64</span><br><span class="line">  cockpit-300.1-1.el9_3.x86_64</span><br><span class="line">  cockpit-storaged-300.1-1.el9_3.noarch</span><br><span class="line">  cockpit-system-300.1-1.el9_3.noarch</span><br><span class="line">  device-mapper-multipath-0.8.7-22.el9.x86_64</span><br><span class="line">  device-mapper-multipath-libs-0.8.7-22.el9.x86_64</span><br><span class="line">  dracut-network-057-44.git20230822.el9.x86_64</span><br><span class="line">  dracut-squash-057-44.git20230822.el9.x86_64</span><br><span class="line">  iscsi-initiator-utils-6.2.1.4-3.git2a8f9d8.el9.x86_64</span><br><span class="line">  iscsi-initiator-utils-iscsiuio-6.2.1.4-3.git2a8f9d8.el9.x86_64</span><br><span class="line">  isns-utils-libs-0.101-4.el9.x86_64</span><br><span class="line">  jose-11-3.el9.x86_64</span><br><span class="line">  jq-1.6-15.el9.x86_64</span><br><span class="line">  kexec-tools-2.0.26-8.el9.x86_64</span><br><span class="line">  libblockdev-lvm-2.28-7.el9.x86_64</span><br><span class="line">  libjose-11-3.el9.x86_64</span><br><span class="line">  libluksmeta-9-12.el9.x86_64</span><br><span class="line">  luksmeta-9-12.el9.x86_64</span><br><span class="line">  oniguruma-6.9.6-1.el9.5.x86_64</span><br><span class="line">  python3-dasbus-1.4-5.el9.noarch</span><br><span class="line">  setroubleshoot-plugins-3.3.14-4.el9.noarch</span><br><span class="line">  setroubleshoot-server-3.3.32-1.el9.x86_64</span><br><span class="line">  snappy-1.1.8-8.el9.x86_64</span><br><span class="line">  snappy-devel-1.1.8-8.el9.x86_64</span><br><span class="line">  squashfs-tools-4.4-8.git1.el9.x86_64</span><br><span class="line">  tpm2-tools-5.2-3.el9.x86_64</span><br><span class="line">  udisks2-iscsi-2.9.4-9.el9.x86_64</span><br><span class="line">  udisks2-lvm2-2.9.4-9.el9.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure></div><p>然后再次尝试安装。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[shawnyan@rocky9 stonedb]$ sudo yum install ./stonedb-ee-8.0-v2.2.0.el8.x86_64.rpm</span><br><span class="line">Last metadata expiration check: 1:32:37 ago on Tue 05 Dec 2023 01:02:18 PM UTC.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package            Architecture  Version             Repository           Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> stonedb_2.0        x86_64        2.2.0-1.el8         @commandline        434 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total size: 434 M</span><br><span class="line">Installed size: 1.1 G</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1</span><br><span class="line">  Running scriptlet: stonedb_2.0-2.2.0-1.el8.x86_64                         1/1</span><br><span class="line">  Installing       : stonedb_2.0-2.2.0-1.el8.x86_64                         1/1</span><br><span class="line">  Running scriptlet: stonedb_2.0-2.2.0-1.el8.x86_64                         1/1</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdb&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdbd&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/mclient&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/mserver5&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdb_mtest.sh&#x27;</span><br><span class="line">/var/tmp/rpm-tmp.AzSlx4: line 15: upx: command not found</span><br><span class="line"></span><br><span class="line">  Verifying        : stonedb_2.0-2.2.0-1.el8.x86_64                         1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  stonedb_2.0-2.2.0-1.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[shawnyan@rocky9 stonedb]$</span><br></pre></td></tr></table></figure></div><p>可以看到安装成功。</p><h3 id="Q2-移除-monetdb">Q2: 移除 monetdb</h3><p>从上面的安装日志中可以看到有这么一段：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdb&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdbd&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/mclient&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/mserver5&#x27;</span><br><span class="line">removed &#x27;/opt/stonedb_v2/install/bin/monetdb_mtest.sh&#x27;</span><br></pre></td></tr></table></figure></div><p>不太清楚为什么要删掉 monetdb 的相关命令，导致后面无法启动 monetdb，如果真的不想要可以在打包时就过滤掉。</p><h3 id="Q3-upx">Q3: upx</h3><p>从上面的安装日志中可以看到有这么一段：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/tmp/rpm-tmp.AzSlx4: line 15: upx: command not found</span><br></pre></td></tr></table></figure></div><p>如果 StoneDB 需要使用 <code>upx</code> 来压缩文件，更加优雅的方式是在写 spec 的时候放到依赖里，这样安装 StoneDB 的同时安装 <code>upx</code>。</p><!--<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 install]# yum info upx</span><br><span class="line">Last metadata expiration check: 0:07:21 ago on Tue 05 Dec 2023 11:59:29 PM CST.</span><br><span class="line">Available Packages</span><br><span class="line">Name         : upx</span><br><span class="line">Version      : 4.0.2</span><br><span class="line">Release      : 1.el9</span><br><span class="line">Architecture : x86_64</span><br><span class="line">Size         : 664 k</span><br><span class="line">Source       : upx-4.0.2-1.el9.src.rpm</span><br><span class="line">Repository   : epel-aliyun</span><br><span class="line">Summary      : Ultimate Packer for eXecutables</span><br><span class="line">URL          : https://github.com/upx/upx</span><br><span class="line">License      : GPLv2+ and Public Domain</span><br><span class="line">Description  : UPX is a free, portable, extendable, high-performance executable</span><br><span class="line">             : packer for several different executable formats. It achieves an</span><br><span class="line">             : excellent compression ratio and offers very fast decompression. Your</span><br><span class="line">             : executables suffer no memory overhead or other drawbacks.</span><br></pre></td></tr></table></figure></div><p>–&gt;</p><h3 id="环境变量">环境变量</h3><p>安装完成后，切换到 <code>mysql</code> 用户，配置 Libary/PATH 路径:</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/opt/stonedb_v2/install/lib:/usr/local/lib64:$LD_LIBRARY_PATH</span><br><span class="line">export PATH=/opt/stonedb_v2/install/bin:$PATH</span><br></pre></td></tr></table></figure></div><p>检查动态库依赖:</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 ~]$ ldd /opt/stonedb_v2/install/bin/mysqld</span><br><span class="line">        linux-vdso.so.1 (0x00007ffe5b778000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f2099825000)</span><br><span class="line">        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f2099820000)</span><br><span class="line">        libssl.so.1.1 =&gt; /usr/local/lib64/libssl.so.1.1 (0x00007f209978c000)</span><br><span class="line">        libcrypto.so.1.1 =&gt; /usr/local/lib64/libcrypto.so.1.1 (0x00007f2099400000)</span><br><span class="line">        libprotobuf-lite.so.3.19.4 =&gt; /opt/stonedb_v2/install/bin/../lib/private/libprotobuf-lite.so.3.19.4 (0x00007f20996ef000)</span><br><span class="line">        libmonetdbe.so.26 =&gt; /opt/stonedb_v2/install/bin/../lib/private/libmonetdbe.so.26 (0x00007f20993db000)</span><br><span class="line">        libaio.so.1 =&gt; /lib64/libaio.so.1 (0x00007f20996e8000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f20993d6000)</span><br><span class="line">        libstdc++.so.6 =&gt; /lib64/libstdc++.so.6 (0x00007f2099000000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f20992fb000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f20992e0000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f2098c00000)</span><br><span class="line">        libmonetdbsql.so.13 =&gt; /opt/stonedb_v2/install/lib64/libmonetdbsql.so.13 (0x00007f2098800000)</span><br><span class="line">        libmonetdb5.so.33 =&gt; /opt/stonedb_v2/install/lib64/libmonetdb5.so.33 (0x00007f2098400000)</span><br><span class="line">        libmapi.so.26 =&gt; /opt/stonedb_v2/install/lib64/libmapi.so.26 (0x00007f20992c1000)</span><br><span class="line">        libbat.so.26 =&gt; /opt/stonedb_v2/install/lib64/libbat.so.26 (0x00007f2097a00000)</span><br><span class="line">        libstream.so.26 =&gt; /opt/stonedb_v2/install/lib64/libstream.so.26 (0x00007f209929a000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f2099839000)</span><br><span class="line">        libbz2.so.1 =&gt; /lib64/libbz2.so.1 (0x00007f2099287000)</span><br><span class="line">        liblz4.so.1 =&gt; /lib64/liblz4.so.1 (0x00007f2099263000)</span><br><span class="line">        libsnappy.so.1 =&gt; /lib64/libsnappy.so.1 (0x00007f2097600000)</span><br><span class="line">[mysql@rocky9 ~]$</span><br></pre></td></tr></table></figure></div><p>可以看到二进制文件 <code>mysqld</code> 所有动态库依赖都能找到，其中一部分指向了 StoneDB 自带的库文件。</p><!--[mysql@rocky9 bin]$ ldd mysqld...libssl.so.1.1 => not foundlibcrypto.so.1.1 => not found...>>>> yum install compat-openssl11[mysql@rocky9 bin]$ ldd mysqld...libssl.so.1.1 => /lib64/libssl.so.1.1 (0x00007f82976cd000)libcrypto.so.1.1 => /lib64/libcrypto.so.1.1 (0x00007f8297200000)...--><h3 id="编辑配置文件-my-cnf">编辑配置文件 my.cnf</h3><p>编辑配置文件 <code>/etc/my.cnf</code>，增加如下内容：</p><div class="highlight-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">client</span>]</span><br><span class="line"><span class="string">port</span>                <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">socket</span>              <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/data/mysql.sock</span></span><br><span class="line"></span><br><span class="line">[<span class="string">mysqld</span>]</span><br><span class="line"><span class="string">port</span>                <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">server-id</span>           <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">basedir</span>             <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/</span></span><br><span class="line"><span class="string">datadir</span>             <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/data/</span></span><br><span class="line"><span class="string">pid-file</span>            <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/data/mysqld.pid</span></span><br><span class="line"><span class="string">socket</span>              <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/data/mysql.sock</span></span><br><span class="line"><span class="string">tmpdir</span>              <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/tmp/</span></span><br><span class="line"><span class="string">log-error</span>           <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/log/mysqld.log</span></span><br><span class="line"><span class="string">slow-query-log</span>      <span class="string">=</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="string">slow-query-log-file</span> <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/log/slow.log</span></span><br><span class="line"><span class="string">log-bin</span>             <span class="string">=</span> <span class="string">/opt/stonedb_v2/install/binlog/BINLOG</span></span><br></pre></td></tr></table></figure></div><p>主要将文件路径指向到安装目录。</p><h3 id="Q4-帮助信息">Q4: 帮助信息</h3><p>在查看帮助信息时，遇到了 <code>mysqld got signal 11</code> 报错，报错信息如下：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 ~]$ mysqld --verbose --help</span><br><span class="line">mysqld  Ver 8.0.33 for Linux on x86_64 (Source distribution)</span><br><span class="line">BuildID[sha1]=150f81d4108e038e942961c325806ba3d1479f58</span><br><span class="line">Copyright (c) 2000, 2023, StoneAtom and/or its affiliates.</span><br><span class="line"></span><br><span class="line">StoneDB is a registered trademark of StoneAtom Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Starts the MySQL database server.</span><br><span class="line"></span><br><span class="line">Usage: mysqld [OPTIONS]</span><br><span class="line"></span><br><span class="line">Default options are read from the following files in the given order:</span><br><span class="line">/etc/my.cnf /etc/mysql/my.cnf /opt/stonedb_v2/install/etc/my.cnf ~/.my.cnf</span><br><span class="line">The following groups are read: mysql_cluster mysqld server mysqld-8.0</span><br><span class="line">The following options may be given as the first argument:</span><br><span class="line">...</span><br><span class="line">To see what values a running MySQL server is using, type</span><br><span class="line">&#x27;mysqladmin variables&#x27; instead of &#x27;mysqld --verbose --help&#x27;.</span><br><span class="line">2023-12-05T14:57:05Z UTC - mysqld got signal 11 ;</span><br><span class="line">Most likely, you have hit a bug, but this error can also be caused by malfunctioning hardware.</span><br><span class="line">BuildID[sha1]=150f81d4108e038e942961c325806ba3d1479f58</span><br><span class="line">Thread pointer: 0x0</span><br><span class="line">Attempting backtrace. You can use the following information to find out</span><br><span class="line">where mysqld died. If you see no messages after this, something went</span><br><span class="line">terribly wrong...</span><br><span class="line">stack_bottom = 0 thread_stack 0x100000</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(my_print_stacktrace(unsigned char const*, unsigned long)+0x2e) [0x236c4fe]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(print_fatal_signal(int)+0x377) [0x1047637]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(handle_fatal_signal+0x95) [0x10476d5]</span><br><span class="line">/lib64/libc.so.6(+0x54db0) [0x7fecd2854db0]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(Mondetdb_Adaptor::Mondetdb_Adaptor()+0x407) [0x1004f37]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(Mondetdb_Adaptor::instance()+0x35) [0x10051c5]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld() [0xd957a4]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld() [0xd9c4f7]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld() [0xda3f98]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(mysqld_main(int, char**)+0x2454) [0xdab194]</span><br><span class="line">/lib64/libc.so.6(+0x3feb0) [0x7fecd283feb0]</span><br><span class="line">/lib64/libc.so.6(__libc_start_main+0x80) [0x7fecd283ff60]</span><br><span class="line">/opt/stonedb_v2/install/bin/mysqld(_start+0x2e) [0xd8a46e]</span><br><span class="line">The manual page at http://dev.mysql.com/doc/mysql/en/crashing.html contains</span><br><span class="line">information that should help you find out what is causing the crash.</span><br><span class="line">[mysql@rocky9 ~]$</span><br></pre></td></tr></table></figure></div><h3 id="初始化-StoneDB">初始化 StoneDB</h3><p>使用如下命令进行初始化：</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize-insecure</span><br></pre></td></tr></table></figure></div><p>初始化成功后，日志显示如下。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 log]$ cat mysqld.log</span><br><span class="line">2023-12-05T15:18:55.368727Z 0 [System] [MY-013169] [Server] /opt/stonedb_v2/install/bin/mysqld (mysqld 8.0.33) initializing of server in progress as process 402224</span><br><span class="line">2023-12-05T15:18:55.393904Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2023-12-05T15:19:07.595251Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2023-12-05T15:21:50.409230Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.</span><br><span class="line">[mysql@rocky9 log]$</span><br></pre></td></tr></table></figure></div><h3 id="Q5：推荐配置">Q5：推荐配置</h3><p>在文档 <a class="link"   href="https://www.stoneatom.com/StonedbDocs?id=186" >服务器推荐配置 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 中，建议开发、测试环境使用 2c+ 2g+ 配置，</p><p>可是，本文一开始使用的环境是 2c4g，初始化时只成功了一次，而且耗费较长时间，后面再试几次均未成功，而且尝试过程中，内存打满，swap被大量占用。</p><img  alt="stonedbswap.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231205-55759881-e34d-4201-8746-fa78cc354334.png"                      referrerpolicy="no-referrer"                ><p>推荐配置已无法满足 StoneDB 8.0。</p><h3 id="运行-StoneDB">运行 StoneDB</h3><p>启动数据库</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld_safe &amp;</span><br></pre></td></tr></table></figure></div><h3 id="Q6：-InnoDB-初始化">Q6： InnoDB 初始化</h3><p>每次启动数据库时，日志中都会打印 InnoDB 初始化，不知道这里是哪个环节打印的信息。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2023-12-05T15:07:14.654886Z mysqld_safe Logging to &#x27;/opt/stonedb_v2/install/log/mysqld.log&#x27;.</span><br><span class="line">2023-12-05T15:07:14.882598Z mysqld_safe Starting mysqld daemon with databases from /opt/stonedb_v2/install/data</span><br><span class="line">2023-12-05T15:07:15.559446Z 0 [System] [MY-010116] [Server] /opt/stonedb_v2/install/bin/mysqld (mysqld 8.0.33) starting as process 48880</span><br><span class="line">2023-12-05T15:07:15.597722Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2023-12-05T15:07:16.044637Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2023-12-05T15:07:19.543799Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">2023-12-05T15:07:19.543948Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">2023-12-05T15:07:19.647474Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /tmp/mysqlx.sock</span><br><span class="line">2023-12-05T15:07:19.649315Z 0 [System] [MY-010931] [Server] /opt/stonedb_v2/install/bin/mysqld: ready for connections. Version: &#x27;8.0.33&#x27;  socket: &#x27;/opt/stonedb_v2/install/data/mysql.sock&#x27;  port: 3306  Source distribution.</span><br></pre></td></tr></table></figure></div><h2 id="简单-CRUD-测试">简单 CRUD 测试</h2><p>连接数据库，并进行常规 CRUD 测试。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 log]$ mysql -uroot </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.0.33 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, StoneAtom and/or its affiliates.</span><br><span class="line"></span><br><span class="line">StoneDB is a registered trademark of StoneAtom Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">\s</span></span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 8.0.33 for Linux on x86_64 (Source distribution)</span><br><span class="line"></span><br><span class="line">Connection id:8</span><br><span class="line">Current database:</span><br><span class="line">Current user:root@localhost</span><br><span class="line">SSL:Not in use</span><br><span class="line">Current pager:stdout</span><br><span class="line">Using outfile:&#x27;&#x27;</span><br><span class="line">Using delimiter:;</span><br><span class="line">Server version:8.0.33 Source distribution</span><br><span class="line">Protocol version:10</span><br><span class="line">Connection:Localhost via UNIX socket</span><br><span class="line">Server characterset:utf8mb4</span><br><span class="line">Db     characterset:utf8mb4</span><br><span class="line">Client characterset:utf8mb4</span><br><span class="line">Conn.  characterset:utf8mb4</span><br><span class="line">UNIX socket:/opt/stonedb_v2/install/data/mysql.sock</span><br><span class="line">Binary data as:Hexadecimal</span><br><span class="line">Uptime:1 min 35 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 5  Slow queries: 0  Opens: 120  Flush tables: 3  Open tables: 36  Queries per second avg: 0.052</span><br><span class="line">--------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create schema s1;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use s1;</span></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create table t1(<span class="built_in">id</span> int);</span></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">insert t1 <span class="keyword">select</span> 1;</span></span><br><span class="line">ERROR 4164 (HY000): exec sql err: ParseException:SQLparser:42000!syntax error, unexpected IDENT, expecting INTO in: &quot;insert t1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">insert into t1 <span class="keyword">select</span> 1;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure></div><p>这里遇到了语法解析异常，也印证 StoneDB 的语法解析部分已经和 MySQL 有所不同。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * from t1;</span></span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show create table t1\G</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: t1</span><br><span class="line">Create Table: CREATE TABLE `t1` (</span><br><span class="line">  `id` int DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update t1 <span class="built_in">set</span> <span class="built_in">id</span> = 2 <span class="built_in">where</span> 1=1;</span></span><br><span class="line">ERROR 4164 (HY000): exec sql err: SQLException:sql.execute:25005!Current transaction is aborted (please ROLLBACK)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update t1 <span class="built_in">set</span> <span class="built_in">id</span> = 2 <span class="built_in">where</span> <span class="built_in">id</span> = 1;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure></div><p>这里再次遇到了 SQL 异常，更新语句条件带有 <code>1=1</code> 时，抛异常。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="keyword">select</span> * into outfile <span class="string">&#x27;t2.sql&#x27;</span> from t2;</span></span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure></div><p>尝试导出数据到文件时，提示需要开启 <code>--secure-file-priv</code> 选项，重启数据库。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 log]$ mysqld --secure-file-priv=/tmp &amp;</span><br></pre></td></tr></table></figure></div><p>再次尝试导数。</p><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/tmp/t2.sql&#x27;</span> <span class="keyword">from</span> t2;</span><br><span class="line">ERROR <span class="number">3136</span> (<span class="number">42000</span>): ParseException:SQLparser:<span class="number">42000</span><span class="operator">!</span>syntax error, unexpected STRING, expecting SCOLON <span class="keyword">in</span>: &quot;select * into outfile &#x27;/tmp/t2.sql&#x27;&quot;</span><br></pre></td></tr></table></figure></div><p>然鹅，依旧提示报错，提示语法错误，而且会生成空文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# ll /tmp/t2.sql </span><br><span class="line">-rw-r-----. 1 mysql mysql 0 Dec  5 23:24 /tmp/t2.sql</span><br></pre></td></tr></table></figure></div><p>尝试几次无果，也没找到相关文档说明，暂时先这样。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SELECT <span class="built_in">id</span> INTO OUTFILE <span class="string">&#x27;/tmp/t2.txt&#x27;</span></span></span><br><span class="line">    -&gt;   FIELDS TERMINATED BY &#x27;,&#x27; OPTIONALLY ENCLOSED BY &#x27;&quot;&#x27;</span><br><span class="line">    -&gt;   LINES TERMINATED BY &#x27;\n&#x27;</span><br><span class="line">    -&gt;   FROM t2;</span><br><span class="line">ERROR 3136 (42000): ParseException:SQLparser:42000!syntax error, unexpected STRING, expecting SCOLON in: &quot;select id into outfile &#x27;/tmp/t2.txt&#x27;&quot;</span><br></pre></td></tr></table></figure></div><p>创建 <code>FUNCTION</code> ，第一次和第二次执行遇到的报错不同，去掉 <code>CONCAT</code> 之后，创建成功。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">CREATE FUNCTION hello (s CHAR(20))</span></span><br><span class="line">    -&gt; RETURNS CHAR(50) DETERMINISTIC</span><br><span class="line">    -&gt; RETURN CONCAT(&#x27;Hello, &#x27;,s,&#x27;!&#x27;);</span><br><span class="line">ERROR 4164 (HY000): exec sql err: SQLException:sql.execute:25005!Current transaction is aborted (please ROLLBACK)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">CREATE FUNCTION hello (s CHAR(20))</span></span><br><span class="line">    -&gt; RETURNS CHAR(50) </span><br><span class="line">    -&gt; RETURN CONCAT(&#x27;Hello, &#x27;,s,&#x27;!&#x27;);</span><br><span class="line">ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">mysql&gt;</span> </span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">CREATE FUNCTION hello (s CHAR(20))</span></span><br><span class="line">    -&gt; RETURNS CHAR(50) DETERMINISTIC</span><br><span class="line">    -&gt; RETURN CONCAT(&#x27;Hello, &#x27;,s,&#x27;!&#x27;);</span><br><span class="line">ERROR 4164 (HY000): exec sql err: ParseException:SQLparser:42000!SELECT: no such operator &#x27;concat&#x27;(char(7), char(20), char(1))</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">mysql&gt; CREATE FUNCTION hello (s CHAR(20)) RETURNS CHAR(50) DETERMINISTIC RETURN <span class="string">&#x27;Hello!&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SELECT hello(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">+-----------+</span><br><span class="line">| hello(&#x27;&#x27;) |</span><br><span class="line">+-----------+</span><br><span class="line">| Hello!    |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></div><h2 id="存储引擎">存储引擎</h2><p>StoneDB 5.7 中引入了自己的存储引擎 Tianmu。</p><blockquote><p>在创建表时，您可以显式指定表的存储引擎，如创建表指定 engine=innodb。如果 StoneDB 采用主从架构部署，在 StoneDB 备库配置了 sql_mode 强制 tianmu 引擎的变量：MANDATORY_TIANMU。那么在主库创建时即使指定了 engine=innodb 的表，备库表结构同步也会自动变为engine=Tianmu。数据从主节点同步至从节点的过程中，会自动完成行列组织格式的转换。在优先级上，sql_mode =‘MANDATORY_TIANMU’ &gt; default_storage_engine。<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p></blockquote><p>但是，在 StoneDB 8.0 中默认的存储引擎为 InnoDB。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables like <span class="string">&#x27;default_storage_engine&#x27;</span>;</span></span><br><span class="line">+------------------------+--------+</span><br><span class="line">| Variable_name          | Value  |</span><br><span class="line">+------------------------+--------+</span><br><span class="line">| default_storage_engine | InnoDB |</span><br><span class="line">+------------------------+--------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure></div><p>而且找不到任何关于 Tianmu 的变量，无法创建 Tianmu 引擎的表。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables like <span class="string">&#x27;tianmu_%&#x27;</span>;</span></span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create table student(<span class="built_in">id</span> int(11) primary key, name varchar(10)) engine=tianmu;</span></span><br><span class="line">ERROR 1286 (42000): Unknown storage engine &#x27;tianmu&#x27;</span><br></pre></td></tr></table></figure></div><p>文档中没找到相关信息，个人推测是引入了 MonetDB 来取代 Tianmu 作为新的列存引擎。</p><h3 id="Q7-路径问题">Q7: 路径问题</h3><p>有两个隐藏文件里，里面指向的路径不存在。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 dbfarm]$ pwd</span><br><span class="line">/opt/stonedb_v2/install/var/monetdb5/dbfarm</span><br><span class="line">[mysql@rocky9 dbfarm]$ tail -n 2 .merovingian_properties </span><br><span class="line">logfile=/var/opt/stonedb_v2/install/log/monetdb/merovingian.log</span><br><span class="line">pidfile=/var/run/opt/stonedb_v2/install/monetdb/merovingian.pid</span><br><span class="line">[mysql@rocky9 dbfarm]$ </span><br></pre></td></tr></table></figure></div><p>另外，文件 <code>mysqlrouter-log-rotate</code> 建议移动到 <code>support-files</code> 路径下。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[mysql@rocky9 install]$ pwd</span><br><span class="line">/opt/stonedb_v2/install</span><br><span class="line">[mysql@rocky9 install]$ ll mysqlrouter-log-rotate </span><br><span class="line">-rw-r--r--. 1 mysql mysql 1623 Nov 30 14:36 mysqlrouter-log-rotate</span><br><span class="line">[mysql@rocky9 install]$ tree support-files/</span><br><span class="line">support-files/</span><br><span class="line">├── mysqld_multi.server</span><br><span class="line">├── mysql-log-rotate</span><br><span class="line">└── mysql.server</span><br><span class="line"></span><br><span class="line">0 directories, 3 files</span><br></pre></td></tr></table></figure></div><h2 id="总结">总结</h2><p>2c4g 着实有点难为 StoneDB 了，还是要多给点资源才能跑的动，后来在 8c16g 环境下才运行起来，只是内存使用接近 6g。</p><img  alt="imgmem6g.png"                      lazyload                     src="/img/loading.svg"                     data-src="https://oss-emcsprod-public.modb.pro/image/editor/20231206-d9501602-e7d3-4ab8-8fea-0d3765204cc4.png"                      referrerpolicy="no-referrer"                ><p>希望企业版的体验会更好，<s>而不是叫企业版的原型</s>。</p><p>StoneDB 的迭代速度还是蛮快的，期待下个版本。</p><hr><p><a class="link"   href="https://www.modb.pro/db/1732209819015782400" >https://www.modb.pro/db/1732209819015782400 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a class="link"   href="https://www.stoneatom.com/StonedbDocs?id=352" >https://www.stoneatom.com/StonedbDocs?id=352 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;前段时间已经体验过 StoneDB 5.7 ，对这款石原子数据库也有了初步印象。尤其是 StoneDB 5.7 开源版本未适配 Rocky Linux 9 的情况下，编译安装遇到了若干问题，本文来看看 StoneDB 8.0 企业版在</summary>
      
    
    
    
    <category term="StoneDB" scheme="https://shawnyan.cn/categories/stonedb/"/>
    
    
    <category term="stonedb" scheme="https://shawnyan.cn/tags/stonedb/"/>
    
    <category term="monetdb" scheme="https://shawnyan.cn/tags/monetdb/"/>
    
  </entry>
  
</feed>
